var ru=Object.defineProperty;var nu=(n,e,t)=>e in n?ru(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var at=(n,e,t)=>nu(n,typeof e!="symbol"?e+"":e,t);var nn={};const au=()=>typeof window<"u"&&typeof window.document<"u",iu=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",su=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Da=()=>typeof Deno<"u",ou=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Da(),uu=()=>{let n;return au()?n="browser":ou()?n="node":iu()?n="webworker":su()?n="jsdom":Da()?n="deno":n="other",n};let an;function cu(){return an===void 0&&(an={library:"langchain-js",runtime:uu()}),an}function xt(n){try{return typeof process<"u"?nn==null?void 0:nn[n]:Da()?Deno==null?void 0:Deno.env.get(n):void 0}catch{return}}function Fh(n,e=co){n=n.trim();const t=n.indexOf("```");if(t===-1)return e(n);let r=n.substring(t+3);r.startsWith(`json
`)?r=r.substring(5):r.startsWith("json")?r=r.substring(4):r.startsWith(`
`)&&(r=r.substring(1));const a=r.indexOf("```");let i=r;return a!==-1&&(i=r.substring(0,a)),e(i.trim())}function co(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="";const t=[];let r=!1,a=!1;for(let i of n){if(r)i==='"'&&!a?r=!1:i===`
`&&!a?i="\\n":i==="\\"?a=!a:a=!1;else if(i==='"')r=!0,a=!1;else if(i==="{")t.push("}");else if(i==="[")t.push("]");else if(i==="}"||i==="]")if(t&&t[t.length-1]===i)t.pop();else return null;e+=i}r&&(e+='"');for(let i=t.length-1;i>=0;i-=1)e+=t[i];try{return JSON.parse(e)}catch{return null}}function ir(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var sn,oi;function lu(){return oi||(oi=1,sn=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),sn}var du=lu();const fu=ir(du);var _r={exports:{}},ui;function hu(){if(ui)return _r.exports;ui=1;const n=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,r=/([\p{Alpha}\p{N}_]|$)/u,a=/[_.\- ]+/,i=new RegExp("^"+a.source),s=new RegExp(a.source+r.source,"gu"),o=new RegExp("\\d+"+r.source,"gu"),u=(d,p,h)=>{let g=!1,y=!1,m=!1;for(let b=0;b<d.length;b++){const _=d[b];g&&n.test(_)?(d=d.slice(0,b)+"-"+d.slice(b),g=!1,m=y,y=!0,b++):y&&m&&e.test(_)?(d=d.slice(0,b-1)+"-"+d.slice(b-1),m=y,y=!1,g=!0):(g=p(_)===_&&h(_)!==_,m=y,y=h(_)===_&&p(_)!==_)}return d},c=(d,p)=>(t.lastIndex=0,d.replace(t,h=>p(h))),l=(d,p)=>(s.lastIndex=0,o.lastIndex=0,d.replace(s,(h,g)=>p(g)).replace(o,h=>p(h))),f=(d,p)=>{if(!(typeof d=="string"||Array.isArray(d)))throw new TypeError("Expected the input to be `string | string[]`");if(p={pascalCase:!1,preserveConsecutiveUppercase:!1,...p},Array.isArray(d)?d=d.map(m=>m.trim()).filter(m=>m.length).join("-"):d=d.trim(),d.length===0)return"";const h=p.locale===!1?m=>m.toLowerCase():m=>m.toLocaleLowerCase(p.locale),g=p.locale===!1?m=>m.toUpperCase():m=>m.toLocaleUpperCase(p.locale);return d.length===1?p.pascalCase?g(d):h(d):(d!==h(d)&&(d=u(d,h,g)),d=d.replace(i,""),p.preserveConsecutiveUppercase?d=c(d,h):d=h(d),p.pascalCase&&(d=g(d.charAt(0))+d.slice(1)),l(d,g))};return _r.exports=f,_r.exports.default=f,_r.exports}hu();function pu(n,e){return(e==null?void 0:e[n])||fu(n)}function mu(n,e,t){const r={};for(const a in n)Object.hasOwn(n,a)&&(r[e(a,t)]=n[a]);return r}function ci(n){return Array.isArray(n)?[...n]:{...n}}function gu(n,e){const t=ci(n);for(const[r,a]of Object.entries(e)){const[i,...s]=r.split(".").reverse();let o=t;for(const u of s.reverse()){if(o[u]===void 0)break;o[u]=ci(o[u]),o=o[u]}o[i]!==void 0&&(o[i]={lc:1,type:"secret",id:[a]})}return t}function lo(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class _t{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,lo(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([r])=>{var a;return(a=this.lc_serializable_keys)==null?void 0:a.includes(r)})):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof _t||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((a,i)=>(a[i]=i in this?this[i]:this.lc_kwargs[i],a),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(a=>{let i=this,s=r;const[o,...u]=a.split(".").reverse();for(const c of u.reverse()){if(!(c in i)||i[c]===void 0)return;(!(c in s)||s[c]===void 0)&&(typeof i[c]=="object"&&i[c]!=null?s[c]={}:Array.isArray(i[c])&&(s[c]=[])),i=i[c],s=s[c]}o in i&&i[o]!==void 0&&(s[o]=s[o]||i[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:mu(Object.keys(t).length?gu(r,t):r,pu,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}function Xt(n){return typeof n=="object"&&n!==null&&"type"in n&&typeof n.type=="string"&&"source_type"in n&&(n.source_type==="url"||n.source_type==="base64"||n.source_type==="text"||n.source_type==="id")}function zh(n){return Xt(n)&&n.source_type==="url"&&"url"in n&&typeof n.url=="string"}function Bh(n){return Xt(n)&&n.source_type==="base64"&&"data"in n&&typeof n.data=="string"}function qh(n){if(Xt(n)){if(n.source_type==="url")return{type:"image_url",image_url:{url:n.url}};if(n.source_type==="base64"){if(!n.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${n.mime_type};base64,${n.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function Zh({dataUrl:n,asTypedArray:e=!1}){const t=n.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let r;if(t){r=t[1].toLowerCase();const a=e?Uint8Array.from(atob(t[2]),i=>i.charCodeAt(0)):t[2];return{mime_type:r,data:a}}}function Hh(n,e){if(n.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(n)}if(n.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(n)}if(n.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(n)}if(n.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(n)}throw new Error(`Unable to convert content block type '${n.type}' to provider-specific format: not recognized.`)}function sr(n,e){return typeof n=="string"?n===""?e:typeof e=="string"?n+e:Array.isArray(e)&&e.some(t=>Xt(t))?[{type:"text",source_type:"text",text:n},...e]:[{type:"text",text:n},...e]:Array.isArray(e)?Ua(n,e)??[...n,...e]:e===""?n:Array.isArray(n)&&n.some(t=>Xt(t))?[...n,{type:"file",source_type:"text",text:e}]:[...n,{type:"text",text:e}]}function yu(n,e){function t(r,a){if(typeof r!="object"||r===null||r===void 0)return r;if(a>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(s=>t(s,a+1));const i={};for(const s of Object.keys(r))i[s]=t(r[s],a+1);return i}return JSON.stringify(t(n,0),null,2)}class Nt extends _t{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=yu(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function Ne(n,e){const t={...n};for(const[r,a]of Object.entries(e))if(t[r]==null)t[r]=a;else{if(a==null)continue;if(typeof t[r]!=typeof a||Array.isArray(t[r])!==Array.isArray(a))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=a}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=Ne(t[r],a);else if(Array.isArray(t[r]))t[r]=Ua(t[r],a);else{if(t[r]===a)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function Ua(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{const t=[...n];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const a=t.findIndex(i=>i.index===r.index);a!==-1?t[a]=Ne(t[a],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}class or extends Nt{}function _u(n){return typeof n.role=="string"}function fo(n){return typeof(n==null?void 0:n._getType)=="function"}function Gh(n){return fo(n)&&typeof n.concat=="function"}function bu(n){return n!=null&&typeof n=="object"&&"lc_direct_tool_output"in n&&n.lc_direct_tool_output===!0}class ba extends Nt{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function wu(n){const e=[],t=[];for(const r of n)if(r.function){const a=r.function.name;try{const i=JSON.parse(r.function.arguments),s={name:a||"",args:i||{},id:r.id};e.push(s)}catch{t.push({name:a,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,t]}function Vh(n){return n._getType()==="tool"}class li extends Nt{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var a;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;const i=(a=r.additional_kwargs)==null?void 0:a.tool_calls,s=r.tool_calls;i!=null&&i.length>0&&(s===void 0||s.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(i!=null&&s===void 0){const[o,u]=wu(i);r.tool_calls=o??[],r.invalid_tool_calls=u??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function Jh(n){return n._getType()==="ai"}function Wh(n){return n._getType()==="ai"}class ur extends or{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const r=[],a=[];for(const i of e.tool_call_chunks){let s={};try{if(s=co(i.args||"{}"),s===null||typeof s!="object"||Array.isArray(s))throw new Error("Malformed tool call chunk args.");r.push({name:i.name??"",args:s,id:i.id,type:"tool_call"})}catch{a.push({name:i.name,args:i.args,id:i.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:a,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var r,a,i,s,o,u,c,l,f,d,p,h,g,y,m,b,_,v,w,x,L,k,le,Re,ke,We,Ke,I,S,D,P,U,N,z,X,G,re,oe,Q,xe;const t={content:sr(this.content,e.content),additional_kwargs:Ne(this.additional_kwargs,e.additional_kwargs),response_metadata:Ne(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const Ze=Ua(this.tool_call_chunks,e.tool_call_chunks);Ze!==void 0&&Ze.length>0&&(t.tool_call_chunks=Ze)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const Ze={...(((a=(r=this.usage_metadata)==null?void 0:r.input_token_details)==null?void 0:a.audio)!==void 0||((s=(i=e.usage_metadata)==null?void 0:i.input_token_details)==null?void 0:s.audio)!==void 0)&&{audio:(((u=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:u.audio)??0)+(((l=(c=e.usage_metadata)==null?void 0:c.input_token_details)==null?void 0:l.audio)??0)},...(((d=(f=this.usage_metadata)==null?void 0:f.input_token_details)==null?void 0:d.cache_read)!==void 0||((h=(p=e.usage_metadata)==null?void 0:p.input_token_details)==null?void 0:h.cache_read)!==void 0)&&{cache_read:(((y=(g=this.usage_metadata)==null?void 0:g.input_token_details)==null?void 0:y.cache_read)??0)+(((b=(m=e.usage_metadata)==null?void 0:m.input_token_details)==null?void 0:b.cache_read)??0)},...(((v=(_=this.usage_metadata)==null?void 0:_.input_token_details)==null?void 0:v.cache_creation)!==void 0||((x=(w=e.usage_metadata)==null?void 0:w.input_token_details)==null?void 0:x.cache_creation)!==void 0)&&{cache_creation:(((k=(L=this.usage_metadata)==null?void 0:L.input_token_details)==null?void 0:k.cache_creation)??0)+(((Re=(le=e.usage_metadata)==null?void 0:le.input_token_details)==null?void 0:Re.cache_creation)??0)}},wt={...(((We=(ke=this.usage_metadata)==null?void 0:ke.output_token_details)==null?void 0:We.audio)!==void 0||((I=(Ke=e.usage_metadata)==null?void 0:Ke.output_token_details)==null?void 0:I.audio)!==void 0)&&{audio:(((D=(S=this.usage_metadata)==null?void 0:S.output_token_details)==null?void 0:D.audio)??0)+(((U=(P=e.usage_metadata)==null?void 0:P.output_token_details)==null?void 0:U.audio)??0)},...(((z=(N=this.usage_metadata)==null?void 0:N.output_token_details)==null?void 0:z.reasoning)!==void 0||((G=(X=e.usage_metadata)==null?void 0:X.output_token_details)==null?void 0:G.reasoning)!==void 0)&&{reasoning:(((oe=(re=this.usage_metadata)==null?void 0:re.output_token_details)==null?void 0:oe.reasoning)??0)+(((xe=(Q=e.usage_metadata)==null?void 0:Q.output_token_details)==null?void 0:xe.reasoning)??0)}},Lt=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},je=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},Xe={input_tokens:Lt.input_tokens+je.input_tokens,output_tokens:Lt.output_tokens+je.output_tokens,total_tokens:Lt.total_tokens+je.total_tokens,...Object.keys(Ze).length>0&&{input_token_details:Ze},...Object.keys(wt).length>0&&{output_token_details:wt}};t.usage_metadata=Xe}return new ur(t)}}class Fa extends Nt{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Fa}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class za extends or{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new za({content:sr(this.content,e.content),additional_kwargs:Ne(this.additional_kwargs,e.additional_kwargs),response_metadata:Ne(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}class Ba extends or{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Ba({content:sr(this.content,e.content),additional_kwargs:Ne(this.additional_kwargs,e.additional_kwargs),response_metadata:Ne(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}class qa extends Nt{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,t){super(e,t)}}class Za extends or{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,t){super(e,t)}concat(e){return new Za({content:sr(this.content,e.content),additional_kwargs:Ne(this.additional_kwargs,e.additional_kwargs),response_metadata:Ne(this.response_metadata,e.response_metadata),id:this.id??e.id})}}class di extends Nt{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,t){super(e,t)}}class Ha extends or{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,t){super(e,t)}concat(e){return new Ha({content:sr(this.content,e.content),additional_kwargs:Ne(this.additional_kwargs,e.additional_kwargs),response_metadata:Ne(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function vu(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function Ht(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}function Eu(n){return!!(n&&typeof n=="object"&&"toolCall"in n&&n.toolCall!=null&&typeof n.toolCall=="object"&&"id"in n.toolCall&&typeof n.toolCall.id=="string")}class wa extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function Ou(n){return Ht(n)?n:typeof n.id=="string"&&n.type==="function"&&typeof n.function=="object"&&n.function!==null&&"arguments"in n.function&&typeof n.function.arguments=="string"&&"name"in n.function&&typeof n.function.name=="string"?{id:n.id,args:JSON.parse(n.function.arguments),name:n.function.name,type:"tool_call"}:n}function Su(n){return typeof n=="object"&&n!=null&&n.lc===1&&Array.isArray(n.id)&&n.kwargs!=null&&typeof n.kwargs=="object"}function on(n){let e,t;if(Su(n)){const r=n.id.at(-1);r==="HumanMessage"||r==="HumanMessageChunk"?e="user":r==="AIMessage"||r==="AIMessageChunk"?e="assistant":r==="SystemMessage"||r==="SystemMessageChunk"?e="system":r==="FunctionMessage"||r==="FunctionMessageChunk"?e="function":r==="ToolMessage"||r==="ToolMessageChunk"?e="tool":e="unknown",t=n.kwargs}else{const{type:r,...a}=n;e=r,t=a}if(e==="human"||e==="user")return new qa(t);if(e==="ai"||e==="assistant"){const{tool_calls:r,...a}=t;if(!Array.isArray(r))return new li(t);const i=r.map(Ou);return new li({...a,tool_calls:i})}else{if(e==="system")return new di(t);if(e==="developer")return new di({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new ba({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw vu(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(n,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function xu(n){if(typeof n=="string")return new qa(n);if(fo(n))return n;if(Array.isArray(n)){const[e,t]=n;return on({type:e,content:t})}else if(_u(n)){const{role:e,...t}=n;return on({...t,type:e})}else return on(n)}function ho(n,e="Human",t="AI"){const r=[];for(const a of n){let i;if(a._getType()==="human")i=e;else if(a._getType()==="ai")i=t;else if(a._getType()==="system")i="System";else if(a._getType()==="function")i="Function";else if(a._getType()==="tool")i="Tool";else if(a._getType()==="generic")i=a.role;else throw new Error(`Got unsupported message type: ${a._getType()}`);const s=a.name?`${a.name}, `:"",o=typeof a.content=="string"?a.content:JSON.stringify(a.content,null,2);r.push(`${i}: ${s}${o}`)}return r.join(`
`)}function Kh(n){var t;const e=n._getType();if(e==="human")return new Za({...n});if(e==="ai"){let r={...n};return"tool_calls"in r&&(r={...r,tool_call_chunks:(t=r.tool_calls)==null?void 0:t.map(a=>({...a,type:"tool_call_chunk",index:void 0,args:JSON.stringify(a.args)}))}),new ur({...r})}else{if(e==="system")return new Ha({...n});if(e==="function")return new Ba({...n});if(Fa.isInstance(n))return new za({...n});throw new Error("Unknown message type.")}}var te;(function(n){n.assertEqual=a=>{};function e(a){}n.assertIs=e;function t(a){throw new Error}n.assertNever=t,n.arrayToEnum=a=>{const i={};for(const s of a)i[s]=s;return i},n.getValidEnumValues=a=>{const i=n.objectKeys(a).filter(o=>typeof a[a[o]]!="number"),s={};for(const o of i)s[o]=a[o];return n.objectValues(s)},n.objectValues=a=>n.objectKeys(a).map(function(i){return a[i]}),n.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{const i=[];for(const s in a)Object.prototype.hasOwnProperty.call(a,s)&&i.push(s);return i},n.find=(a,i)=>{for(const s of a)if(i(s))return s},n.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&Number.isFinite(a)&&Math.floor(a)===a;function r(a,i=" | "){return a.map(s=>typeof s=="string"?`'${s}'`:s).join(i)}n.joinValues=r,n.jsonStringifyReplacer=(a,i)=>typeof i=="bigint"?i.toString():i})(te||(te={}));var fi;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(fi||(fi={}));const C=te.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),ot=n=>{switch(typeof n){case"undefined":return C.undefined;case"string":return C.string;case"number":return Number.isNaN(n)?C.nan:C.number;case"boolean":return C.boolean;case"function":return C.function;case"bigint":return C.bigint;case"symbol":return C.symbol;case"object":return Array.isArray(n)?C.array:n===null?C.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?C.promise:typeof Map<"u"&&n instanceof Map?C.map:typeof Set<"u"&&n instanceof Set?C.set:typeof Date<"u"&&n instanceof Date?C.date:C.object;default:return C.unknown}},E=te.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class rt extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(i){return i.message},r={_errors:[]},a=i=>{for(const s of i.issues)if(s.code==="invalid_union")s.unionErrors.map(a);else if(s.code==="invalid_return_type")a(s.returnTypeError);else if(s.code==="invalid_arguments")a(s.argumentsError);else if(s.path.length===0)r._errors.push(t(s));else{let o=r,u=0;for(;u<s.path.length;){const c=s.path[u];u===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(s))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return a(this),r}static assert(e){if(!(e instanceof rt))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,te.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}rt.create=n=>new rt(n);const va=(n,e)=>{let t;switch(n.code){case E.invalid_type:n.received===C.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case E.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,te.jsonStringifyReplacer)}`;break;case E.unrecognized_keys:t=`Unrecognized key(s) in object: ${te.joinValues(n.keys,", ")}`;break;case E.invalid_union:t="Invalid input";break;case E.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${te.joinValues(n.options)}`;break;case E.invalid_enum_value:t=`Invalid enum value. Expected ${te.joinValues(n.options)}, received '${n.received}'`;break;case E.invalid_arguments:t="Invalid function arguments";break;case E.invalid_return_type:t="Invalid function return type";break;case E.invalid_date:t="Invalid date";break;case E.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:te.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case E.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case E.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case E.custom:t="Invalid input";break;case E.invalid_intersection_types:t="Intersection results could not be merged";break;case E.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case E.not_finite:t="Number must be finite";break;default:t=e.defaultError,te.assertNever(n)}return{message:t}};let $u=va;function Iu(){return $u}const Tu=n=>{const{data:e,path:t,errorMaps:r,issueData:a}=n,i=[...t,...a.path||[]],s={...a,path:i};if(a.message!==void 0)return{...a,path:i,message:a.message};let o="";const u=r.filter(c=>!!c).slice().reverse();for(const c of u)o=c(s,{data:e,defaultError:o}).message;return{...a,path:i,message:o}};function T(n,e){const t=Iu(),r=Tu({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===va?void 0:va].filter(a=>!!a)});n.common.issues.push(r)}class Ie{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const a of t){if(a.status==="aborted")return V;a.status==="dirty"&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const a of t){const i=await a.key,s=await a.value;r.push({key:i,value:s})}return Ie.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const a of t){const{key:i,value:s}=a;if(i.status==="aborted"||s.status==="aborted")return V;i.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(typeof s.value<"u"||a.alwaysSet)&&(r[i.value]=s.value)}return{status:e.value,value:r}}}const V=Object.freeze({status:"aborted"}),qt=n=>({status:"dirty",value:n}),Ce=n=>({status:"valid",value:n}),hi=n=>n.status==="aborted",pi=n=>n.status==="dirty",It=n=>n.status==="valid",Ar=n=>typeof Promise<"u"&&n instanceof Promise;var j;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(j||(j={}));class lt{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const mi=(n,e)=>{if(It(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new rt(n.common.issues);return this._error=t,this._error}}};function Y(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:a}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(s,o)=>{const{message:u}=n;return s.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??r??o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:a}}class ee{get description(){return this._def.description}_getType(e){return ot(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:ot(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ie,ctx:{common:e.parent.common,data:e.data,parsedType:ot(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Ar(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){const r={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ot(e)},a=this._parseSync({data:e,path:r.path,parent:r});return mi(r,a)}"~validate"(e){var r,a;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ot(e)};if(!this["~standard"].async)try{const i=this._parseSync({data:e,path:[],parent:t});return It(i)?{value:i.value}:{issues:t.common.issues}}catch(i){(a=(r=i==null?void 0:i.message)==null?void 0:r.toLowerCase())!=null&&a.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(i=>It(i)?{value:i.value}:{issues:t.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:ot(e)},a=this._parse({data:e,path:r.path,parent:r}),i=await(Ar(a)?a:Promise.resolve(a));return mi(r,i)}refine(e,t){const r=a=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(a):t;return this._refinement((a,i)=>{const s=e(a),o=()=>i.addIssue({code:E.custom,...r(a)});return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,a)=>e(r)?!0:(a.addIssue(typeof t=="function"?t(r,a):t),!1))}_refinement(e){return new Rt({schema:this,typeName:O.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return Qe.create(this,this._def)}nullable(){return kt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Ve.create(this)}promise(){return jr.create(this,this._def)}or(e){return Nr.create([this,e],this._def)}and(e){return Cr.create(this,e,this._def)}transform(e){return new Rt({...Y(this._def),schema:this,typeName:O.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Sa({...Y(this._def),innerType:this,defaultValue:t,typeName:O.ZodDefault})}brand(){return new Xu({typeName:O.ZodBranded,type:this,...Y(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new xa({...Y(this._def),innerType:this,catchValue:t,typeName:O.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return Ga.create(this,e)}readonly(){return $a.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const Ru=/^c[^\s-]{8,}$/i,ku=/^[0-9a-z]+$/,Au=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Pu=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Nu=/^[a-z0-9_-]{21}$/i,Cu=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ju=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Lu=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Mu="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let un;const Du=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Uu=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Fu=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,zu=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Bu=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,qu=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,po="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Zu=new RegExp(`^${po}$`);function mo(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);const t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function Hu(n){return new RegExp(`^${mo(n)}$`)}function Gu(n){let e=`${po}T${mo(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function Vu(n,e){return!!((e==="v4"||!e)&&Du.test(n)||(e==="v6"||!e)&&Fu.test(n))}function Ju(n,e){if(!Cu.test(n))return!1;try{const[t]=n.split("."),r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||"typ"in a&&(a==null?void 0:a.typ)!=="JWT"||!a.alg||e&&a.alg!==e)}catch{return!1}}function Wu(n,e){return!!((e==="v4"||!e)&&Uu.test(n)||(e==="v6"||!e)&&zu.test(n))}class ct extends ee{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==C.string){const i=this._getOrReturnCtx(e);return T(i,{code:E.invalid_type,expected:C.string,received:i.parsedType}),V}const r=new Ie;let a;for(const i of this._def.checks)if(i.kind==="min")e.data.length<i.value&&(a=this._getOrReturnCtx(e,a),T(a,{code:E.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="max")e.data.length>i.value&&(a=this._getOrReturnCtx(e,a),T(a,{code:E.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!1,message:i.message}),r.dirty());else if(i.kind==="length"){const s=e.data.length>i.value,o=e.data.length<i.value;(s||o)&&(a=this._getOrReturnCtx(e,a),s?T(a,{code:E.too_big,maximum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}):o&&T(a,{code:E.too_small,minimum:i.value,type:"string",inclusive:!0,exact:!0,message:i.message}),r.dirty())}else if(i.kind==="email")Lu.test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"email",code:E.invalid_string,message:i.message}),r.dirty());else if(i.kind==="emoji")un||(un=new RegExp(Mu,"u")),un.test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"emoji",code:E.invalid_string,message:i.message}),r.dirty());else if(i.kind==="uuid")Pu.test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"uuid",code:E.invalid_string,message:i.message}),r.dirty());else if(i.kind==="nanoid")Nu.test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"nanoid",code:E.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid")Ru.test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"cuid",code:E.invalid_string,message:i.message}),r.dirty());else if(i.kind==="cuid2")ku.test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"cuid2",code:E.invalid_string,message:i.message}),r.dirty());else if(i.kind==="ulid")Au.test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"ulid",code:E.invalid_string,message:i.message}),r.dirty());else if(i.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),T(a,{validation:"url",code:E.invalid_string,message:i.message}),r.dirty()}else i.kind==="regex"?(i.regex.lastIndex=0,i.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"regex",code:E.invalid_string,message:i.message}),r.dirty())):i.kind==="trim"?e.data=e.data.trim():i.kind==="includes"?e.data.includes(i.value,i.position)||(a=this._getOrReturnCtx(e,a),T(a,{code:E.invalid_string,validation:{includes:i.value,position:i.position},message:i.message}),r.dirty()):i.kind==="toLowerCase"?e.data=e.data.toLowerCase():i.kind==="toUpperCase"?e.data=e.data.toUpperCase():i.kind==="startsWith"?e.data.startsWith(i.value)||(a=this._getOrReturnCtx(e,a),T(a,{code:E.invalid_string,validation:{startsWith:i.value},message:i.message}),r.dirty()):i.kind==="endsWith"?e.data.endsWith(i.value)||(a=this._getOrReturnCtx(e,a),T(a,{code:E.invalid_string,validation:{endsWith:i.value},message:i.message}),r.dirty()):i.kind==="datetime"?Gu(i).test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{code:E.invalid_string,validation:"datetime",message:i.message}),r.dirty()):i.kind==="date"?Zu.test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{code:E.invalid_string,validation:"date",message:i.message}),r.dirty()):i.kind==="time"?Hu(i).test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{code:E.invalid_string,validation:"time",message:i.message}),r.dirty()):i.kind==="duration"?ju.test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"duration",code:E.invalid_string,message:i.message}),r.dirty()):i.kind==="ip"?Vu(e.data,i.version)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"ip",code:E.invalid_string,message:i.message}),r.dirty()):i.kind==="jwt"?Ju(e.data,i.alg)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"jwt",code:E.invalid_string,message:i.message}),r.dirty()):i.kind==="cidr"?Wu(e.data,i.version)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"cidr",code:E.invalid_string,message:i.message}),r.dirty()):i.kind==="base64"?Bu.test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"base64",code:E.invalid_string,message:i.message}),r.dirty()):i.kind==="base64url"?qu.test(e.data)||(a=this._getOrReturnCtx(e,a),T(a,{validation:"base64url",code:E.invalid_string,message:i.message}),r.dirty()):te.assertNever(i);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(a=>e.test(a),{validation:t,code:E.invalid_string,...j.errToObj(r)})}_addCheck(e){return new ct({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...j.errToObj(e)})}url(e){return this._addCheck({kind:"url",...j.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...j.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...j.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...j.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...j.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...j.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...j.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...j.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...j.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...j.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...j.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...j.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...j.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...j.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...j.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...j.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...j.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...j.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...j.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...j.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...j.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...j.errToObj(t)})}nonempty(e){return this.min(1,j.errToObj(e))}trim(){return new ct({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ct({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ct({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}ct.create=n=>new ct({checks:[],typeName:O.ZodString,coerce:(n==null?void 0:n.coerce)??!1,...Y(n)});function Ku(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,a=t>r?t:r,i=Number.parseInt(n.toFixed(a).replace(".","")),s=Number.parseInt(e.toFixed(a).replace(".",""));return i%s/10**a}class Yt extends ee{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==C.number){const i=this._getOrReturnCtx(e);return T(i,{code:E.invalid_type,expected:C.number,received:i.parsedType}),V}let r;const a=new Ie;for(const i of this._def.checks)i.kind==="int"?te.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{code:E.invalid_type,expected:"integer",received:"float",message:i.message}),a.dirty()):i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),T(r,{code:E.too_small,minimum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),T(r,{code:E.too_big,maximum:i.value,type:"number",inclusive:i.inclusive,exact:!1,message:i.message}),a.dirty()):i.kind==="multipleOf"?Ku(e.data,i.value)!==0&&(r=this._getOrReturnCtx(e,r),T(r,{code:E.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):i.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),T(r,{code:E.not_finite,message:i.message}),a.dirty()):te.assertNever(i);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,j.toString(t))}gt(e,t){return this.setLimit("min",e,!1,j.toString(t))}lte(e,t){return this.setLimit("max",e,!0,j.toString(t))}lt(e,t){return this.setLimit("max",e,!1,j.toString(t))}setLimit(e,t,r,a){return new Yt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:j.toString(a)}]})}_addCheck(e){return new Yt({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:j.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:j.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:j.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:j.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:j.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:j.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:j.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:j.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:j.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&te.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}Yt.create=n=>new Yt({checks:[],typeName:O.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...Y(n)});class Qt extends ee{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==C.bigint)return this._getInvalidInput(e);let r;const a=new Ie;for(const i of this._def.checks)i.kind==="min"?(i.inclusive?e.data<i.value:e.data<=i.value)&&(r=this._getOrReturnCtx(e,r),T(r,{code:E.too_small,type:"bigint",minimum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="max"?(i.inclusive?e.data>i.value:e.data>=i.value)&&(r=this._getOrReturnCtx(e,r),T(r,{code:E.too_big,type:"bigint",maximum:i.value,inclusive:i.inclusive,message:i.message}),a.dirty()):i.kind==="multipleOf"?e.data%i.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),T(r,{code:E.not_multiple_of,multipleOf:i.value,message:i.message}),a.dirty()):te.assertNever(i);return{status:a.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return T(t,{code:E.invalid_type,expected:C.bigint,received:t.parsedType}),V}gte(e,t){return this.setLimit("min",e,!0,j.toString(t))}gt(e,t){return this.setLimit("min",e,!1,j.toString(t))}lte(e,t){return this.setLimit("max",e,!0,j.toString(t))}lt(e,t){return this.setLimit("max",e,!1,j.toString(t))}setLimit(e,t,r,a){return new Qt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:j.toString(a)}]})}_addCheck(e){return new Qt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:j.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:j.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:j.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:j.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:j.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Qt.create=n=>new Qt({checks:[],typeName:O.ZodBigInt,coerce:(n==null?void 0:n.coerce)??!1,...Y(n)});class gi extends ee{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==C.boolean){const r=this._getOrReturnCtx(e);return T(r,{code:E.invalid_type,expected:C.boolean,received:r.parsedType}),V}return Ce(e.data)}}gi.create=n=>new gi({typeName:O.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...Y(n)});class Pr extends ee{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==C.date){const i=this._getOrReturnCtx(e);return T(i,{code:E.invalid_type,expected:C.date,received:i.parsedType}),V}if(Number.isNaN(e.data.getTime())){const i=this._getOrReturnCtx(e);return T(i,{code:E.invalid_date}),V}const r=new Ie;let a;for(const i of this._def.checks)i.kind==="min"?e.data.getTime()<i.value&&(a=this._getOrReturnCtx(e,a),T(a,{code:E.too_small,message:i.message,inclusive:!0,exact:!1,minimum:i.value,type:"date"}),r.dirty()):i.kind==="max"?e.data.getTime()>i.value&&(a=this._getOrReturnCtx(e,a),T(a,{code:E.too_big,message:i.message,inclusive:!0,exact:!1,maximum:i.value,type:"date"}),r.dirty()):te.assertNever(i);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Pr({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:j.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:j.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Pr.create=n=>new Pr({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:O.ZodDate,...Y(n)});class yi extends ee{_parse(e){if(this._getType(e)!==C.symbol){const r=this._getOrReturnCtx(e);return T(r,{code:E.invalid_type,expected:C.symbol,received:r.parsedType}),V}return Ce(e.data)}}yi.create=n=>new yi({typeName:O.ZodSymbol,...Y(n)});class _i extends ee{_parse(e){if(this._getType(e)!==C.undefined){const r=this._getOrReturnCtx(e);return T(r,{code:E.invalid_type,expected:C.undefined,received:r.parsedType}),V}return Ce(e.data)}}_i.create=n=>new _i({typeName:O.ZodUndefined,...Y(n)});class bi extends ee{_parse(e){if(this._getType(e)!==C.null){const r=this._getOrReturnCtx(e);return T(r,{code:E.invalid_type,expected:C.null,received:r.parsedType}),V}return Ce(e.data)}}bi.create=n=>new bi({typeName:O.ZodNull,...Y(n)});class Ea extends ee{constructor(){super(...arguments),this._any=!0}_parse(e){return Ce(e.data)}}Ea.create=n=>new Ea({typeName:O.ZodAny,...Y(n)});class wi extends ee{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ce(e.data)}}wi.create=n=>new wi({typeName:O.ZodUnknown,...Y(n)});class dt extends ee{_parse(e){const t=this._getOrReturnCtx(e);return T(t,{code:E.invalid_type,expected:C.never,received:t.parsedType}),V}}dt.create=n=>new dt({typeName:O.ZodNever,...Y(n)});class vi extends ee{_parse(e){if(this._getType(e)!==C.undefined){const r=this._getOrReturnCtx(e);return T(r,{code:E.invalid_type,expected:C.void,received:r.parsedType}),V}return Ce(e.data)}}vi.create=n=>new vi({typeName:O.ZodVoid,...Y(n)});class Ve extends ee{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==C.array)return T(t,{code:E.invalid_type,expected:C.array,received:t.parsedType}),V;if(a.exactLength!==null){const s=t.data.length>a.exactLength.value,o=t.data.length<a.exactLength.value;(s||o)&&(T(t,{code:s?E.too_big:E.too_small,minimum:o?a.exactLength.value:void 0,maximum:s?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&t.data.length<a.minLength.value&&(T(t,{code:E.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&t.data.length>a.maxLength.value&&(T(t,{code:E.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((s,o)=>a.type._parseAsync(new lt(t,s,t.path,o)))).then(s=>Ie.mergeArray(r,s));const i=[...t.data].map((s,o)=>a.type._parseSync(new lt(t,s,t.path,o)));return Ie.mergeArray(r,i)}get element(){return this._def.type}min(e,t){return new Ve({...this._def,minLength:{value:e,message:j.toString(t)}})}max(e,t){return new Ve({...this._def,maxLength:{value:e,message:j.toString(t)}})}length(e,t){return new Ve({...this._def,exactLength:{value:e,message:j.toString(t)}})}nonempty(e){return this.min(1,e)}}Ve.create=(n,e)=>new Ve({type:n,minLength:null,maxLength:null,exactLength:null,typeName:O.ZodArray,...Y(e)});function vt(n){if(n instanceof ue){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=Qe.create(vt(r))}return new ue({...n._def,shape:()=>e})}else return n instanceof Ve?new Ve({...n._def,type:vt(n.element)}):n instanceof Qe?Qe.create(vt(n.unwrap())):n instanceof kt?kt.create(vt(n.unwrap())):n instanceof bt?bt.create(n.items.map(e=>vt(e))):n}class ue extends ee{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=te.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==C.object){const c=this._getOrReturnCtx(e);return T(c,{code:E.invalid_type,expected:C.object,received:c.parsedType}),V}const{status:r,ctx:a}=this._processInputParams(e),{shape:i,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof dt&&this._def.unknownKeys==="strip"))for(const c in a.data)s.includes(c)||o.push(c);const u=[];for(const c of s){const l=i[c],f=a.data[c];u.push({key:{status:"valid",value:c},value:l._parse(new lt(a,f,a.path,c)),alwaysSet:c in a.data})}if(this._def.catchall instanceof dt){const c=this._def.unknownKeys;if(c==="passthrough")for(const l of o)u.push({key:{status:"valid",value:l},value:{status:"valid",value:a.data[l]}});else if(c==="strict")o.length>0&&(T(a,{code:E.unrecognized_keys,keys:o}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const l of o){const f=a.data[l];u.push({key:{status:"valid",value:l},value:c._parse(new lt(a,f,a.path,l)),alwaysSet:l in a.data})}}return a.common.async?Promise.resolve().then(async()=>{const c=[];for(const l of u){const f=await l.key,d=await l.value;c.push({key:f,value:d,alwaysSet:l.alwaysSet})}return c}).then(c=>Ie.mergeObjectSync(r,c)):Ie.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return j.errToObj,new ue({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var i,s;const a=((s=(i=this._def).errorMap)==null?void 0:s.call(i,t,r).message)??r.defaultError;return t.code==="unrecognized_keys"?{message:j.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new ue({...this._def,unknownKeys:"strip"})}passthrough(){return new ue({...this._def,unknownKeys:"passthrough"})}extend(e){return new ue({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new ue({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:O.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ue({...this._def,catchall:e})}pick(e){const t={};for(const r of te.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new ue({...this._def,shape:()=>t})}omit(e){const t={};for(const r of te.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new ue({...this._def,shape:()=>t})}deepPartial(){return vt(this)}partial(e){const t={};for(const r of te.objectKeys(this.shape)){const a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}return new ue({...this._def,shape:()=>t})}required(e){const t={};for(const r of te.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let i=this.shape[r];for(;i instanceof Qe;)i=i._def.innerType;t[r]=i}return new ue({...this._def,shape:()=>t})}keyof(){return go(te.objectKeys(this.shape))}}ue.create=(n,e)=>new ue({shape:()=>n,unknownKeys:"strip",catchall:dt.create(),typeName:O.ZodObject,...Y(e)});ue.strictCreate=(n,e)=>new ue({shape:()=>n,unknownKeys:"strict",catchall:dt.create(),typeName:O.ZodObject,...Y(e)});ue.lazycreate=(n,e)=>new ue({shape:n,unknownKeys:"strip",catchall:dt.create(),typeName:O.ZodObject,...Y(e)});class Nr extends ee{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function a(i){for(const o of i)if(o.result.status==="valid")return o.result;for(const o of i)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const s=i.map(o=>new rt(o.ctx.common.issues));return T(t,{code:E.invalid_union,unionErrors:s}),V}if(t.common.async)return Promise.all(r.map(async i=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await i._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(a);{let i;const s=[];for(const u of r){const c={...t,common:{...t.common,issues:[]},parent:null},l=u._parseSync({data:t.data,path:t.path,parent:c});if(l.status==="valid")return l;l.status==="dirty"&&!i&&(i={result:l,ctx:c}),c.common.issues.length&&s.push(c.common.issues)}if(i)return t.common.issues.push(...i.ctx.common.issues),i.result;const o=s.map(u=>new rt(u));return T(t,{code:E.invalid_union,unionErrors:o}),V}}get options(){return this._def.options}}Nr.create=(n,e)=>new Nr({options:n,typeName:O.ZodUnion,...Y(e)});function Oa(n,e){const t=ot(n),r=ot(e);if(n===e)return{valid:!0,data:n};if(t===C.object&&r===C.object){const a=te.objectKeys(e),i=te.objectKeys(n).filter(o=>a.indexOf(o)!==-1),s={...n,...e};for(const o of i){const u=Oa(n[o],e[o]);if(!u.valid)return{valid:!1};s[o]=u.data}return{valid:!0,data:s}}else if(t===C.array&&r===C.array){if(n.length!==e.length)return{valid:!1};const a=[];for(let i=0;i<n.length;i++){const s=n[i],o=e[i],u=Oa(s,o);if(!u.valid)return{valid:!1};a.push(u.data)}return{valid:!0,data:a}}else return t===C.date&&r===C.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class Cr extends ee{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),a=(i,s)=>{if(hi(i)||hi(s))return V;const o=Oa(i.value,s.value);return o.valid?((pi(i)||pi(s))&&t.dirty(),{status:t.value,value:o.data}):(T(r,{code:E.invalid_intersection_types}),V)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([i,s])=>a(i,s)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}Cr.create=(n,e,t)=>new Cr({left:n,right:e,typeName:O.ZodIntersection,...Y(t)});class bt extends ee{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==C.array)return T(r,{code:E.invalid_type,expected:C.array,received:r.parsedType}),V;if(r.data.length<this._def.items.length)return T(r,{code:E.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),V;!this._def.rest&&r.data.length>this._def.items.length&&(T(r,{code:E.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const i=[...r.data].map((s,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new lt(r,s,r.path,o)):null}).filter(s=>!!s);return r.common.async?Promise.all(i).then(s=>Ie.mergeArray(t,s)):Ie.mergeArray(t,i)}get items(){return this._def.items}rest(e){return new bt({...this._def,rest:e})}}bt.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new bt({items:n,typeName:O.ZodTuple,rest:null,...Y(e)})};class Ei extends ee{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==C.map)return T(r,{code:E.invalid_type,expected:C.map,received:r.parsedType}),V;const a=this._def.keyType,i=this._def.valueType,s=[...r.data.entries()].map(([o,u],c)=>({key:a._parse(new lt(r,o,r.path,[c,"key"])),value:i._parse(new lt(r,u,r.path,[c,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of s){const c=await u.key,l=await u.value;if(c.status==="aborted"||l.status==="aborted")return V;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const u of s){const c=u.key,l=u.value;if(c.status==="aborted"||l.status==="aborted")return V;(c.status==="dirty"||l.status==="dirty")&&t.dirty(),o.set(c.value,l.value)}return{status:t.value,value:o}}}}Ei.create=(n,e,t)=>new Ei({valueType:e,keyType:n,typeName:O.ZodMap,...Y(t)});class er extends ee{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==C.set)return T(r,{code:E.invalid_type,expected:C.set,received:r.parsedType}),V;const a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(T(r,{code:E.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(T(r,{code:E.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());const i=this._def.valueType;function s(u){const c=new Set;for(const l of u){if(l.status==="aborted")return V;l.status==="dirty"&&t.dirty(),c.add(l.value)}return{status:t.value,value:c}}const o=[...r.data.values()].map((u,c)=>i._parse(new lt(r,u,r.path,c)));return r.common.async?Promise.all(o).then(u=>s(u)):s(o)}min(e,t){return new er({...this._def,minSize:{value:e,message:j.toString(t)}})}max(e,t){return new er({...this._def,maxSize:{value:e,message:j.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}er.create=(n,e)=>new er({valueType:n,minSize:null,maxSize:null,typeName:O.ZodSet,...Y(e)});class Oi extends ee{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Oi.create=(n,e)=>new Oi({getter:n,typeName:O.ZodLazy,...Y(e)});class Si extends ee{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return T(t,{received:t.data,code:E.invalid_literal,expected:this._def.value}),V}return{status:"valid",value:e.data}}get value(){return this._def.value}}Si.create=(n,e)=>new Si({value:n,typeName:O.ZodLiteral,...Y(e)});function go(n,e){return new Tt({values:n,typeName:O.ZodEnum,...Y(e)})}class Tt extends ee{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return T(t,{expected:te.joinValues(r),received:t.parsedType,code:E.invalid_type}),V}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return T(t,{received:t.data,code:E.invalid_enum_value,options:r}),V}return Ce(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Tt.create(e,{...this._def,...t})}exclude(e,t=this._def){return Tt.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}Tt.create=go;class xi extends ee{_parse(e){const t=te.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==C.string&&r.parsedType!==C.number){const a=te.objectValues(t);return T(r,{expected:te.joinValues(a),received:r.parsedType,code:E.invalid_type}),V}if(this._cache||(this._cache=new Set(te.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const a=te.objectValues(t);return T(r,{received:r.data,code:E.invalid_enum_value,options:a}),V}return Ce(e.data)}get enum(){return this._def.values}}xi.create=(n,e)=>new xi({values:n,typeName:O.ZodNativeEnum,...Y(e)});class jr extends ee{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==C.promise&&t.common.async===!1)return T(t,{code:E.invalid_type,expected:C.promise,received:t.parsedType}),V;const r=t.parsedType===C.promise?t.data:Promise.resolve(t.data);return Ce(r.then(a=>this._def.type.parseAsync(a,{path:t.path,errorMap:t.common.contextualErrorMap})))}}jr.create=(n,e)=>new jr({type:n,typeName:O.ZodPromise,...Y(e)});class Rt extends ee{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===O.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,i={addIssue:s=>{T(r,s),s.fatal?t.abort():t.dirty()},get path(){return r.path}};if(i.addIssue=i.addIssue.bind(i),a.type==="preprocess"){const s=a.transform(r.data,i);if(r.common.async)return Promise.resolve(s).then(async o=>{if(t.value==="aborted")return V;const u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?V:u.status==="dirty"||t.value==="dirty"?qt(u.value):u});{if(t.value==="aborted")return V;const o=this._def.schema._parseSync({data:s,path:r.path,parent:r});return o.status==="aborted"?V:o.status==="dirty"||t.value==="dirty"?qt(o.value):o}}if(a.type==="refinement"){const s=o=>{const u=a.refinement(o,i);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?V:(o.status==="dirty"&&t.dirty(),s(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?V:(o.status==="dirty"&&t.dirty(),s(o.value).then(()=>({status:t.value,value:o.value}))))}if(a.type==="transform")if(r.common.async===!1){const s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!It(s))return V;const o=a.transform(s.value,i);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>It(s)?Promise.resolve(a.transform(s.value,i)).then(o=>({status:t.value,value:o})):V);te.assertNever(a)}}Rt.create=(n,e,t)=>new Rt({schema:n,typeName:O.ZodEffects,effect:e,...Y(t)});Rt.createWithPreprocess=(n,e,t)=>new Rt({schema:e,effect:{type:"preprocess",transform:n},typeName:O.ZodEffects,...Y(t)});class Qe extends ee{_parse(e){return this._getType(e)===C.undefined?Ce(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Qe.create=(n,e)=>new Qe({innerType:n,typeName:O.ZodOptional,...Y(e)});class kt extends ee{_parse(e){return this._getType(e)===C.null?Ce(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}kt.create=(n,e)=>new kt({innerType:n,typeName:O.ZodNullable,...Y(e)});class Sa extends ee{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===C.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Sa.create=(n,e)=>new Sa({innerType:n,typeName:O.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Y(e)});class xa extends ee{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Ar(a)?a.then(i=>({status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new rt(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new rt(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}xa.create=(n,e)=>new xa({innerType:n,typeName:O.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Y(e)});class $i extends ee{_parse(e){if(this._getType(e)!==C.nan){const r=this._getOrReturnCtx(e);return T(r,{code:E.invalid_type,expected:C.nan,received:r.parsedType}),V}return{status:"valid",value:e.data}}}$i.create=n=>new $i({typeName:O.ZodNaN,...Y(n)});class Xu extends ee{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class Ga extends ee{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const i=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?V:i.status==="dirty"?(t.dirty(),qt(i.value)):this._def.out._parseAsync({data:i.value,path:r.path,parent:r})})();{const a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?V:a.status==="dirty"?(t.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(e,t){return new Ga({in:e,out:t,typeName:O.ZodPipeline})}}class $a extends ee{_parse(e){const t=this._def.innerType._parse(e),r=a=>(It(a)&&(a.value=Object.freeze(a.value)),a);return Ar(t)?t.then(a=>r(a)):r(t)}unwrap(){return this._def.innerType}}$a.create=(n,e)=>new $a({innerType:n,typeName:O.ZodReadonly,...Y(e)});var O;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(O||(O={}));const yo=ct.create,Ii=Ea.create;dt.create;Ve.create;const _o=ue.create;Nr.create;Cr.create;bt.create;Tt.create;jr.create;Qe.create;kt.create;var Ut={exports:{}},cn={},ln,Ti;function Yu(){if(Ti)return ln;Ti=1;function n(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return ln=n,n.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},n.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},n.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var a=this;return this._timer=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},r),this._options.unref&&this._timer.unref(),!0},n.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},n.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},n.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},n.prototype.start=n.prototype.try,n.prototype.errors=function(){return this._errors},n.prototype.attempts=function(){return this._attempts},n.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var i=this._errors[a],s=i.message,o=(e[s]||0)+1;e[s]=o,o>=r&&(t=i,r=o)}return t},ln}var Ri;function Qu(){return Ri||(Ri=1,function(n){var e=Yu();n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var a in t)r[a]=t[a];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var i=[],s=0;s<r.retries;s++)i.push(this.createTimeout(s,r));return t&&t.forever&&!i.length&&i.push(this.createTimeout(s,r)),i.sort(function(o,u){return o-u}),i},n.createTimeout=function(t,r){var a=r.randomize?Math.random()+1:1,i=Math.round(a*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return i=Math.min(i,r.maxTimeout),i},n.wrap=function(t,r,a){if(r instanceof Array&&(a=r,r=null),!a){a=[];for(var i in t)typeof t[i]=="function"&&a.push(i)}for(var s=0;s<a.length;s++){var o=a[s],u=t[o];t[o]=(function(l){var f=n.operation(r),d=Array.prototype.slice.call(arguments,1),p=d.pop();d.push(function(h){f.retry(h)||(h&&(arguments[0]=f.mainError()),p.apply(this,arguments))}),f.attempt(function(){l.apply(t,d)})}).bind(t,u),t[o].options=r}}}(cn)),cn}var dn,ki;function ec(){return ki||(ki=1,dn=Qu()),dn}var Ai;function tc(){if(Ai)return Ut.exports;Ai=1;const n=ec(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const r=(s,o,u)=>{const c=u.retries-(o-1);return s.attemptNumber=o,s.retriesLeft=c,s},a=s=>e.includes(s),i=(s,o)=>new Promise((u,c)=>{o={onFailedAttempt:()=>{},retries:10,...o};const l=n.operation(o);l.attempt(async f=>{try{u(await s(f))}catch(d){if(!(d instanceof Error)){c(new TypeError(`Non-error was thrown: "${d}". You should only throw errors.`));return}if(d instanceof t)l.stop(),c(d.originalError);else if(d instanceof TypeError&&!a(d.message))l.stop(),c(d);else{r(d,f,o);try{await o.onFailedAttempt(d)}catch(p){c(p);return}l.retry(d)||c(l.mainError())}}})});return Ut.exports=i,Ut.exports.default=i,Ut.exports.AbortError=t,Ut.exports}var rc=tc();const Lr=ir(rc),nc=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function $t(n){return typeof n=="string"&&nc.test(n)}function ac(n){if(!$t(n))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var me=[];for(var fn=0;fn<256;++fn)me.push((fn+256).toString(16).slice(1));function bo(n,e=0){return(me[n[e+0]]+me[n[e+1]]+me[n[e+2]]+me[n[e+3]]+"-"+me[n[e+4]]+me[n[e+5]]+"-"+me[n[e+6]]+me[n[e+7]]+"-"+me[n[e+8]]+me[n[e+9]]+"-"+me[n[e+10]]+me[n[e+11]]+me[n[e+12]]+me[n[e+13]]+me[n[e+14]]+me[n[e+15]]).toLowerCase()}var br,ic=new Uint8Array(16);function sc(){if(!br&&(br=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!br))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return br(ic)}function oc(n){n=unescape(encodeURIComponent(n));for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}var uc="6ba7b810-9dad-11d1-80b4-00c04fd430c8",cc="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function lc(n,e,t){function r(a,i,s,o){var u;if(typeof a=="string"&&(a=oc(a)),typeof i=="string"&&(i=ac(i)),((u=i)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+a.length);if(c.set(i),c.set(a,i.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,s){o=o||0;for(var l=0;l<16;++l)s[o+l]=c[l];return s}return bo(c)}try{r.name=n}catch{}return r.DNS=uc,r.URL=cc,r}var dc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const Pi={randomUUID:dc};function be(n,e,t){if(Pi.randomUUID&&!n)return Pi.randomUUID();n=n||{};var r=n.random||(n.rng||sc)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,bo(r)}function fc(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function hn(n,e){return n<<e|n>>>32-e}function hc(n){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){var r=unescape(encodeURIComponent(n));n=[];for(var a=0;a<r.length;++a)n.push(r.charCodeAt(a))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);for(var i=n.length/4+2,s=Math.ceil(i/16),o=new Array(s),u=0;u<s;++u){for(var c=new Uint32Array(16),l=0;l<16;++l)c[l]=n[u*64+l*4]<<24|n[u*64+l*4+1]<<16|n[u*64+l*4+2]<<8|n[u*64+l*4+3];o[u]=c}o[s-1][14]=(n.length-1)*8/Math.pow(2,32),o[s-1][14]=Math.floor(o[s-1][14]),o[s-1][15]=(n.length-1)*8&4294967295;for(var f=0;f<s;++f){for(var d=new Uint32Array(80),p=0;p<16;++p)d[p]=o[f][p];for(var h=16;h<80;++h)d[h]=hn(d[h-3]^d[h-8]^d[h-14]^d[h-16],1);for(var g=t[0],y=t[1],m=t[2],b=t[3],_=t[4],v=0;v<80;++v){var w=Math.floor(v/20),x=hn(g,5)+fc(w,y,m,b)+_+e[w]+d[v]>>>0;_=b,b=m,m=hn(y,30)>>>0,y=g,g=x}t[0]=t[0]+g>>>0,t[1]=t[1]+y>>>0,t[2]=t[2]+m>>>0,t[3]=t[3]+b>>>0,t[4]=t[4]+_>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var Ni=lc("v5",80,hc),wr={},pn={exports:{}},Ci;function pc(){return Ci||(Ci=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function a(u,c,l){this.fn=u,this.context=c,this.once=l||!1}function i(u,c,l,f,d){if(typeof l!="function")throw new TypeError("The listener must be a function");var p=new a(l,f||u,d),h=t?t+c:c;return u._events[h]?u._events[h].fn?u._events[h]=[u._events[h],p]:u._events[h].push(p):(u._events[h]=p,u._eventsCount++),u}function s(u,c){--u._eventsCount===0?u._events=new r:delete u._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],l,f;if(this._eventsCount===0)return c;for(f in l=this._events)e.call(l,f)&&c.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(l)):c},o.prototype.listeners=function(c){var l=t?t+c:c,f=this._events[l];if(!f)return[];if(f.fn)return[f.fn];for(var d=0,p=f.length,h=new Array(p);d<p;d++)h[d]=f[d].fn;return h},o.prototype.listenerCount=function(c){var l=t?t+c:c,f=this._events[l];return f?f.fn?1:f.length:0},o.prototype.emit=function(c,l,f,d,p,h){var g=t?t+c:c;if(!this._events[g])return!1;var y=this._events[g],m=arguments.length,b,_;if(y.fn){switch(y.once&&this.removeListener(c,y.fn,void 0,!0),m){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,l),!0;case 3:return y.fn.call(y.context,l,f),!0;case 4:return y.fn.call(y.context,l,f,d),!0;case 5:return y.fn.call(y.context,l,f,d,p),!0;case 6:return y.fn.call(y.context,l,f,d,p,h),!0}for(_=1,b=new Array(m-1);_<m;_++)b[_-1]=arguments[_];y.fn.apply(y.context,b)}else{var v=y.length,w;for(_=0;_<v;_++)switch(y[_].once&&this.removeListener(c,y[_].fn,void 0,!0),m){case 1:y[_].fn.call(y[_].context);break;case 2:y[_].fn.call(y[_].context,l);break;case 3:y[_].fn.call(y[_].context,l,f);break;case 4:y[_].fn.call(y[_].context,l,f,d);break;default:if(!b)for(w=1,b=new Array(m-1);w<m;w++)b[w-1]=arguments[w];y[_].fn.apply(y[_].context,b)}}return!0},o.prototype.on=function(c,l,f){return i(this,c,l,f,!1)},o.prototype.once=function(c,l,f){return i(this,c,l,f,!0)},o.prototype.removeListener=function(c,l,f,d){var p=t?t+c:c;if(!this._events[p])return this;if(!l)return s(this,p),this;var h=this._events[p];if(h.fn)h.fn===l&&(!d||h.once)&&(!f||h.context===f)&&s(this,p);else{for(var g=0,y=[],m=h.length;g<m;g++)(h[g].fn!==l||d&&!h[g].once||f&&h[g].context!==f)&&y.push(h[g]);y.length?this._events[p]=y.length===1?y[0]:y:s(this,p)}return this},o.prototype.removeAllListeners=function(c){var l;return c?(l=t?t+c:c,this._events[l]&&s(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o}(pn)),pn.exports}var Ft={exports:{}},mn,ji;function mc(){return ji||(ji=1,mn=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})))),mn}var Li;function gc(){if(Li)return Ft.exports;Li=1;const n=mc();class e extends Error{constructor(a){super(a),this.name="TimeoutError"}}const t=(r,a,i)=>new Promise((s,o)=>{if(typeof a!="number"||a<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(a===1/0){s(r);return}const u=setTimeout(()=>{if(typeof i=="function"){try{s(i())}catch(f){o(f)}return}const c=typeof i=="string"?i:`Promise timed out after ${a} milliseconds`,l=i instanceof Error?i:new e(c);typeof r.cancel=="function"&&r.cancel(),o(l)},a);n(r.then(s,o),()=>{clearTimeout(u)})});return Ft.exports=t,Ft.exports.default=t,Ft.exports.TimeoutError=e,Ft.exports}var vr={},Er={},Mi;function yc(){if(Mi)return Er;Mi=1,Object.defineProperty(Er,"__esModule",{value:!0});function n(e,t,r){let a=0,i=e.length;for(;i>0;){const s=i/2|0;let o=a+s;r(e[o],t)<=0?(a=++o,i-=s+1):i=s}return a}return Er.default=n,Er}var Di;function _c(){if(Di)return vr;Di=1,Object.defineProperty(vr,"__esModule",{value:!0});const n=yc();class e{constructor(){this._queue=[]}enqueue(r,a){a=Object.assign({priority:0},a);const i={priority:a.priority,run:r};if(this.size&&this._queue[this.size-1].priority>=a.priority){this._queue.push(i);return}const s=n.default(this._queue,i,(o,u)=>u.priority-o.priority);this._queue.splice(s,0,i)}dequeue(){const r=this._queue.shift();return r==null?void 0:r.run}filter(r){return this._queue.filter(a=>a.priority===r.priority).map(a=>a.run)}get size(){return this._queue.length}}return vr.default=e,vr}var Ui;function bc(){if(Ui)return wr;Ui=1,Object.defineProperty(wr,"__esModule",{value:!0});const n=pc(),e=gc(),t=_c(),r=()=>{},a=new e.TimeoutError;class i extends n{constructor(o){var u,c,l,f;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=r,this._resolveIdle=r,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(c=(u=o.intervalCap)===null||u===void 0?void 0:u.toString())!==null&&c!==void 0?c:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(f=(l=o.interval)===null||l===void 0?void 0:l.toString())!==null&&f!==void 0?f:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=r,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=r,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const u=this._intervalEnd-o;if(u<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},u)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const u=this._queue.dequeue();return u?(this.emit("active"),u(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,u={}){return new Promise((c,l)=>{const f=async()=>{this._pendingCount++,this._intervalCount++;try{const d=this._timeout===void 0&&u.timeout===void 0?o():e.default(Promise.resolve(o()),u.timeout===void 0?this._timeout:u.timeout,()=>{(u.throwOnTimeout===void 0?this._throwOnTimeout:u.throwOnTimeout)&&l(a)});c(await d)}catch(d){l(d)}this._next()};this._queue.enqueue(f,u),this._tryToStartAnother(),this.emit("add")})}async addAll(o,u){return Promise.all(o.map(async c=>this.add(c,u)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const u=this._resolveEmpty;this._resolveEmpty=()=>{u(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const u=this._resolveIdle;this._resolveIdle=()=>{u(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return wr.default=i,wr}var wc=bc();const et=ir(wc),wo=()=>Ge("PROJECT")??ft("LANGCHAIN_SESSION")??"default",vo="0.3.33";var Gt={};let Ye;const vc=()=>typeof window<"u"&&typeof window.document<"u",Ec=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",Oc=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),Eo=()=>typeof Deno<"u",Sc=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Eo(),xc=()=>Ye||(vc()?Ye="browser":Sc()?Ye="node":Ec()?Ye="webworker":Oc()?Ye="jsdom":Eo()?Ye="deno":Ye="other",Ye);let gn;function Oo(){if(gn===void 0){const n=xc(),e=Tc();gn={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:vo,...e}}return gn}function $c(){const n=Ic()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,a]of Object.entries(n))(r.startsWith("LANGCHAIN_")||r.startsWith("LANGSMITH_"))&&typeof a=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=a:e[r]=a);return e}function Ic(){try{return typeof process<"u"&&Gt?Object.entries(Gt).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function ft(n){try{return typeof process<"u"?Gt==null?void 0:Gt[n]:void 0}catch{return}}function Ge(n){return ft(`LANGSMITH_${n}`)||ft(`LANGCHAIN_${n}`)}let yn;function Tc(){if(yn!==void 0)return yn;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=ft(t);r!==void 0&&(e[t]=r)}return yn=e,e}const Rc=(...n)=>fetch(...n),So=Symbol.for("ls:fetch_implementation"),kc=()=>{const n=globalThis[So];return n?typeof n=="function"&&"Headers"in n&&"Request"in n&&"Response"in n:!1},M=n=>async(...e)=>{if(n||Ge("DEBUG")==="true"){const[r,a]=e;console.log(` ${(a==null?void 0:a.method)||"GET"} ${r}`)}const t=await(globalThis[So]??Rc)(...e);return(n||Ge("DEBUG")==="true")&&console.log(` ${t.status} ${t.statusText} ${t.url}`),t},Ac=[400,401,403,404,405,406,407,408],Pc=[409];let Fi=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.debug=e.debug,"default"in et?this.queue=new et.default({concurrency:this.maxConcurrency}):this.queue=new et({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add(()=>Lr(()=>e(...t).catch(a=>{throw a instanceof Error?a:new Error(a)}),{async onFailedAttempt(a){if(a.message.startsWith("Cancel")||a.message.startsWith("TimeoutError")||a.message.startsWith("AbortError")||(a==null?void 0:a.code)==="ECONNABORTED")throw a;const i=a==null?void 0:a.response,s=i==null?void 0:i.status;if(s){if(Ac.includes(+s))throw a;if(Pc.includes(+s))return;r&&await r(i)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((a,i)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>M(this.debug)(...e).then(t=>t.ok?t:Promise.reject(t)))}};function zi(n){return typeof(n==null?void 0:n._getType)=="function"}function Bi(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}function J(n,e){if(!$t(n)){const t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}const qi={};function xo(n){qi[n]||(console.warn(n),qi[n]=!0)}var Or={exports:{}},_n,Zi;function Hr(){if(Zi)return _n;Zi=1;const n="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,r=16,a=e-6;return _n={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:a,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:n,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},_n}var bn,Hi;function Gr(){if(Hi)return bn;Hi=1;var n={};return bn=typeof process=="object"&&n&&n.NODE_DEBUG&&/\bsemver\b/i.test(n.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},bn}var Gi;function cr(){return Gi||(Gi=1,function(n,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:a}=Hr(),i=Gr();e=n.exports={};const s=e.re=[],o=e.safeRe=[],u=e.src=[],c=e.safeSrc=[],l=e.t={};let f=0;const d="[a-zA-Z0-9-]",p=[["\\s",1],["\\d",a],[d,r]],h=y=>{for(const[m,b]of p)y=y.split(`${m}*`).join(`${m}{0,${b}}`).split(`${m}+`).join(`${m}{1,${b}}`);return y},g=(y,m,b)=>{const _=h(m),v=f++;i(y,v,m),l[y]=v,u[v]=m,c[v]=_,s[v]=new RegExp(m,b?"g":void 0),o[v]=new RegExp(_,b?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${d}*`),g("MAINVERSION",`(${u[l.NUMERICIDENTIFIER]})\\.(${u[l.NUMERICIDENTIFIER]})\\.(${u[l.NUMERICIDENTIFIER]})`),g("MAINVERSIONLOOSE",`(${u[l.NUMERICIDENTIFIERLOOSE]})\\.(${u[l.NUMERICIDENTIFIERLOOSE]})\\.(${u[l.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASEIDENTIFIER",`(?:${u[l.NONNUMERICIDENTIFIER]}|${u[l.NUMERICIDENTIFIER]})`),g("PRERELEASEIDENTIFIERLOOSE",`(?:${u[l.NONNUMERICIDENTIFIER]}|${u[l.NUMERICIDENTIFIERLOOSE]})`),g("PRERELEASE",`(?:-(${u[l.PRERELEASEIDENTIFIER]}(?:\\.${u[l.PRERELEASEIDENTIFIER]})*))`),g("PRERELEASELOOSE",`(?:-?(${u[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[l.PRERELEASEIDENTIFIERLOOSE]})*))`),g("BUILDIDENTIFIER",`${d}+`),g("BUILD",`(?:\\+(${u[l.BUILDIDENTIFIER]}(?:\\.${u[l.BUILDIDENTIFIER]})*))`),g("FULLPLAIN",`v?${u[l.MAINVERSION]}${u[l.PRERELEASE]}?${u[l.BUILD]}?`),g("FULL",`^${u[l.FULLPLAIN]}$`),g("LOOSEPLAIN",`[v=\\s]*${u[l.MAINVERSIONLOOSE]}${u[l.PRERELEASELOOSE]}?${u[l.BUILD]}?`),g("LOOSE",`^${u[l.LOOSEPLAIN]}$`),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE",`${u[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),g("XRANGEIDENTIFIER",`${u[l.NUMERICIDENTIFIER]}|x|X|\\*`),g("XRANGEPLAIN",`[v=\\s]*(${u[l.XRANGEIDENTIFIER]})(?:\\.(${u[l.XRANGEIDENTIFIER]})(?:\\.(${u[l.XRANGEIDENTIFIER]})(?:${u[l.PRERELEASE]})?${u[l.BUILD]}?)?)?`),g("XRANGEPLAINLOOSE",`[v=\\s]*(${u[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[l.XRANGEIDENTIFIERLOOSE]})(?:${u[l.PRERELEASELOOSE]})?${u[l.BUILD]}?)?)?`),g("XRANGE",`^${u[l.GTLT]}\\s*${u[l.XRANGEPLAIN]}$`),g("XRANGELOOSE",`^${u[l.GTLT]}\\s*${u[l.XRANGEPLAINLOOSE]}$`),g("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),g("COERCE",`${u[l.COERCEPLAIN]}(?:$|[^\\d])`),g("COERCEFULL",u[l.COERCEPLAIN]+`(?:${u[l.PRERELEASE]})?(?:${u[l.BUILD]})?(?:$|[^\\d])`),g("COERCERTL",u[l.COERCE],!0),g("COERCERTLFULL",u[l.COERCEFULL],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM",`(\\s*)${u[l.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",g("TILDE",`^${u[l.LONETILDE]}${u[l.XRANGEPLAIN]}$`),g("TILDELOOSE",`^${u[l.LONETILDE]}${u[l.XRANGEPLAINLOOSE]}$`),g("LONECARET","(?:\\^)"),g("CARETTRIM",`(\\s*)${u[l.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",g("CARET",`^${u[l.LONECARET]}${u[l.XRANGEPLAIN]}$`),g("CARETLOOSE",`^${u[l.LONECARET]}${u[l.XRANGEPLAINLOOSE]}$`),g("COMPARATORLOOSE",`^${u[l.GTLT]}\\s*(${u[l.LOOSEPLAIN]})$|^$`),g("COMPARATOR",`^${u[l.GTLT]}\\s*(${u[l.FULLPLAIN]})$|^$`),g("COMPARATORTRIM",`(\\s*)${u[l.GTLT]}\\s*(${u[l.LOOSEPLAIN]}|${u[l.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE",`^\\s*(${u[l.XRANGEPLAIN]})\\s+-\\s+(${u[l.XRANGEPLAIN]})\\s*$`),g("HYPHENRANGELOOSE",`^\\s*(${u[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[l.XRANGEPLAINLOOSE]})\\s*$`),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Or,Or.exports)),Or.exports}var wn,Vi;function Va(){if(Vi)return wn;Vi=1;const n=Object.freeze({loose:!0}),e=Object.freeze({});return wn=r=>r?typeof r!="object"?n:r:e,wn}var vn,Ji;function $o(){if(Ji)return vn;Ji=1;const n=/^[0-9]+$/,e=(r,a)=>{const i=n.test(r),s=n.test(a);return i&&s&&(r=+r,a=+a),r===a?0:i&&!s?-1:s&&!i?1:r<a?-1:1};return vn={compareIdentifiers:e,rcompareIdentifiers:(r,a)=>e(a,r)},vn}var En,Wi;function ve(){if(Wi)return En;Wi=1;const n=Gr(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=Hr(),{safeRe:r,t:a}=cr(),i=Va(),{compareIdentifiers:s}=$o();class o{constructor(c,l){if(l=i(l),c instanceof o){if(c.loose===!!l.loose&&c.includePrerelease===!!l.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>e)throw new TypeError(`version is longer than ${e} characters`);n("SemVer",c,l),this.options=l,this.loose=!!l.loose,this.includePrerelease=!!l.includePrerelease;const f=c.trim().match(l.loose?r[a.LOOSE]:r[a.FULL]);if(!f)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+f[1],this.minor=+f[2],this.patch=+f[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");f[4]?this.prerelease=f[4].split(".").map(d=>{if(/^[0-9]+$/.test(d)){const p=+d;if(p>=0&&p<t)return p}return d}):this.prerelease=[],this.build=f[5]?f[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(n("SemVer.compare",this.version,this.options,c),!(c instanceof o)){if(typeof c=="string"&&c===this.version)return 0;c=new o(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof o||(c=new o(c,this.options)),s(this.major,c.major)||s(this.minor,c.minor)||s(this.patch,c.patch)}comparePre(c){if(c instanceof o||(c=new o(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let l=0;do{const f=this.prerelease[l],d=c.prerelease[l];if(n("prerelease compare",l,f,d),f===void 0&&d===void 0)return 0;if(d===void 0)return 1;if(f===void 0)return-1;if(f===d)continue;return s(f,d)}while(++l)}compareBuild(c){c instanceof o||(c=new o(c,this.options));let l=0;do{const f=this.build[l],d=c.build[l];if(n("build compare",l,f,d),f===void 0&&d===void 0)return 0;if(d===void 0)return 1;if(f===void 0)return-1;if(f===d)continue;return s(f,d)}while(++l)}inc(c,l,f){if(c.startsWith("pre")){if(!l&&f===!1)throw new Error("invalid increment argument: identifier is empty");if(l){const d=`-${l}`.match(this.options.loose?r[a.PRERELEASELOOSE]:r[a.PRERELEASE]);if(!d||d[1]!==l)throw new Error(`invalid identifier: ${l}`)}}switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",l,f);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",l,f);break;case"prepatch":this.prerelease.length=0,this.inc("patch",l,f),this.inc("pre",l,f);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",l,f),this.inc("pre",l,f);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const d=Number(f)?1:0;if(this.prerelease.length===0)this.prerelease=[d];else{let p=this.prerelease.length;for(;--p>=0;)typeof this.prerelease[p]=="number"&&(this.prerelease[p]++,p=-2);if(p===-1){if(l===this.prerelease.join(".")&&f===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(d)}}if(l){let p=[l,d];f===!1&&(p=[l]),s(this.prerelease[0],l)===0?isNaN(this.prerelease[1])&&(this.prerelease=p):this.prerelease=p}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return En=o,En}var On,Ki;function Ct(){if(Ki)return On;Ki=1;const n=ve();return On=(t,r,a=!1)=>{if(t instanceof n)return t;try{return new n(t,r)}catch(i){if(!a)return null;throw i}},On}var Sn,Xi;function Nc(){if(Xi)return Sn;Xi=1;const n=Ct();return Sn=(t,r)=>{const a=n(t,r);return a?a.version:null},Sn}var xn,Yi;function Cc(){if(Yi)return xn;Yi=1;const n=Ct();return xn=(t,r)=>{const a=n(t.trim().replace(/^[=v]+/,""),r);return a?a.version:null},xn}var $n,Qi;function jc(){if(Qi)return $n;Qi=1;const n=ve();return $n=(t,r,a,i,s)=>{typeof a=="string"&&(s=i,i=a,a=void 0);try{return new n(t instanceof n?t.version:t,a).inc(r,i,s).version}catch{return null}},$n}var In,es;function Lc(){if(es)return In;es=1;const n=Ct();return In=(t,r)=>{const a=n(t,null,!0),i=n(r,null,!0),s=a.compare(i);if(s===0)return null;const o=s>0,u=o?a:i,c=o?i:a,l=!!u.prerelease.length;if(!!c.prerelease.length&&!l){if(!c.patch&&!c.minor)return"major";if(c.compareMain(u)===0)return c.minor&&!c.patch?"minor":"patch"}const d=l?"pre":"";return a.major!==i.major?d+"major":a.minor!==i.minor?d+"minor":a.patch!==i.patch?d+"patch":"prerelease"},In}var Tn,ts;function Mc(){if(ts)return Tn;ts=1;const n=ve();return Tn=(t,r)=>new n(t,r).major,Tn}var Rn,rs;function Dc(){if(rs)return Rn;rs=1;const n=ve();return Rn=(t,r)=>new n(t,r).minor,Rn}var kn,ns;function Uc(){if(ns)return kn;ns=1;const n=ve();return kn=(t,r)=>new n(t,r).patch,kn}var An,as;function Fc(){if(as)return An;as=1;const n=Ct();return An=(t,r)=>{const a=n(t,r);return a&&a.prerelease.length?a.prerelease:null},An}var Pn,is;function Be(){if(is)return Pn;is=1;const n=ve();return Pn=(t,r,a)=>new n(t,a).compare(new n(r,a)),Pn}var Nn,ss;function zc(){if(ss)return Nn;ss=1;const n=Be();return Nn=(t,r,a)=>n(r,t,a),Nn}var Cn,os;function Bc(){if(os)return Cn;os=1;const n=Be();return Cn=(t,r)=>n(t,r,!0),Cn}var jn,us;function Ja(){if(us)return jn;us=1;const n=ve();return jn=(t,r,a)=>{const i=new n(t,a),s=new n(r,a);return i.compare(s)||i.compareBuild(s)},jn}var Ln,cs;function qc(){if(cs)return Ln;cs=1;const n=Ja();return Ln=(t,r)=>t.sort((a,i)=>n(a,i,r)),Ln}var Mn,ls;function Zc(){if(ls)return Mn;ls=1;const n=Ja();return Mn=(t,r)=>t.sort((a,i)=>n(i,a,r)),Mn}var Dn,ds;function Vr(){if(ds)return Dn;ds=1;const n=Be();return Dn=(t,r,a)=>n(t,r,a)>0,Dn}var Un,fs;function Wa(){if(fs)return Un;fs=1;const n=Be();return Un=(t,r,a)=>n(t,r,a)<0,Un}var Fn,hs;function Io(){if(hs)return Fn;hs=1;const n=Be();return Fn=(t,r,a)=>n(t,r,a)===0,Fn}var zn,ps;function To(){if(ps)return zn;ps=1;const n=Be();return zn=(t,r,a)=>n(t,r,a)!==0,zn}var Bn,ms;function Ka(){if(ms)return Bn;ms=1;const n=Be();return Bn=(t,r,a)=>n(t,r,a)>=0,Bn}var qn,gs;function Xa(){if(gs)return qn;gs=1;const n=Be();return qn=(t,r,a)=>n(t,r,a)<=0,qn}var Zn,ys;function Ro(){if(ys)return Zn;ys=1;const n=Io(),e=To(),t=Vr(),r=Ka(),a=Wa(),i=Xa();return Zn=(o,u,c,l)=>{switch(u){case"===":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o===c;case"!==":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o!==c;case"":case"=":case"==":return n(o,c,l);case"!=":return e(o,c,l);case">":return t(o,c,l);case">=":return r(o,c,l);case"<":return a(o,c,l);case"<=":return i(o,c,l);default:throw new TypeError(`Invalid operator: ${u}`)}},Zn}var Hn,_s;function Hc(){if(_s)return Hn;_s=1;const n=ve(),e=Ct(),{safeRe:t,t:r}=cr();return Hn=(i,s)=>{if(i instanceof n)return i;if(typeof i=="number"&&(i=String(i)),typeof i!="string")return null;s=s||{};let o=null;if(!s.rtl)o=i.match(s.includePrerelease?t[r.COERCEFULL]:t[r.COERCE]);else{const p=s.includePrerelease?t[r.COERCERTLFULL]:t[r.COERCERTL];let h;for(;(h=p.exec(i))&&(!o||o.index+o[0].length!==i.length);)(!o||h.index+h[0].length!==o.index+o[0].length)&&(o=h),p.lastIndex=h.index+h[1].length+h[2].length;p.lastIndex=-1}if(o===null)return null;const u=o[2],c=o[3]||"0",l=o[4]||"0",f=s.includePrerelease&&o[5]?`-${o[5]}`:"",d=s.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${u}.${c}.${l}${f}${d}`,s)},Hn}var Gn,bs;function Gc(){if(bs)return Gn;bs=1;class n{constructor(){this.max=1e3,this.map=new Map}get(t){const r=this.map.get(t);if(r!==void 0)return this.map.delete(t),this.map.set(t,r),r}delete(t){return this.map.delete(t)}set(t,r){if(!this.delete(t)&&r!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(t,r)}return this}}return Gn=n,Gn}var Vn,ws;function qe(){if(ws)return Vn;ws=1;const n=/\s+/g;class e{constructor(S,D){if(D=a(D),S instanceof e)return S.loose===!!D.loose&&S.includePrerelease===!!D.includePrerelease?S:new e(S.raw,D);if(S instanceof i)return this.raw=S.value,this.set=[[S]],this.formatted=void 0,this;if(this.options=D,this.loose=!!D.loose,this.includePrerelease=!!D.includePrerelease,this.raw=S.trim().replace(n," "),this.set=this.raw.split("||").map(P=>this.parseRange(P.trim())).filter(P=>P.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const P=this.set[0];if(this.set=this.set.filter(U=>!g(U[0])),this.set.length===0)this.set=[P];else if(this.set.length>1){for(const U of this.set)if(U.length===1&&y(U[0])){this.set=[U];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let S=0;S<this.set.length;S++){S>0&&(this.formatted+="||");const D=this.set[S];for(let P=0;P<D.length;P++)P>0&&(this.formatted+=" "),this.formatted+=D[P].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(S){const P=((this.options.includePrerelease&&p)|(this.options.loose&&h))+":"+S,U=r.get(P);if(U)return U;const N=this.options.loose,z=N?u[c.HYPHENRANGELOOSE]:u[c.HYPHENRANGE];S=S.replace(z,We(this.options.includePrerelease)),s("hyphen replace",S),S=S.replace(u[c.COMPARATORTRIM],l),s("comparator trim",S),S=S.replace(u[c.TILDETRIM],f),s("tilde trim",S),S=S.replace(u[c.CARETTRIM],d),s("caret trim",S);let X=S.split(" ").map(Q=>b(Q,this.options)).join(" ").split(/\s+/).map(Q=>ke(Q,this.options));N&&(X=X.filter(Q=>(s("loose invalid filter",Q,this.options),!!Q.match(u[c.COMPARATORLOOSE])))),s("range list",X);const G=new Map,re=X.map(Q=>new i(Q,this.options));for(const Q of re){if(g(Q))return[Q];G.set(Q.value,Q)}G.size>1&&G.has("")&&G.delete("");const oe=[...G.values()];return r.set(P,oe),oe}intersects(S,D){if(!(S instanceof e))throw new TypeError("a Range is required");return this.set.some(P=>m(P,D)&&S.set.some(U=>m(U,D)&&P.every(N=>U.every(z=>N.intersects(z,D)))))}test(S){if(!S)return!1;if(typeof S=="string")try{S=new o(S,this.options)}catch{return!1}for(let D=0;D<this.set.length;D++)if(Ke(this.set[D],S,this.options))return!0;return!1}}Vn=e;const t=Gc(),r=new t,a=Va(),i=Jr(),s=Gr(),o=ve(),{safeRe:u,t:c,comparatorTrimReplace:l,tildeTrimReplace:f,caretTrimReplace:d}=cr(),{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:h}=Hr(),g=I=>I.value==="<0.0.0-0",y=I=>I.value==="",m=(I,S)=>{let D=!0;const P=I.slice();let U=P.pop();for(;D&&P.length;)D=P.every(N=>U.intersects(N,S)),U=P.pop();return D},b=(I,S)=>(s("comp",I,S),I=x(I,S),s("caret",I),I=v(I,S),s("tildes",I),I=k(I,S),s("xrange",I),I=Re(I,S),s("stars",I),I),_=I=>!I||I.toLowerCase()==="x"||I==="*",v=(I,S)=>I.trim().split(/\s+/).map(D=>w(D,S)).join(" "),w=(I,S)=>{const D=S.loose?u[c.TILDELOOSE]:u[c.TILDE];return I.replace(D,(P,U,N,z,X)=>{s("tilde",I,P,U,N,z,X);let G;return _(U)?G="":_(N)?G=`>=${U}.0.0 <${+U+1}.0.0-0`:_(z)?G=`>=${U}.${N}.0 <${U}.${+N+1}.0-0`:X?(s("replaceTilde pr",X),G=`>=${U}.${N}.${z}-${X} <${U}.${+N+1}.0-0`):G=`>=${U}.${N}.${z} <${U}.${+N+1}.0-0`,s("tilde return",G),G})},x=(I,S)=>I.trim().split(/\s+/).map(D=>L(D,S)).join(" "),L=(I,S)=>{s("caret",I,S);const D=S.loose?u[c.CARETLOOSE]:u[c.CARET],P=S.includePrerelease?"-0":"";return I.replace(D,(U,N,z,X,G)=>{s("caret",I,U,N,z,X,G);let re;return _(N)?re="":_(z)?re=`>=${N}.0.0${P} <${+N+1}.0.0-0`:_(X)?N==="0"?re=`>=${N}.${z}.0${P} <${N}.${+z+1}.0-0`:re=`>=${N}.${z}.0${P} <${+N+1}.0.0-0`:G?(s("replaceCaret pr",G),N==="0"?z==="0"?re=`>=${N}.${z}.${X}-${G} <${N}.${z}.${+X+1}-0`:re=`>=${N}.${z}.${X}-${G} <${N}.${+z+1}.0-0`:re=`>=${N}.${z}.${X}-${G} <${+N+1}.0.0-0`):(s("no pr"),N==="0"?z==="0"?re=`>=${N}.${z}.${X}${P} <${N}.${z}.${+X+1}-0`:re=`>=${N}.${z}.${X}${P} <${N}.${+z+1}.0-0`:re=`>=${N}.${z}.${X} <${+N+1}.0.0-0`),s("caret return",re),re})},k=(I,S)=>(s("replaceXRanges",I,S),I.split(/\s+/).map(D=>le(D,S)).join(" ")),le=(I,S)=>{I=I.trim();const D=S.loose?u[c.XRANGELOOSE]:u[c.XRANGE];return I.replace(D,(P,U,N,z,X,G)=>{s("xRange",I,P,U,N,z,X,G);const re=_(N),oe=re||_(z),Q=oe||_(X),xe=Q;return U==="="&&xe&&(U=""),G=S.includePrerelease?"-0":"",re?U===">"||U==="<"?P="<0.0.0-0":P="*":U&&xe?(oe&&(z=0),X=0,U===">"?(U=">=",oe?(N=+N+1,z=0,X=0):(z=+z+1,X=0)):U==="<="&&(U="<",oe?N=+N+1:z=+z+1),U==="<"&&(G="-0"),P=`${U+N}.${z}.${X}${G}`):oe?P=`>=${N}.0.0${G} <${+N+1}.0.0-0`:Q&&(P=`>=${N}.${z}.0${G} <${N}.${+z+1}.0-0`),s("xRange return",P),P})},Re=(I,S)=>(s("replaceStars",I,S),I.trim().replace(u[c.STAR],"")),ke=(I,S)=>(s("replaceGTE0",I,S),I.trim().replace(u[S.includePrerelease?c.GTE0PRE:c.GTE0],"")),We=I=>(S,D,P,U,N,z,X,G,re,oe,Q,xe)=>(_(P)?D="":_(U)?D=`>=${P}.0.0${I?"-0":""}`:_(N)?D=`>=${P}.${U}.0${I?"-0":""}`:z?D=`>=${D}`:D=`>=${D}${I?"-0":""}`,_(re)?G="":_(oe)?G=`<${+re+1}.0.0-0`:_(Q)?G=`<${re}.${+oe+1}.0-0`:xe?G=`<=${re}.${oe}.${Q}-${xe}`:I?G=`<${re}.${oe}.${+Q+1}-0`:G=`<=${G}`,`${D} ${G}`.trim()),Ke=(I,S,D)=>{for(let P=0;P<I.length;P++)if(!I[P].test(S))return!1;if(S.prerelease.length&&!D.includePrerelease){for(let P=0;P<I.length;P++)if(s(I[P].semver),I[P].semver!==i.ANY&&I[P].semver.prerelease.length>0){const U=I[P].semver;if(U.major===S.major&&U.minor===S.minor&&U.patch===S.patch)return!0}return!1}return!0};return Vn}var Jn,vs;function Jr(){if(vs)return Jn;vs=1;const n=Symbol("SemVer ANY");class e{static get ANY(){return n}constructor(l,f){if(f=t(f),l instanceof e){if(l.loose===!!f.loose)return l;l=l.value}l=l.trim().split(/\s+/).join(" "),s("comparator",l,f),this.options=f,this.loose=!!f.loose,this.parse(l),this.semver===n?this.value="":this.value=this.operator+this.semver.version,s("comp",this)}parse(l){const f=this.options.loose?r[a.COMPARATORLOOSE]:r[a.COMPARATOR],d=l.match(f);if(!d)throw new TypeError(`Invalid comparator: ${l}`);this.operator=d[1]!==void 0?d[1]:"",this.operator==="="&&(this.operator=""),d[2]?this.semver=new o(d[2],this.options.loose):this.semver=n}toString(){return this.value}test(l){if(s("Comparator.test",l,this.options.loose),this.semver===n||l===n)return!0;if(typeof l=="string")try{l=new o(l,this.options)}catch{return!1}return i(l,this.operator,this.semver,this.options)}intersects(l,f){if(!(l instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(l.value,f).test(this.value):l.operator===""?l.value===""?!0:new u(this.value,f).test(l.semver):(f=t(f),f.includePrerelease&&(this.value==="<0.0.0-0"||l.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||l.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&l.operator.startsWith(">")||this.operator.startsWith("<")&&l.operator.startsWith("<")||this.semver.version===l.semver.version&&this.operator.includes("=")&&l.operator.includes("=")||i(this.semver,"<",l.semver,f)&&this.operator.startsWith(">")&&l.operator.startsWith("<")||i(this.semver,">",l.semver,f)&&this.operator.startsWith("<")&&l.operator.startsWith(">")))}}Jn=e;const t=Va(),{safeRe:r,t:a}=cr(),i=Ro(),s=Gr(),o=ve(),u=qe();return Jn}var Wn,Es;function Wr(){if(Es)return Wn;Es=1;const n=qe();return Wn=(t,r,a)=>{try{r=new n(r,a)}catch{return!1}return r.test(t)},Wn}var Kn,Os;function Vc(){if(Os)return Kn;Os=1;const n=qe();return Kn=(t,r)=>new n(t,r).set.map(a=>a.map(i=>i.value).join(" ").trim().split(" ")),Kn}var Xn,Ss;function Jc(){if(Ss)return Xn;Ss=1;const n=ve(),e=qe();return Xn=(r,a,i)=>{let s=null,o=null,u=null;try{u=new e(a,i)}catch{return null}return r.forEach(c=>{u.test(c)&&(!s||o.compare(c)===-1)&&(s=c,o=new n(s,i))}),s},Xn}var Yn,xs;function Wc(){if(xs)return Yn;xs=1;const n=ve(),e=qe();return Yn=(r,a,i)=>{let s=null,o=null,u=null;try{u=new e(a,i)}catch{return null}return r.forEach(c=>{u.test(c)&&(!s||o.compare(c)===1)&&(s=c,o=new n(s,i))}),s},Yn}var Qn,$s;function Kc(){if($s)return Qn;$s=1;const n=ve(),e=qe(),t=Vr();return Qn=(a,i)=>{a=new e(a,i);let s=new n("0.0.0");if(a.test(s)||(s=new n("0.0.0-0"),a.test(s)))return s;s=null;for(let o=0;o<a.set.length;++o){const u=a.set[o];let c=null;u.forEach(l=>{const f=new n(l.semver.version);switch(l.operator){case">":f.prerelease.length===0?f.patch++:f.prerelease.push(0),f.raw=f.format();case"":case">=":(!c||t(f,c))&&(c=f);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${l.operator}`)}}),c&&(!s||t(s,c))&&(s=c)}return s&&a.test(s)?s:null},Qn}var ea,Is;function Xc(){if(Is)return ea;Is=1;const n=qe();return ea=(t,r)=>{try{return new n(t,r).range||"*"}catch{return null}},ea}var ta,Ts;function Ya(){if(Ts)return ta;Ts=1;const n=ve(),e=Jr(),{ANY:t}=e,r=qe(),a=Wr(),i=Vr(),s=Wa(),o=Xa(),u=Ka();return ta=(l,f,d,p)=>{l=new n(l,p),f=new r(f,p);let h,g,y,m,b;switch(d){case">":h=i,g=o,y=s,m=">",b=">=";break;case"<":h=s,g=u,y=i,m="<",b="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(a(l,f,p))return!1;for(let _=0;_<f.set.length;++_){const v=f.set[_];let w=null,x=null;if(v.forEach(L=>{L.semver===t&&(L=new e(">=0.0.0")),w=w||L,x=x||L,h(L.semver,w.semver,p)?w=L:y(L.semver,x.semver,p)&&(x=L)}),w.operator===m||w.operator===b||(!x.operator||x.operator===m)&&g(l,x.semver))return!1;if(x.operator===b&&y(l,x.semver))return!1}return!0},ta}var ra,Rs;function Yc(){if(Rs)return ra;Rs=1;const n=Ya();return ra=(t,r,a)=>n(t,r,">",a),ra}var na,ks;function Qc(){if(ks)return na;ks=1;const n=Ya();return na=(t,r,a)=>n(t,r,"<",a),na}var aa,As;function el(){if(As)return aa;As=1;const n=qe();return aa=(t,r,a)=>(t=new n(t,a),r=new n(r,a),t.intersects(r,a)),aa}var ia,Ps;function tl(){if(Ps)return ia;Ps=1;const n=Wr(),e=Be();return ia=(t,r,a)=>{const i=[];let s=null,o=null;const u=t.sort((d,p)=>e(d,p,a));for(const d of u)n(d,r,a)?(o=d,s||(s=d)):(o&&i.push([s,o]),o=null,s=null);s&&i.push([s,null]);const c=[];for(const[d,p]of i)d===p?c.push(d):!p&&d===u[0]?c.push("*"):p?d===u[0]?c.push(`<=${p}`):c.push(`${d} - ${p}`):c.push(`>=${d}`);const l=c.join(" || "),f=typeof r.raw=="string"?r.raw:String(r);return l.length<f.length?l:r},ia}var sa,Ns;function rl(){if(Ns)return sa;Ns=1;const n=qe(),e=Jr(),{ANY:t}=e,r=Wr(),a=Be(),i=(f,d,p={})=>{if(f===d)return!0;f=new n(f,p),d=new n(d,p);let h=!1;e:for(const g of f.set){for(const y of d.set){const m=u(g,y,p);if(h=h||m!==null,m)continue e}if(h)return!1}return!0},s=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],u=(f,d,p)=>{if(f===d)return!0;if(f.length===1&&f[0].semver===t){if(d.length===1&&d[0].semver===t)return!0;p.includePrerelease?f=s:f=o}if(d.length===1&&d[0].semver===t){if(p.includePrerelease)return!0;d=o}const h=new Set;let g,y;for(const k of f)k.operator===">"||k.operator===">="?g=c(g,k,p):k.operator==="<"||k.operator==="<="?y=l(y,k,p):h.add(k.semver);if(h.size>1)return null;let m;if(g&&y){if(m=a(g.semver,y.semver,p),m>0)return null;if(m===0&&(g.operator!==">="||y.operator!=="<="))return null}for(const k of h){if(g&&!r(k,String(g),p)||y&&!r(k,String(y),p))return null;for(const le of d)if(!r(k,String(le),p))return!1;return!0}let b,_,v,w,x=y&&!p.includePrerelease&&y.semver.prerelease.length?y.semver:!1,L=g&&!p.includePrerelease&&g.semver.prerelease.length?g.semver:!1;x&&x.prerelease.length===1&&y.operator==="<"&&x.prerelease[0]===0&&(x=!1);for(const k of d){if(w=w||k.operator===">"||k.operator===">=",v=v||k.operator==="<"||k.operator==="<=",g){if(L&&k.semver.prerelease&&k.semver.prerelease.length&&k.semver.major===L.major&&k.semver.minor===L.minor&&k.semver.patch===L.patch&&(L=!1),k.operator===">"||k.operator===">="){if(b=c(g,k,p),b===k&&b!==g)return!1}else if(g.operator===">="&&!r(g.semver,String(k),p))return!1}if(y){if(x&&k.semver.prerelease&&k.semver.prerelease.length&&k.semver.major===x.major&&k.semver.minor===x.minor&&k.semver.patch===x.patch&&(x=!1),k.operator==="<"||k.operator==="<="){if(_=l(y,k,p),_===k&&_!==y)return!1}else if(y.operator==="<="&&!r(y.semver,String(k),p))return!1}if(!k.operator&&(y||g)&&m!==0)return!1}return!(g&&v&&!y&&m!==0||y&&w&&!g&&m!==0||L||x)},c=(f,d,p)=>{if(!f)return d;const h=a(f.semver,d.semver,p);return h>0?f:h<0||d.operator===">"&&f.operator===">="?d:f},l=(f,d,p)=>{if(!f)return d;const h=a(f.semver,d.semver,p);return h<0?f:h>0||d.operator==="<"&&f.operator==="<="?d:f};return sa=i,sa}var oa,Cs;function nl(){if(Cs)return oa;Cs=1;const n=cr(),e=Hr(),t=ve(),r=$o(),a=Ct(),i=Nc(),s=Cc(),o=jc(),u=Lc(),c=Mc(),l=Dc(),f=Uc(),d=Fc(),p=Be(),h=zc(),g=Bc(),y=Ja(),m=qc(),b=Zc(),_=Vr(),v=Wa(),w=Io(),x=To(),L=Ka(),k=Xa(),le=Ro(),Re=Hc(),ke=Jr(),We=qe(),Ke=Wr(),I=Vc(),S=Jc(),D=Wc(),P=Kc(),U=Xc(),N=Ya(),z=Yc(),X=Qc(),G=el(),re=tl(),oe=rl();return oa={parse:a,valid:i,clean:s,inc:o,diff:u,major:c,minor:l,patch:f,prerelease:d,compare:p,rcompare:h,compareLoose:g,compareBuild:y,sort:m,rsort:b,gt:_,lt:v,eq:w,neq:x,gte:L,lte:k,cmp:le,coerce:Re,Comparator:ke,Range:We,satisfies:Ke,toComparators:I,maxSatisfying:S,minSatisfying:D,minVersion:P,validRange:U,outside:N,gtr:z,ltr:X,intersects:G,simplifyRange:re,subset:oe,SemVer:t,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:r.compareIdentifiers,rcompareIdentifiers:r.rcompareIdentifiers},oa}nl();function it(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);const[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){const[a,i]=e.split("/",2);if(!a||!i)throw new Error(`Invalid identifier format: ${n}`);return[a,i,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}class al extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function W(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}r=await n.text();const a=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;if(n.status===409)throw new al(a);const i=new Error(a);throw i.status=n.status,i}var js="[...]",il={result:"[Circular]"},Mr=[],Et=[];const sl=new TextEncoder;function ol(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Sr(n){return sl.encode(n)}function $e(n,e,t,r,a){var i;try{const s=JSON.stringify(n,t,r);return Sr(s)}catch(s){if(!((i=s.message)!=null&&i.includes("Converting circular structure to JSON")))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),Sr("[Unserializable]");console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof a>"u"&&(a=ol()),Ia(n,"",0,[],void 0,0,a);let o;try{Et.length===0?o=JSON.stringify(n,t,r):o=JSON.stringify(n,ul(t),r)}catch{return Sr("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Mr.length!==0;){const u=Mr.pop();u.length===4?Object.defineProperty(u[0],u[1],u[3]):u[0][u[1]]=u[2]}}return Sr(o)}}function ua(n,e,t,r){var a=Object.getOwnPropertyDescriptor(r,t);a.get!==void 0?a.configurable?(Object.defineProperty(r,t,{value:n}),Mr.push([r,t,e,a])):Et.push([e,t,n]):(r[t]=n,Mr.push([r,t,e]))}function Ia(n,e,t,r,a,i,s){i+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){ua(il,n,e,a);return}if(typeof s.depthLimit<"u"&&i>s.depthLimit){ua(js,n,e,a);return}if(typeof s.edgesLimit<"u"&&t+1>s.edgesLimit){ua(js,n,e,a);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)Ia(n[o],o,o,r,n,i,s);else{var u=Object.keys(n);for(o=0;o<u.length;o++){var c=u[o];Ia(n[c],c,o,r,n,i,s)}}r.pop()}}function ul(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(Et.length>0)for(var r=0;r<Et.length;r++){var a=Et[r];if(a[1]===e&&a[0]===t){t=a[2],Et.splice(r,1);break}}return n.call(this,e,t)}}function Ls(n){const e=Oo(),t=$c(),r=n.extra??{},a=r.metadata;return n.extra={...r,runtime:{...e,...r==null?void 0:r.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:n.revision_id??t.revision_id}:{},...a}},n}const cl=n=>{const e=(n==null?void 0:n.toString())??Ge("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},ll=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function dl(n){const e=[];for await(const t of n)e.push(t);return e}function ca(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const fl=async n=>{if((n==null?void 0:n.status)===429){const e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function Ms(n){return typeof n=="number"?Number(n.toFixed(4)):n}class hl{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const r=new Promise(i=>{t=i}),a=$e(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:a}),this.sizeBytes+=a,r}pop(e){var a;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let r=0;for(;r+(((a=this.peek())==null?void 0:a.size)??0)<e&&this.items.length>0;){const i=this.items.shift();i&&(t.push(i),r+=i.size,this.sizeBytes-=i.size)}if(t.length===0&&this.items.length>0){const i=this.items.shift();t.push(i),r+=i.size,this.sizeBytes-=i.size}return[t.map(i=>({action:i.action,item:i.payload})),()=>t.forEach(i=>i.itemPromiseResolve())]}}const pl=20971520,ml=2500;class tr{constructor(e={}){var r;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new hl}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:ft("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:ft("LANGSMITH_DEBUG")==="true"});const t=tr.getDefaultClientConfig();if(this.tracingSampleRate=cl(e.tracingSamplingRate),this.apiUrl=ca(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=ca(e.apiKey??t.apiKey),this.webUrl=ca(e.webUrl??t.webUrl),(r=this.webUrl)!=null&&r.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new Fi({...e.callerOptions??{},debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.batchIngestCaller=new Fi({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:fl,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=Ge("API_KEY"),t=Ge("ENDPOINT")??"https://api.smith.langchain.com",r=Ge("HIDE_INPUTS")==="true",a=Ge("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:a}}getHostUrl(){return this.webUrl?this.webUrl:ll(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${vo}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=await this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",a=`${this.apiUrl}${e}?${r}`,i=await this.caller.call(M(this.debug),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(i,`Failed to fetch ${e}`),i}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let a=Number(t.get("offset"))||0;const i=Number(t.get("limit"))||100;for(;;){t.set("offset",String(a)),t.set("limit",String(i));const s=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(M(this.debug),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(o,`Failed to fetch ${e}`);const u=r?r(await o.json()):await o.json();if(u.length===0||(yield u,u.length<i))break;a+=u.length}}async*_getCursorPaginatedList(e,t=null,r="POST",a="runs"){const i=t?{...t}:{};for(;;){const o=await(await this.caller.call(M(this.debug),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(i)})).json();if(!o||!o[a])break;yield o[a];const u=o.cursors;if(!u||!u.next)break;i.cursor=u.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const a of e)this.filteredPostUuids.has(a.id)?this.filteredPostUuids.delete(a.id):r.push(a);return r}else{const r=[];for(const a of e){const i=a.trace_id??a.id;this.filteredPostUuids.has(i)||(a.id===i?this._shouldSample()?r.push(a):this.filteredPostUuids.add(i):r.push(a))}return r}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??pl}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[r,a]=this.autoBatchQueue.pop(e);if(!r.length){a();break}const i=this._processBatch(r,a).catch(console.error);t.push(i)}return Promise.all(t)}async _processBatch(e,t){var r;if(!e.length){t();return}try{const a={runCreates:e.filter(s=>s.action==="create").map(s=>s.item),runUpdates:e.filter(s=>s.action==="update").map(s=>s.item)},i=await this._ensureServerInfo();(r=i==null?void 0:i.batch_ingest_config)!=null&&r.use_multipart_endpoint?await this.multipartIngestRuns(a):await this.batchIngestRuns(a)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=Ls(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await this.caller.call(M(this.debug),`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(ml),...this.fetchOptions});await W(e,"get server info");const t=await e.json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(t,null,2)+`
`),t}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[WARNING]: LangSmith failed to fetch info on supported operations with status code ${e.status}. Falling back to batch operations and default limits.`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const a=await this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&a.trace_id!==void 0&&a.dotted_order!==void 0){this.processRunOperation({action:"create",item:a}).catch(console.error);return}const i=Ls(a),s=await this.caller.call(M(this.debug),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:$e(i,`Creating run with id: ${i.id}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(s,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=await Promise.all((e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[]),a=await Promise.all((t==null?void 0:t.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[]);if(r.length>0&&a.length>0){const o=r.reduce((c,l)=>(l.id&&(c[l.id]=l),c),{}),u=[];for(const c of a)c.id!==void 0&&o[c.id]?o[c.id]={...o[c.id],...c}:u.push(c);r=Object.values(o),a=u}const i={post:r,patch:a};if(!i.post.length&&!i.patch.length)return;const s={post:[],patch:[]};for(const o of["post","patch"]){const u=o,c=i[u].reverse();let l=c.pop();for(;l!==void 0;)s[u].push(l),l=c.pop()}if(s.post.length>0||s.patch.length>0){const o=s.post.map(u=>u.id).concat(s.patch.map(u=>u.id)).join(",");await this._postBatchIngestRuns($e(s,`Ingesting runs with ids: ${o}`))}}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(M(this.debug),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const r={};let a=[];for(const l of e??[]){const f=await this.prepareRunCreateOrUpdateInputs(l);f.id!==void 0&&f.attachments!==void 0&&(r[f.id]=f.attachments),delete f.attachments,a.push(f)}let i=[];for(const l of t??[])i.push(await this.prepareRunCreateOrUpdateInputs(l));if(a.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(i.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(a.length>0&&i.length>0){const l=a.reduce((d,p)=>(p.id&&(d[p.id]=p),d),{}),f=[];for(const d of i)d.id!==void 0&&l[d.id]?l[d.id]={...l[d.id],...d}:f.push(d);a=Object.values(l),i=f}if(a.length===0&&i.length===0)return;const u=[],c=[];for(const[l,f]of[["post",a],["patch",i]])for(const d of f){const{inputs:p,outputs:h,events:g,attachments:y,...m}=d,b={inputs:p,outputs:h,events:g},_=$e(m,`Serializing for multipart ingestion of run with id: ${m.id}`);c.push({name:`${l}.${m.id}`,payload:new Blob([_],{type:`application/json; length=${_.length}`})});for(const[v,w]of Object.entries(b)){if(w===void 0)continue;const x=$e(w,`Serializing ${v} for multipart ingestion of run with id: ${m.id}`);c.push({name:`${l}.${m.id}.${v}`,payload:new Blob([x],{type:`application/json; length=${x.length}`})})}if(m.id!==void 0){const v=r[m.id];if(v){delete r[m.id];for(const[w,x]of Object.entries(v)){let L,k;if(Array.isArray(x)?[L,k]=x:(L=x.mimeType,k=x.data),w.includes(".")){console.warn(`Skipping attachment '${w}' for run ${m.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}c.push({name:`attachment.${m.id}.${w}`,payload:new Blob([k],{type:`${L}; length=${k.byteLength}`})})}}}u.push(`trace=${m.trace_id},id=${m.id}`)}await this._sendMultipartRequest(c,u.join("; "))}async _createNodeFetchBody(e,t){const r=[];for(const s of e)r.push(new Blob([`--${t}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${s.name}"\r
`,`Content-Type: ${s.payload.type}\r
\r
`])),r.push(s.payload),r.push(new Blob([`\r
`]));return r.push(new Blob([`--${t}--\r
`])),await new Blob(r).arrayBuffer()}async _createMultipartStream(e,t){const r=new TextEncoder;return new ReadableStream({async start(i){const s=async o=>{typeof o=="string"?i.enqueue(r.encode(o)):i.enqueue(o)};for(const o of e){await s(`--${t}\r
`),await s(`Content-Disposition: form-data; name="${o.name}"\r
`),await s(`Content-Type: ${o.payload.type}\r
\r
`);const c=o.payload.stream().getReader();try{let l;for(;!(l=await c.read()).done;)i.enqueue(l.value)}finally{c.releaseLock()}await s(`\r
`)}await s(`--${t}--\r
`),i.close()}})}async _sendMultipartRequest(e,t){try{const r="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),a=await(kc()?this._createNodeFetchBody(e,r):this._createMultipartStream(e,r)),i=await this.batchIngestCaller.call(M(this.debug),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${r}`},body:a,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(i,"ingest multipart runs",!0)}catch(r){console.warn(`${r.message.trim()}

Context: ${t}`)}}async updateRun(e,t){J(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:r}).catch(console.error);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const a={...this.headers,"Content-Type":"application/json"},i=await this.caller.call(M(this.debug),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:$e(t,`Serializing payload to update run with id: ${e}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(i,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){J(e);let r=await this._get(`/runs/${e}`);return t&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let a;t.session_id?a=t.session_id:r!=null&&r.projectName?a=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?a=r==null?void 0:r.projectId:a=(await this.readProject({projectName:Ge("PROJECT")||"default"})).id;const i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${a}/r/${t.id}?poll=true`}else if(e!==void 0){const a=await this.readRun(e);if(!a.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${a.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){var i;const t=await dl(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),r={},a={};t.sort((s,o)=>((s==null?void 0:s.dotted_order)??"").localeCompare((o==null?void 0:o.dotted_order)??""));for(const s of t){if(s.parent_run_id===null||s.parent_run_id===void 0)throw new Error(`Child run ${s.id} has no parent`);(i=s.dotted_order)!=null&&i.startsWith(e.dotted_order??"")&&s.id!==e.id&&(s.parent_run_id in r||(r[s.parent_run_id]=[]),r[s.parent_run_id].push(s),a[s.id]=s)}e.child_runs=r[e.id]||[];for(const s in r)s!==e.id&&(a[s].child_runs=r[s]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:a,traceId:i,referenceExampleId:s,startTime:o,executionOrder:u,isRoot:c,runType:l,error:f,id:d,query:p,filter:h,traceFilter:g,treeFilter:y,limit:m,select:b,order:_}=e;let v=[];if(t&&(v=Array.isArray(t)?t:[t]),r){const k=Array.isArray(r)?r:[r],le=await Promise.all(k.map(Re=>this.readProject({projectName:Re}).then(ke=>ke.id)));v.push(...le)}const w=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],x={session:v.length?v:null,run_type:l,reference_example:s,query:p,filter:h,trace_filter:g,tree_filter:y,execution_order:u,parent_run:a,start_time:o?o.toISOString():null,error:f,id:d,limit:m,trace:i,select:b||w,is_root:c,order:_};let L=0;for await(const k of this._getCursorPaginatedList("/runs/query",x))if(m){if(L>=m)break;if(k.length+L>m){yield*k.slice(0,m-L);break}L+=k.length,yield*k}else yield*k}async*listGroupRuns(e){const{projectId:t,projectName:r,groupBy:a,filter:i,startTime:s,endTime:o,limit:u,offset:c}=e,f={session_id:t||(await this.readProject({projectName:r})).id,group_by:a,filter:i,start_time:s?s.toISOString():null,end_time:o?o.toISOString():null,limit:Number(u)||100};let d=Number(c)||0;const p="/runs/group",h=`${this.apiUrl}${p}`;for(;;){const g={...f,offset:d},y=Object.fromEntries(Object.entries(g).filter(([w,x])=>x!==void 0)),m=await this.caller.call(M(),h,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(y),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(m,`Failed to fetch ${p}`);const b=await m.json(),{groups:_,total:v}=b;if(_.length===0)break;for(const w of _)yield w;if(d+=_.length,d>=v)break}}async getRunStats({id:e,trace:t,parentRun:r,runType:a,projectNames:i,projectIds:s,referenceExampleIds:o,startTime:u,endTime:c,error:l,query:f,filter:d,traceFilter:p,treeFilter:h,isRoot:g,dataSourceType:y}){let m=s||[];i&&(m=[...s||[],...await Promise.all(i.map(x=>this.readProject({projectName:x}).then(L=>L.id)))]);const _=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:a,session:m,reference_example:o,start_time:u,end_time:c,error:l,query:f,filter:d,trace_filter:p,tree_filter:h,is_root:g,data_source_type:y}).filter(([x,L])=>L!==void 0));return await(await this.caller.call(M(this.debug),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(_),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||be()};J(e);const i=await(await this.caller.call(M(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(i===null||!("share_token"in i))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${i.share_token}/r`}async unshareRun(e){J(e);const t=await this.caller.call(M(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(t,"unshare run",!0)}async readRunSharedLink(e){J(e);const r=await(await this.caller.call(M(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const s of t)r.append("id",s);return J(e),await(await this.caller.call(M(this.debug),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),J(e);const a=await(await this.caller.call(M(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};J(e);const i=await(await this.caller.call(M(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async unshareDataset(e){J(e);const t=await this.caller.call(M(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(t,"unshare dataset",!0)}async readSharedDataset(e){return J(e),await(await this.caller.call(M(this.debug),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const r={};t!=null&&t.exampleIds&&(r.id=t.exampleIds);const a=new URLSearchParams;Object.entries(r).forEach(([o,u])=>{Array.isArray(u)?u.forEach(c=>a.append(o,c)):a.append(o,u)});const i=await this.caller.call(M(this.debug),`${this.apiUrl}/public/${e}/examples?${a.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await i.json();if(!i.ok)throw"detail"in s?new Error(`Failed to list shared examples.
Status: ${i.status}
Message: ${Array.isArray(s.detail)?s.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${i.status} ${i.statusText}`);return s.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:a=!1,projectExtra:i=null,referenceDatasetId:s=null}){const o=a?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,c=i||{};r&&(c.metadata=r);const l={name:e,extra:c,description:t};s!==null&&(l.reference_dataset_id=s);const f=await this.caller.call(M(this.debug),u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(f,"create project"),await f.json()}async updateProject(e,{name:t=null,description:r=null,metadata:a=null,projectExtra:i=null,endTime:s=null}){const o=`${this.apiUrl}/sessions/${e}`;let u=i;a&&(u={...u||{},metadata:a});const c={name:t,extra:u,description:r,end_time:s?new Date(s).toISOString():null},l=await this.caller.call(M(this.debug),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(l,"update project"),await l.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)J(e),r+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");const i=await this.caller.call(M(this.debug),`${this.apiUrl}${r}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const s=await i.json();return i.ok?Array.isArray(s)?s.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let a="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)J(e),a+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&i.append("include_stats",r.toString());const s=await this._get(a,i);let o;if(Array.isArray(s)){if(s.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=s[0]}else o=s;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:t}),a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:i,referenceFree:s,metadata:o}={}){const u=new URLSearchParams;if(e!==void 0)for(const c of e)u.append("id",c);if(t!==void 0&&u.append("name",t),r!==void 0&&u.append("name_contains",r),a!==void 0)u.append("reference_dataset",a);else if(i!==void 0){const c=await this.readDataset({datasetName:i});u.append("reference_dataset",c.id)}s!==void 0&&u.append("reference_free",s.toString()),o!==void 0&&u.append("metadata",JSON.stringify(o));for await(const c of this._getPaginated("/sessions",u))yield*c}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,J(r);const a=await this.caller.call(M(this.debug),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(a,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:i,dataType:s,name:o}){const u=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),r.forEach(d=>{c.append("input_keys",d)}),a.forEach(d=>{c.append("output_keys",d)}),i&&c.append("description",i),s&&c.append("data_type",s),o&&c.append("name",o);const l=await this.caller.call(M(this.debug),u,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(l,"upload CSV"),await l.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:a,outputsSchema:i,metadata:s}={}){const o={name:e,description:t,extra:s?{metadata:s}:void 0};r&&(o.data_type=r),a&&(o.inputs_schema_definition=a),i&&(o.outputs_schema_definition=i);const u=await this.caller.call(M(this.debug),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(u,"create dataset"),await u.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const a=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)J(e),r+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide datasetName or datasetId");const i=await this._get(r,a);let s;if(Array.isArray(i)){if(i.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);s=i[0]}else s=i;return s}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:a}){let i=e;if(i===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:t})).id);const s=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof a=="string"?a:a.toISOString()});return await this._get(`/datasets/${i}/versions/diff`,s)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:i,metadata:s}={}){const o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const c of r)u.append("id",c);a!==void 0&&u.append("name",a),i!==void 0&&u.append("name_contains",i),s!==void 0&&u.append("metadata",JSON.stringify(s));for await(const c of this._getPaginated(o,u))yield*c}async updateDataset(e){const{datasetId:t,datasetName:r,...a}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const i=t??(await this.readDataset({datasetName:r})).id;J(i);const s=await this.caller.call(M(this.debug),`${this.apiUrl}/datasets/${i}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,"update dataset"),await s.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:r,asOf:a,tag:i}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const s=t??(await this.readDataset({datasetName:r})).id;J(s);const o=await this.caller.call(M(this.debug),`${this.apiUrl}/datasets/${s}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof a=="string"?a:a.toISOString(),tag:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(a=(await this.readDataset({datasetName:t})).id),a!==void 0)J(a),r+=`/${a}`;else throw new Error("Must provide datasetName or datasetId");const i=await this.caller.call(M(this.debug),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(i,`delete ${r}`),await i.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let a=e;if(!a&&!t)throw new Error("Must provide either datasetName or datasetId");if(a&&t)throw new Error("Must provide either datasetName or datasetId, not both");a||(a=(await this.readDataset({datasetName:t})).id),J(a);const i={tag:r},s=await this.caller.call(M(this.debug),`${this.apiUrl}/datasets/${a}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(s,"index dataset"),await s.json()}async similarExamples(e,t,r,{filter:a}={}){const i={limit:r,inputs:e};a!==void 0&&(i.filter=a),J(t);const s=await this.caller.call(M(this.debug),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,"fetch similar examples"),(await s.json()).examples}async createExample(e,t,r){var l;if(Ds(e)&&(t!==void 0||r!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let a=t?r==null?void 0:r.datasetId:e.dataset_id;const i=t?r==null?void 0:r.datasetName:e.dataset_name;if(a===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:i})).id);const s=(t?r==null?void 0:r.createdAt:e.created_at)||new Date;let o;Ds(e)?o=e:o={inputs:e,outputs:t,created_at:s==null?void 0:s.toISOString(),id:r==null?void 0:r.exampleId,metadata:r==null?void 0:r.metadata,split:r==null?void 0:r.split,source_run_id:r==null?void 0:r.sourceRunId,use_source_run_io:r==null?void 0:r.useSourceRunIO,use_source_run_attachments:r==null?void 0:r.useSourceRunAttachments,attachments:r==null?void 0:r.attachments};const u=await this._uploadExamplesMultipart(a,[o]);return await this.readExample(((l=u.example_ids)==null?void 0:l[0])??be())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const b=e;let _=b[0].dataset_id;const v=b[0].dataset_name;if(_===void 0&&v===void 0)throw new Error("Must provide either datasetName or datasetId");if(_!==void 0&&v!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");_===void 0&&(_=(await this.readDataset({datasetName:v})).id);const w=await this._uploadExamplesMultipart(_,b);return await Promise.all(w.example_ids.map(L=>this.readExample(L)))}const{inputs:t,outputs:r,metadata:a,splits:i,sourceRunIds:s,useSourceRunIOs:o,useSourceRunAttachments:u,attachments:c,exampleIds:l,datasetId:f,datasetName:d}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let p=f;const h=d;if(p===void 0&&h===void 0)throw new Error("Must provide either datasetName or datasetId");if(p!==void 0&&h!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");p===void 0&&(p=(await this.readDataset({datasetName:h})).id);const g=t.map((b,_)=>({dataset_id:p,inputs:b,outputs:r==null?void 0:r[_],metadata:a==null?void 0:a[_],split:i==null?void 0:i[_],id:l==null?void 0:l[_],attachments:c==null?void 0:c[_],source_run_id:s==null?void 0:s[_],use_source_run_io:o==null?void 0:o[_],use_source_run_attachments:u==null?void 0:u[_]})),y=await this._uploadExamplesMultipart(p,g);return await Promise.all(y.example_ids.map(b=>this.readExample(b)))}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const a=e.map(s=>zi(s)?Bi(s):s),i=zi(t)?Bi(t):t;return this.createExample({input:a},{output:i},r)}async readExample(e){J(e);const t=`/examples/${e}`,r=await this._get(t),{attachment_urls:a,...i}=r,s=i;return a&&(s.attachments=Object.entries(a).reduce((o,[u,c])=>(o[u.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},o),{})),s}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:a,splits:i,inlineS3Urls:s,metadata:o,limit:u,offset:c,filter:l,includeAttachments:f}={}){let d;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)d=e;else if(t!==void 0)d=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const p=new URLSearchParams({dataset:d}),h=a?typeof a=="string"?a:a==null?void 0:a.toISOString():void 0;h&&p.append("as_of",h);const g=s??!0;if(p.append("inline_s3_urls",g.toString()),r!==void 0)for(const m of r)p.append("id",m);if(i!==void 0)for(const m of i)p.append("splits",m);if(o!==void 0){const m=JSON.stringify(o);p.append("metadata",m)}u!==void 0&&p.append("limit",u.toString()),c!==void 0&&p.append("offset",c.toString()),l!==void 0&&p.append("filter",l),f===!0&&["attachment_urls","outputs","metadata"].forEach(m=>p.append("select",m));let y=0;for await(const m of this._getPaginated("/examples",p)){for(const b of m){const{attachment_urls:_,...v}=b,w=v;_&&(w.attachments=Object.entries(_).reduce((x,[L,k])=>(x[L.slice(11)]={presigned_url:k.presigned_url,mime_type:k.mime_type||void 0},x),{})),yield w,y++}if(u!==void 0&&y>=u)break}}async deleteExample(e){J(e);const t=`/examples/${e}`,r=await this.caller.call(M(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(r,`delete ${t}`),await r.json()}async updateExample(e,t){let r;t?r=e:r=e.id,J(r);let a;t?a={id:r,...t}:a=e;let i;return a.dataset_id!==void 0?i=a.dataset_id:i=(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(i,[a])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:a}){let i;if(e?i=e:i=(await this.readDataset({datasetName:t})).id,J(i),r&&a||!r&&!a)throw new Error("Exactly one of asOf and tag must be specified.");const s=new URLSearchParams;r!==void 0&&s.append("as_of",typeof r=="string"?r:r.toISOString()),a!==void 0&&s.append("tag",a);const o=await this.caller.call(M(this.debug),`${this.apiUrl}/datasets/${i}/version?${s.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,J(a);const i=new URLSearchParams,s=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return s&&i.append("as_of",s),await this._get(`/datasets/${a}/splits`,i)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:a,remove:i=!1}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,J(s);const o={split_name:r,examples:a.map(c=>(J(c),c)),remove:i},u=await this.caller.call(M(this.debug),`${this.apiUrl}/datasets/${s}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(u,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a,referenceExample:i}={loadChildRuns:!1}){xo("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let s;if(typeof e=="string")s=await this.readRun(e,{loadChildRuns:a});else if(typeof e=="object"&&"id"in e)s=e;else throw new Error(`Invalid run type: ${typeof e}`);s.reference_example_id!==null&&s.reference_example_id!==void 0&&(i=await this.readExample(s.reference_example_id));const o=await t.evaluateRun(s,i),[u,c]=await this._logEvaluationFeedback(o,s,r);return c[0]}async createFeedback(e,t,{score:r,value:a,correction:i,comment:s,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:c,feedbackId:l,feedbackConfig:f,projectId:d,comparativeExperimentId:p}){var b;if(!e&&!d)throw new Error("One of runId or projectId must be provided");if(e&&d)throw new Error("Only one of runId or projectId can be provided");const h={type:u??"api",metadata:o??{}};c!==void 0&&(h==null?void 0:h.metadata)!==void 0&&!h.metadata.__run&&(h.metadata.__run={run_id:c}),(h==null?void 0:h.metadata)!==void 0&&((b=h.metadata.__run)==null?void 0:b.run_id)!==void 0&&J(h.metadata.__run.run_id);const g={id:l??be(),run_id:e,key:t,score:Ms(r),value:a,correction:i,comment:s,feedback_source:h,comparative_experiment_id:p,feedbackConfig:f,session_id:d},y=`${this.apiUrl}/feedback`,m=await this.caller.call(M(this.debug),y,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(g),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(m,"create feedback",!0),g}async updateFeedback(e,{score:t,value:r,correction:a,comment:i}){const s={};t!=null&&(s.score=Ms(t)),r!=null&&(s.value=r),a!=null&&(s.correction=a),i!=null&&(s.comment=i),J(e);const o=await this.caller.call(M(this.debug),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(o,"update feedback",!0)}async readFeedback(e){J(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){J(e);const t=`/feedback/${e}`,r=await this.caller.call(M(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(const i of t)a.append("key",i);if(r)for(const i of r)a.append("source",i);for await(const i of this._getPaginated("/feedback",a))yield*i}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:a}={}){const i={run_id:e,feedback_key:t,feedback_config:a};return r?typeof r=="string"?i.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(i.expires_in=r):i.expires_in={hours:3},await(await this.caller.call(M(this.debug),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:a,description:i,metadata:s,id:o}){var l;if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const u={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:i,created_at:(l=a??new Date)==null?void 0:l.toISOString(),extra:{}};return s&&(u.extra.metadata=s),await(await this.caller.call(M(this.debug),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){J(e);const t=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,r){const a=this._selectEvalResults(e),i=[];for(const s of a){let o=r||{};s.evaluatorInfo&&(o={...s.evaluatorInfo,...o});let u=null;s.targetRunId?u=s.targetRunId:t&&(u=t.id),i.push(await this.createFeedback(u,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:o,sourceRunId:s.sourceRunId,feedbackConfig:s.feedbackConfig,feedbackSourceType:"model"}))}return[a,i]}async logEvaluationFeedback(e,t,r){const[a]=await this._logEvaluationFeedback(e,t,r);return a}async*listAnnotationQueues(e={}){const{queueIds:t,name:r,nameContains:a,limit:i}=e,s=new URLSearchParams;t&&t.forEach((u,c)=>{J(u,`queueIds[${c}]`),s.append("ids",u)}),r&&s.append("name",r),a&&s.append("name_contains",a),s.append("limit",(i!==void 0?Math.min(i,100):100).toString());let o=0;for await(const u of this._getPaginated("/annotation-queues",s))if(yield*u,o++,i!==void 0&&o>=i)break}async createAnnotationQueue(e){const{name:t,description:r,queueId:a,rubricInstructions:i}=e,s={name:t,description:r,id:a||be(),rubric_instructions:i},o=await this.caller.call(M(this.debug),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(s).filter(([c,l])=>l!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(o,"create annotation queue"),await o.json()}async readAnnotationQueue(e){const t=await this.caller.call(M(this.debug),`${this.apiUrl}/annotation-queues/${J(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(t,"read annotation queue"),await t.json()}async updateAnnotationQueue(e,t){const{name:r,description:a,rubricInstructions:i}=t,s=await this.caller.call(M(this.debug),`${this.apiUrl}/annotation-queues/${J(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:a,rubric_instructions:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(s,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(M(this.debug),`${this.apiUrl}/annotation-queues/${J(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const r=await this.caller.call(M(this.debug),`${this.apiUrl}/annotation-queues/${J(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((a,i)=>J(a,`runIds[${i}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const r=`/annotation-queues/${J(e,"queueId")}/run`,a=await this.caller.call(M(this.debug),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(a,"get run from annotation queue"),await a.json()}async deleteRunFromAnnotationQueue(e,t){const r=await this.caller.call(M(this.debug),`${this.apiUrl}/annotation-queues/${J(e,"queueId")}/runs/${J(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(r,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(M(this.debug),`${this.apiUrl}/annotation-queues/${J(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(M(this.debug),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){const a=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),i=new Error(`Error ${t.status}: ${t.statusText}
${a}`);throw i.statusCode=t.status,i}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[r,a,i]=it(e),s=await this.caller.call(M(this.debug),`${this.apiUrl}/likes/${r}/${a}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,`${t?"like":"unlike"} prompt`),await s.json()}async _getPromptUrl(e){const[t,r,a]=it(e);if(await this._currentTenantIsOwner(t)){const i=await this._getSettings();return a!=="latest"?`${this.getHostUrl()}/prompts/${r}/${a.substring(0,8)}?organizationId=${i.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${i.id}`}else return a!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${a.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const r of this._getPaginated("/repos",t,a=>a.repos))yield*r}async getPrompt(e){const[t,r,a]=it(e),i=await this.caller.call(M(this.debug),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(i.status===404)return null;await W(i,"get prompt");const s=await i.json();return s.repo?s.repo:null}async createPrompt(e,t){const r=await this._getSettings();if(t!=null&&t.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[a,i,s]=it(e);if(!await this._currentTenantIsOwner(a))throw await this._ownerConflictError("create a prompt",a);const o={repo_handle:i,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},u=await this.caller.call(M(this.debug),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(u,"create prompt");const{repo:c}=await u.json();return c}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[a,i,s]=it(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${a}/${i}`):r==null?void 0:r.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},c=await this.caller.call(M(this.debug),`${this.apiUrl}/commits/${a}/${i}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(c,"create commit");const l=await c.json();return this._getPromptUrl(`${a}/${i}${l.commit_hash?`:${l.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){var o;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const u of t){const c=u.id,l={...u.metadata&&{metadata:u.metadata},...u.split&&{split:u.split}},f=$e(l,`Serializing body for example with id: ${c}`),d=new Blob([f],{type:"application/json"});if(r.append(c,d),u.inputs){const p=$e(u.inputs,`Serializing inputs for example with id: ${c}`),h=new Blob([p],{type:"application/json"});r.append(`${c}.inputs`,h)}if(u.outputs){const p=$e(u.outputs,`Serializing outputs whle updating example with id: ${c}`),h=new Blob([p],{type:"application/json"});r.append(`${c}.outputs`,h)}if(u.attachments)for(const[p,h]of Object.entries(u.attachments)){let g,y;Array.isArray(h)?[g,y]=h:(g=h.mimeType,y=h.data);const m=new Blob([y],{type:`${g}; length=${y.byteLength}`});r.append(`${c}.attachment.${p}`,m)}if(u.attachments_operations){const p=$e(u.attachments_operations,`Serializing attachments while updating example with id: ${c}`),h=new Blob([p],{type:"application/json"});r.append(`${c}.attachments_operations`,h)}}const a=e??((o=t[0])==null?void 0:o.dataset_id);return await(await this.caller.call(M(this.debug),`${this.apiUrl}/v1/platform/datasets/${a}/examples`,{method:"PATCH",headers:this.headers,body:r})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const s of t){const o=(s.id??be()).toString(),u={created_at:s.created_at,...s.metadata&&{metadata:s.metadata},...s.split&&{split:s.split},...s.source_run_id&&{source_run_id:s.source_run_id},...s.use_source_run_io&&{use_source_run_io:s.use_source_run_io},...s.use_source_run_attachments&&{use_source_run_attachments:s.use_source_run_attachments}},c=$e(u,`Serializing body for uploaded example with id: ${o}`),l=new Blob([c],{type:"application/json"});if(r.append(o,l),s.inputs){const f=$e(s.inputs,`Serializing inputs for uploaded example with id: ${o}`),d=new Blob([f],{type:"application/json"});r.append(`${o}.inputs`,d)}if(s.outputs){const f=$e(s.outputs,`Serializing outputs for uploaded example with id: ${o}`),d=new Blob([f],{type:"application/json"});r.append(`${o}.outputs`,d)}if(s.attachments)for(const[f,d]of Object.entries(s.attachments)){let p,h;Array.isArray(d)?[p,h]=d:(p=d.mimeType,h=d.data);const g=new Blob([h],{type:`${p}; length=${h.byteLength}`});r.append(`${o}.attachment.${f}`,g)}}const a=await this.caller.call(M(this.debug),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:r});return await W(a,"upload examples"),await a.json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,a]=it(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const i={};if((t==null?void 0:t.description)!==void 0&&(i.description=t.description),(t==null?void 0:t.readme)!==void 0&&(i.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(i.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(i.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(i.is_archived=t.isArchived),Object.keys(i).length===0)throw new Error("No valid update options provided");const s=await this.caller.call(M(this.debug),`${this.apiUrl}/repos/${r}/${a}`,{method:"PATCH",body:JSON.stringify(i),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await W(s,"update prompt"),s.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,r,a]=it(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(M(this.debug),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[r,a,i]=it(e),s=await this.caller.call(M(this.debug),`${this.apiUrl}/commits/${r}/${a}/${i}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await W(s,"pull prompt commit");const o=await s.json();return{owner:r,repo:a,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const r=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(a=>a!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:r=this.apiUrl,datasetName:a}=t,[i,s]=this.parseTokenOrUrl(e,r),o=new tr({apiUrl:i,apiKey:"placeholder"}),u=await o.readSharedDataset(s),c=a||u.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}const l=await o.listSharedExamples(s),f=await this.createDataset(c,{description:u.description,dataType:u.data_type||"kv",inputsSchema:u.inputs_schema_definition??void 0,outputsSchema:u.outputs_schema_definition??void 0});try{await this.createExamples({inputs:l.map(d=>d.inputs),outputs:l.flatMap(d=>d.outputs?[d.outputs]:[]),datasetId:f.id})}catch(d){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),d}}parseTokenOrUrl(e,t,r=2,a="dataset"){try{return J(e),[t,e]}catch{}try{const s=new URL(e).pathname.split("/").filter(o=>o!=="");if(s.length>=r){const o=s[s.length-r];return[t,o]}else throw new Error(`Invalid public ${a} URL: ${e}`)}catch{throw new Error(`Invalid public ${a} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}}function Ds(n){return"dataset_id"in n||"dataset_name"in n}const gl=n=>!!["TRACING_V2","TRACING"].find(t=>Ge(t)==="true"),la=Symbol.for("lc:context_variables");function yl(n){return n.replace(/[-:.]/g,"")}function _l(n,e,t=1){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return yl(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}class Dr{constructor(e,t,r,a){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=r,this.replicas=a}static fromHeader(e){const t=e.split(",");let r={},a=[],i,s;for(const o of t){const[u,c]=o.split("="),l=decodeURIComponent(c);u==="langsmith-metadata"?r=JSON.parse(l):u==="langsmith-tags"?a=l.split(","):u==="langsmith-project"?i=l:u==="langsmith-replicas"&&(s=JSON.parse(l))}return new Dr(r,a,i,s)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class Se{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),ko(e)){Object.assign(this,{...e});return}const t=Se.getDefaultConfig(),{metadata:r,...a}=e,i=a.client??Se.getSharedClient(),s={...r,...(o=a==null?void 0:a.extra)==null?void 0:o.metadata};if(a.extra={...a.extra,metadata:s},Object.assign(this,{...t,...a,client:i}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const u=_l(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u}}set metadata(e){var t;this.extra={...this.extra,metadata:{...(t=this.extra)==null?void 0:t.metadata,...e}}}get metadata(){var e;return(e=this.extra)==null?void 0:e.metadata}static getDefaultConfig(){return{id:be(),run_type:"chain",project_name:wo(),child_runs:[],api_url:ft("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:ft("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return Se.sharedClient||(Se.sharedClient=new tr),Se.sharedClient}createChild(e){var u,c,l,f,d,p;const t=this.child_execution_order+1,r=new Se({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});la in this&&(r[la]=this[la]);const a=Symbol.for("lc:child_config"),i=((u=e.extra)==null?void 0:u[a])??this.extra[a];if(wl(i)){const h={...i},g=bl(h.callbacks)?(l=(c=h.callbacks).copy)==null?void 0:l.call(c):void 0;g&&(Object.assign(g,{_parentRunId:r.id}),(p=(d=(f=g.handlers)==null?void 0:f.find(Ao))==null?void 0:d.updateFromRunTree)==null||p.call(d,r),h.callbacks=g),r.extra[a]=h}const s=new Set;let o=this;for(;o!=null&&!s.has(o.id);)s.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),a){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,a&&Object.keys(a).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...a}}:{metadata:a})}_convertToCreate(e,t,r=!0){var o,u;const a=e.extra??{};if(((o=a==null?void 0:a.runtime)==null?void 0:o.library)===void 0&&(a.runtime||(a.runtime={}),t))for(const[c,l]of Object.entries(t))a.runtime[c]||(a.runtime[c]=l);let i,s;return r?(s=(u=e.parent_run)==null?void 0:u.id,i=[]):(i=e.child_runs.map(c=>this._convertToCreate(c,t,r)),s=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:a,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:i,parent_run_id:s,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,r=!0){const a=this._convertToCreate(this,t,r);if(e===this.project_name)return a;const i=f=>Ni(`${f}:${e}`,Ni.DNS),s=i(a.id),o=a.trace_id?i(a.trace_id):void 0,u=a.parent_run_id?i(a.parent_run_id):void 0;let c;if(a.dotted_order){const f=vl(a.dotted_order),d=[];for(let h=0;h<f.length-1;h++){const[g,y]=f[h],m=i(y);d.push(g.toISOString().replace(/[-:]/g,"").replace(".","")+m)}const[p]=f[f.length-1];d.push(p.toISOString().replace(/[-:]/g,"").replace(".","")+s),c=d.join(".")}else c=void 0;return{...a,id:s,trace_id:o,parent_run_id:u,dotted_order:c,session_name:e}}async postRun(e=!0){try{const t=Oo();if(this.replicas&&this.replicas.length>0)for(const[r]of this.replicas){const a=this._remapForProject(r,t,!0);await this.client.createRun(a)}else{const r=this._convertToCreate(this,t,e);await this.client.createRun(r)}if(!e){xo("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const r of this.child_runs)await r.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;if(this.replicas&&this.replicas.length>0)for(const[t,r]of this.replicas){const a=this._remapForProject(t);await this.client.updateRun(a.id,{inputs:a.inputs,outputs:a.outputs,error:a.error,parent_run_id:a.parent_run_id,session_name:a.session_name,reference_example_id:a.reference_example_id,end_time:a.end_time,dotted_order:a.dotted_order,trace_id:a.trace_id,events:a.events,tags:a.tags,extra:a.extra,attachments:this.attachments,...r})}else try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var c,l,f,d;const r=e==null?void 0:e.callbacks;let a,i,s,o=gl();if(r){const p=((c=r==null?void 0:r.getParentRunId)==null?void 0:c.call(r))??"",h=(l=r==null?void 0:r.handlers)==null?void 0:l.find(g=>(g==null?void 0:g.name)=="langchain_tracer");a=(f=h==null?void 0:h.getRun)==null?void 0:f.call(h,p),i=h==null?void 0:h.projectName,s=h==null?void 0:h.client,o=o||!!h}return a?new Se({name:a.name,id:a.id,trace_id:a.trace_id,dotted_order:a.dotted_order,client:s,tracingEnabled:o,project_name:i,tags:[...new Set(((a==null?void 0:a.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(d=a==null?void 0:a.extra)==null?void 0:d.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new Se({...t,client:s,tracingEnabled:o,project_name:i})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var c;const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,a=r["langsmith-trace"];if(!a||typeof a!="string")return;const i=a.trim(),s=i.split(".").map(l=>{const[f,d]=l.split("Z");return{strTime:f,time:Date.parse(f+"Z"),uuid:d}}),o=s[0].uuid,u={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(c=s.at(-1))==null?void 0:c.uuid,trace_id:o,dotted_order:i};if(r.baggage&&typeof r.baggage=="string"){const l=Dr.fromHeader(r.baggage);u.metadata=l.metadata,u.tags=l.tags,u.project_name=l.project_name,u.replicas=l.replicas}return new Se(u)}toHeaders(e){var r;const t={"langsmith-trace":this.dotted_order,baggage:new Dr((r=this.extra)==null?void 0:r.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[a,i]of Object.entries(t))e.set(a,i);return t}}Object.defineProperty(Se,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function ko(n){return n!==void 0&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function Ao(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function Us(n){return Array.isArray(n)&&n.some(e=>Ao(e))}function bl(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function wl(n){var e;return n!==void 0&&typeof n.callbacks=="object"&&(Us((e=n.callbacks)==null?void 0:e.handlers)||Us(n.callbacks))}function vl(n){return n.split(".").map(t=>{const r=t.slice(0,-36),a=t.slice(-36),i=parseInt(r.slice(0,4)),s=parseInt(r.slice(4,6))-1,o=parseInt(r.slice(6,8)),u=parseInt(r.slice(9,11)),c=parseInt(r.slice(11,13)),l=parseInt(r.slice(13,15)),f=parseInt(r.slice(15,21));return[new Date(i,s,o,u,c,l,f/1e3),a]})}let El=class{getStore(){}run(e,t){return t()}};const da=Symbol.for("ls:tracing_async_local_storage"),Ol=new El;let Sl=class{getInstance(){return globalThis[da]??Ol}initializeGlobalInstance(e){globalThis[da]===void 0&&(globalThis[da]=e)}};const xl=new Sl;function $l(n=!1){const e=xl.getInstance().getStore();if(!n&&!ko(e))throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function Qa(n){return typeof n=="function"&&"langsmith:traceable"in n}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const Il=Object.prototype.hasOwnProperty;function Tl(n,e){return Il.call(n,e)}function Rl(n){if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)Tl(n,t)&&e.push(t);return e}function At(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function Ta(n){let e=0;const t=n.length;let r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function ep(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function kl(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function Ra(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(Ra(n[t]))return!0}else if(typeof n=="object"){const t=Rl(n),r=t.length;for(var e=0;e<r;e++)if(Ra(n[t[e]]))return!0}}return!1}function Fs(n,e){const t=[n];for(const r in e){const a=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof a<"u"&&t.push(`${r}: ${a}`)}return t.join(`
`)}class Al extends Error{constructor(e,t,r,a,i){super(Fs(e,{name:t,index:r,operation:a,tree:i})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.setPrototypeOf(this,new.target.prototype),this.message=Fs(e,{name:t,index:r,operation:a,tree:i})}}const ce=Al,Ot={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=ka(t,this.path);r&&(r=At(r));const a=Vt(t,{op:"remove",path:this.from}).removed;return Vt(t,{op:"add",path:this.path,value:a}),{newDocument:t,removed:r}},copy:function(n,e,t){const r=ka(t,this.from);return Vt(t,{op:"add",path:this.path,value:At(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:Fr(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}};var Pl={add:function(n,e,t){return Ta(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:Ot.move,copy:Ot.copy,test:Ot.test,_get:Ot._get};function ka(n,e){if(e=="")return n;var t={op:"_get",path:e};return Vt(n,t),t.value}function Vt(n,e,t=!1,r=!0,a=!0,i=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):Aa(e,0)),e.path===""){let s={newDocument:n};if(e.op==="add")return s.newDocument=e.value,s;if(e.op==="replace")return s.newDocument=e.value,s.removed=n,s;if(e.op==="move"||e.op==="copy")return s.newDocument=ka(n,e.from),e.op==="move"&&(s.removed=n),s;if(e.op==="test"){if(s.test=Fr(n,e.value),s.test===!1)throw new ce("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return s.newDocument=n,s}else{if(e.op==="remove")return s.removed=n,s.newDocument=null,s;if(e.op==="_get")return e.value=n,s;if(t)throw new ce("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,e,n);return s}}else{r||(n=At(n));const o=(e.path||"").split("/");let u=n,c=1,l=o.length,f,d,p;for(typeof t=="function"?p=t:p=Aa;;){if(d=o[c],d&&d.indexOf("~")!=-1&&(d=kl(d)),a&&(d=="__proto__"||d=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&f===void 0&&(u[d]===void 0?f=o.slice(0,c).join("/"):c==l-1&&(f=e.path),f!==void 0&&p(e,0,n,f)),c++,Array.isArray(u)){if(d==="-")d=u.length;else{if(t&&!Ta(d))throw new ce("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",i,e,n);Ta(d)&&(d=~~d)}if(c>=l){if(t&&e.op==="add"&&d>u.length)throw new ce("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",i,e,n);const h=Pl[e.op].call(e,u,d,n);if(h.test===!1)throw new ce("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return h}}else if(c>=l){const h=Ot[e.op].call(e,u,d,n);if(h.test===!1)throw new ce("Test operation failed","TEST_OPERATION_FAILED",i,e,n);return h}if(u=u[d],t&&c<l&&(!u||typeof u!="object"))throw new ce("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",i,e,n)}}}function Ur(n,e,t,r=!0,a=!0){if(t&&!Array.isArray(e))throw new ce("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=At(n));const i=new Array(e.length);for(let s=0,o=e.length;s<o;s++)i[s]=Vt(n,e[s],t,!0,a,s),n=i[s].newDocument;return i.newDocument=n,i}function Aa(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new ce("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(Ot[n.op]){if(typeof n.path!="string")throw new ce("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new ce('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new ce("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new ce("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&Ra(n.value))throw new ce("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var a=n.path.split("/").length,i=r.split("/").length;if(a!==i+1&&a!==i)throw new ce("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new ce("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var s={op:"_get",path:n.from,value:void 0},o=Nl([s],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new ce("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new ce("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function Nl(n,e,t){try{if(!Array.isArray(n))throw new ce("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Ur(At(e),At(n),t||!0);else{t=t||Aa;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(a){if(a instanceof ce)return a;throw a}}function Fr(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),a,i,s;if(t&&r){if(i=n.length,i!=e.length)return!1;for(a=i;a--!==0;)if(!Fr(n[a],e[a]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(i=o.length,i!==Object.keys(e).length)return!1;for(a=i;a--!==0;)if(!e.hasOwnProperty(o[a]))return!1;for(a=i;a--!==0;)if(s=o[a],!Fr(n[s],e[s]))return!1;return!0}return n!==n&&e!==e}class Cl{}function tp(n){return"lc_prefer_streaming"in n&&n.lc_prefer_streaming}class lr extends Cl{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,lo(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:xt("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return _t.prototype.toJSON.call(this)}toJSONNotImplemented(){return _t.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends lr{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:be()}),Object.assign(this,e)}}return new t}}const jl=n=>{const e=n;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"},Ll=n=>{if(n)return n.events=n.events??[],n.child_runs=n.child_runs??[],n};function Pa(n,e){if(n)return new Se({...n,parent_run:Pa(e),child_runs:n.child_runs.map(t=>Pa(t)).filter(t=>t!==void 0),extra:{...n.extra,runtime:cu()},tracingEnabled:!1})}function fa(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function Ml(n){return n.replace(/[-:.]/g,"")}function Dl(n,e,t){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return Ml(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function zt(n){return typeof n._addRunToRunMap=="function"}class dr extends lr{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?Ll(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=Dl(e.start_time,e.id,e.execution_order),r={...e},a=this.getRunById(r.parent_run_id);if(r.parent_run_id!==void 0?a&&(this._addChildRun(a,r),a.child_execution_order=Math.max(a.child_execution_order,r.child_execution_order),r.trace_id=a.trace_id,a.dotted_order!==void 0&&(r.dotted_order=[a.dotted_order,t].join("."))):(r.trace_id=r.id,r.dotted_order=t),this.usesRunTreeMap){const i=Pa(r,a);i!==void 0&&this.runTreeMap.set(r.id,i)}else this.runMap.set(r.id,r);return r}async _endTrace(e){var r;const t=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await((r=this.onRunUpdate)==null?void 0:r.call(this,e)),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,a,i,s,o,u){const c=this._getExecutionOrder(a),l=Date.now(),f=o?{...i,metadata:o}:i,d={id:r,name:u??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:f??{},tags:s||[]};return this._addRunToRunMap(d)}async handleLLMStart(e,t,r,a,i,s,o,u){var l,f;const c=this.getRunById(r)??this._createRunForLLMStart(e,t,r,a,i,s,o,u);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((f=this.onLLMStart)==null?void 0:f.call(this,c)),c}_createRunForChatModelStart(e,t,r,a,i,s,o,u){const c=this._getExecutionOrder(a),l=Date.now(),f=o?{...i,metadata:o}:i,d={id:r,name:u??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:f??{},tags:s||[]};return this._addRunToRunMap(d)}async handleChatModelStart(e,t,r,a,i,s,o,u){var l,f;const c=this.getRunById(r)??this._createRunForChatModelStart(e,t,r,a,i,s,o,u);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((f=this.onLLMStart)==null?void 0:f.call(this,c)),c}async handleLLMEnd(e,t,r,a,i){var o;const s=this.getRunById(t);if(!s||(s==null?void 0:s.run_type)!=="llm")throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.outputs=e,s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...i},await((o=this.onLLMEnd)==null?void 0:o.call(this,s)),await this._endTrace(s),s}async handleLLMError(e,t,r,a,i){var o;const s=this.getRunById(t);if(!s||(s==null?void 0:s.run_type)!=="llm")throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...i},await((o=this.onLLMError)==null?void 0:o.call(this,s)),await this._endTrace(s),s}_createRunForChainStart(e,t,r,a,i,s,o,u){const c=this._getExecutionOrder(a),l=Date.now(),f={id:r,name:u??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return this._addRunToRunMap(f)}async handleChainStart(e,t,r,a,i,s,o,u){var l,f;const c=this.getRunById(r)??this._createRunForChainStart(e,t,r,a,i,s,o,u);return await((l=this.onRunCreate)==null?void 0:l.call(this,c)),await((f=this.onChainStart)==null?void 0:f.call(this,c)),c}async handleChainEnd(e,t,r,a,i){var o;const s=this.getRunById(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=fa(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(s.inputs=fa(i.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,s)),await this._endTrace(s),s}async handleChainError(e,t,r,a,i){var o;const s=this.getRunById(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),(i==null?void 0:i.inputs)!==void 0&&(s.inputs=fa(i.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,s)),await this._endTrace(s),s}_createRunForToolStart(e,t,r,a,i,s,o){const u=this._getExecutionOrder(a),c=Date.now(),l={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return this._addRunToRunMap(l)}async handleToolStart(e,t,r,a,i,s,o){var c,l;const u=this.getRunById(r)??this._createRunForToolStart(e,t,r,a,i,s,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((l=this.onToolStart)==null?void 0:l.call(this,u)),u}async handleToolEnd(e,t){var a;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((a=this.onToolEnd)==null?void 0:a.call(this,r)),await this._endTrace(r),r}async handleToolError(e,t){var a;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((a=this.onToolError)==null?void 0:a.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,t){var i;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const a=r;a.actions=a.actions||[],a.actions.push(e),a.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentAction)==null?void 0:i.call(this,r))}async handleAgentEnd(e,t){var a;const r=this.getRunById(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentEnd)==null?void 0:a.call(this,r)))}_createRunForRetrieverStart(e,t,r,a,i,s,o){const u=this._getExecutionOrder(a),c=Date.now(),l={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:i||[]};return this._addRunToRunMap(l)}async handleRetrieverStart(e,t,r,a,i,s,o){var c,l;const u=this.getRunById(r)??this._createRunForRetrieverStart(e,t,r,a,i,s,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((l=this.onRetrieverStart)==null?void 0:l.call(this,u)),u}async handleRetrieverEnd(e,t){var a;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((a=this.onRetrieverEnd)==null?void 0:a.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,t){var a;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((a=this.onRetrieverError)==null?void 0:a.call(this,r)),await this._endTrace(r),r}async handleText(e,t){var a;const r=this.getRunById(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((a=this.onText)==null?void 0:a.call(this,r)))}async handleLLMNewToken(e,t,r,a,i,s){var u;const o=this.getRunById(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:s==null?void 0:s.chunk}}),await((u=this.onLLMNewToken)==null?void 0:u.call(this,o,e,{chunk:s==null?void 0:s.chunk})),o}}var Tr={exports:{}};Tr.exports;var zs;function Ul(){return zs||(zs=1,function(n){const t=(i=0)=>s=>`\x1B[${38+i};5;${s}m`,r=(i=0)=>(s,o,u)=>`\x1B[${38+i};2;${s};${o};${u}m`;function a(){const i=new Map,s={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};s.color.gray=s.color.blackBright,s.bgColor.bgGray=s.bgColor.bgBlackBright,s.color.grey=s.color.blackBright,s.bgColor.bgGrey=s.bgColor.bgBlackBright;for(const[o,u]of Object.entries(s)){for(const[c,l]of Object.entries(u))s[c]={open:`\x1B[${l[0]}m`,close:`\x1B[${l[1]}m`},u[c]=s[c],i.set(l[0],l[1]);Object.defineProperty(s,o,{value:u,enumerable:!1})}return Object.defineProperty(s,"codes",{value:i,enumerable:!1}),s.color.close="\x1B[39m",s.bgColor.close="\x1B[49m",s.color.ansi256=t(),s.color.ansi16m=r(),s.bgColor.ansi256=t(10),s.bgColor.ansi16m=r(10),Object.defineProperties(s,{rgbToAnsi256:{value:(o,u,c)=>o===u&&u===c?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(u/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:o=>{const u=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!u)return[0,0,0];let{colorString:c}=u.groups;c.length===3&&(c=c.split("").map(f=>f+f).join(""));const l=Number.parseInt(c,16);return[l>>16&255,l>>8&255,l&255]},enumerable:!1},hexToAnsi256:{value:o=>s.rgbToAnsi256(...s.hexToRgb(o)),enumerable:!1}}),s}Object.defineProperty(n,"exports",{enumerable:!0,get:a})}(Tr)),Tr.exports}var Fl=Ul();const Po=ir(Fl);function ye(n,e){return`${n.open}${e}${n.close}`}function Ae(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function Bs(n){return typeof n=="string"?n.trim():n==null?n:Ae(n,n.toString())}function st(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Oe}=Po;class qs extends dr{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const a=this.runMap.get(r.parent_run_id);if(a)t.push(a),r=a;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((a,i,s)=>{const o=`${a.execution_order}:${a.run_type}:${a.name}`;return i===s.length-1?ye(Po.bold,o):o}).join(" > ");return ye(Oe.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${ye(Oe.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Ae(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${ye(Oe.cyan,"[chain/end]")} [${t}] [${st(e)}] Exiting Chain run with output: ${Ae(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${ye(Oe.red,"[chain/error]")} [${t}] [${st(e)}] Chain run errored with error: ${Ae(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(a=>a.trim())}:e.inputs;console.log(`${ye(Oe.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Ae(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${ye(Oe.cyan,"[llm/end]")} [${t}] [${st(e)}] Exiting LLM run with output: ${Ae(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${ye(Oe.red,"[llm/error]")} [${t}] [${st(e)}] LLM run errored with error: ${Ae(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${ye(Oe.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Bs(e.inputs.input)}"`)}onToolEnd(e){var r;const t=this.getBreadcrumbs(e);console.log(`${ye(Oe.cyan,"[tool/end]")} [${t}] [${st(e)}] Exiting Tool run with output: "${Bs((r=e.outputs)==null?void 0:r.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${ye(Oe.red,"[tool/error]")} [${t}] [${st(e)}] Tool run errored with error: ${Ae(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${ye(Oe.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Ae(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${ye(Oe.cyan,"[retriever/end]")} [${t}] [${st(e)}] Exiting Retriever run with output: ${Ae(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${ye(Oe.red,"[retriever/error]")} [${t}] [${st(e)}] Retriever run errored with error: ${Ae(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${ye(Oe.blue,"[agent/action]")} [${r}] Agent selected action: ${Ae(t.actions[t.actions.length-1],"[action]")}`)}}let ha;const zl=()=>{if(ha===void 0){const n=xt("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};ha=new tr(n)}return ha};class Jt extends dr{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});const{exampleId:t,projectName:r,client:a,replicas:i}=e;this.projectName=r??wo(),this.replicas=i,this.exampleId=t,this.client=a??zl();const s=Jt.getTraceableRunTree();s&&this.updateFromRunTree(s)}async persistRun(e){}async onRunCreate(e){const t=this.getRunTreeWithTracingConfig(e.id);await(t==null?void 0:t.postRun())}async onRunUpdate(e){const t=this.getRunTreeWithTracingConfig(e.id);await(t==null?void 0:t.patchRun())}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){let t=e;const r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();const a=[t];for(;a.length>0;){const i=a.shift();!i||r.has(i.id)||(r.add(i.id),this.runTreeMap.set(i.id,i),i.child_runs&&a.push(...i.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){const t=this.runTreeMap.get(e);if(t)return new Se({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return $l(!0)}catch{return}}}const No=Symbol.for("ls:tracing_async_local_storage"),Rr=Symbol.for("lc:context_variables"),Bl=n=>{globalThis[No]=n},rr=()=>globalThis[No];let Wt;function ql(){const n="default"in et?et.default:et;return new n({autoStart:!0,concurrency:1})}function Zl(){return typeof Wt>"u"&&(Wt=ql()),Wt}async function fe(n,e){if(e===!0){const t=rr();t!==void 0?await t.run(void 0,async()=>n()):await n()}else Wt=Zl(),Wt.add(async()=>{const t=rr();t!==void 0?await t.run(void 0,async()=>n()):await n()})}const Hl=n=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>xt(t)==="true");function Co(n){var r;const e=rr();if(e===void 0)return;const t=e.getStore();return(r=t==null?void 0:t[Rr])==null?void 0:r[n]}const Gl=Symbol("lc:configure_hooks"),Vl=()=>Co(Gl)||[];function jo(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}class Jl{setHandler(e){return this.setHandlers([e])}}class Kr{constructor(e,t,r,a,i,s,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>fe(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,a,i){await Promise.all(this.handlers.map(s=>fe(async()=>{var o;try{await((o=s.handleCustomEvent)==null?void 0:o.call(s,e,t,this.runId,this.tags,this.metadata))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}}class Wl extends Kr{getChild(e){const t=new Pe(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>fe(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw a}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>fe(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${a}`),t.raiseError)throw e}},t.awaitHandlers)))}}class Zs extends Kr{async handleLLMNewToken(e,t,r,a,i,s){await Promise.all(this.handlers.map(o=>fe(async()=>{var u;if(!o.ignoreLLM)try{await((u=o.handleLLMNewToken)==null?void 0:u.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s))}catch(c){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${c}`),o.raiseError)throw c}},o.awaitHandlers)))}async handleLLMError(e,t,r,a,i){await Promise.all(this.handlers.map(s=>fe(async()=>{var o;if(!s.ignoreLLM)try{await((o=s.handleLLMError)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMError: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}async handleLLMEnd(e,t,r,a,i){await Promise.all(this.handlers.map(s=>fe(async()=>{var o;if(!s.ignoreLLM)try{await((o=s.handleLLMEnd)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMEnd: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}}class Kl extends Kr{getChild(e){const t=new Pe(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,i){await Promise.all(this.handlers.map(s=>fe(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainError)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainError: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}async handleChainEnd(e,t,r,a,i){await Promise.all(this.handlers.map(s=>fe(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainEnd)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,i))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainEnd: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>fe(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>fe(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}}class Xl extends Kr{getChild(e){const t=new Pe(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>fe(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>fe(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(a){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${a}`),t.raiseError)throw a}},t.awaitHandlers)))}}class Pe extends Jl{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,a=void 0,i=void 0,s=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(c,l)=>{const f=l===0&&r?r:be();return await Promise.all(this.handlers.map(d=>{if(!d.ignoreLLM)return zt(d)&&d._createRunForLLMStart(e,[c],f,this._parentRunId,i,this.tags,this.metadata,u),fe(async()=>{var p;try{await((p=d.handleLLMStart)==null?void 0:p.call(d,e,[c],f,this._parentRunId,i,this.tags,this.metadata,u))}catch(h){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleLLMStart: ${h}`),d.raiseError)throw h}},d.awaitHandlers)})),new Zs(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,a=void 0,i=void 0,s=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(c,l)=>{const f=l===0&&r?r:be();return await Promise.all(this.handlers.map(d=>{if(!d.ignoreLLM)return zt(d)&&d._createRunForChatModelStart(e,[c],f,this._parentRunId,i,this.tags,this.metadata,u),fe(async()=>{var p,h;try{if(d.handleChatModelStart)await((p=d.handleChatModelStart)==null?void 0:p.call(d,e,[c],f,this._parentRunId,i,this.tags,this.metadata,u));else if(d.handleLLMStart){const g=ho(c);await((h=d.handleLLMStart)==null?void 0:h.call(d,e,[g],f,this._parentRunId,i,this.tags,this.metadata,u))}}catch(g){if((d.raiseError?console.error:console.warn)(`Error in handler ${d.constructor.name}, handleLLMStart: ${g}`),d.raiseError)throw g}},d.awaitHandlers)})),new Zs(f,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=be(),a=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return zt(u)&&u._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,a,o),fe(async()=>{var c;try{await((c=u.handleChainStart)==null?void 0:c.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,a,o))}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new Kl(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=be(),a=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return zt(u)&&u._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),fe(async()=>{var c;try{await((c=u.handleToolStart)==null?void 0:c.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new Xl(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=be(),a=void 0,i=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return zt(u)&&u._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),fe(async()=>{var c;try{await((c=u.handleRetrieverStart)==null?void 0:c.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(l){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${l}`),u.raiseError)throw l}},u.awaitHandlers)})),new Wl(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,a,i){await Promise.all(this.handlers.map(s=>fe(async()=>{var o;if(!s.ignoreCustomEvent)try{await((o=s.handleCustomEvent)==null?void 0:o.call(s,e,t,r,this.tags,this.metadata))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new Pe(this._parentRunId);for(const a of this.handlers){const i=this.inheritableHandlers.includes(a);r.addHandler(a,i)}for(const a of this.tags){const i=this.inheritableTags.includes(a);r.addTags([a],i)}for(const a of Object.keys(this.metadata)){const i=Object.keys(this.inheritableMetadata).includes(a);r.addMetadata({[a]:this.metadata[a]},i)}for(const a of e)r.handlers.filter(i=>i.name==="console_callback_handler").some(i=>i.name===a.name)||r.addHandler(a,t);return r}static fromHandlers(e){class t extends lr{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:be()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static configure(e,t,r,a,i,s,o){return this._configureSync(e,t,r,a,i,s,o)}static _configureSync(e,t,r,a,i,s,o){var d,p;let u;(e||t)&&(Array.isArray(e)||!e?(u=new Pe,u.setHandlers((e==null?void 0:e.map(zr))??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(zr):t==null?void 0:t.handlers,!1));const c=xt("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),l=((d=Jt.getTraceableRunTree())==null?void 0:d.tracingEnabled)||Hl(),f=l||(xt("LANGCHAIN_TRACING")??!1);if(c||f){if(u||(u=new Pe),c&&!u.handlers.some(h=>h.name===qs.prototype.name)){const h=new qs;u.addHandler(h,!0)}if(f&&!u.handlers.some(h=>h.name==="langchain_tracer")&&l){const h=new Jt;u.addHandler(h,!0),u._parentRunId=((p=Jt.getTraceableRunTree())==null?void 0:p.id)??u._parentRunId}}for(const{contextVar:h,inheritable:g=!0,handlerClass:y,envVar:m}of Vl()){const b=m&&xt(m)==="true"&&y;let _;const v=h!==void 0?Co(h):void 0;v&&jl(v)?_=v:b&&(_=new y({})),_!==void 0&&(u||(u=new Pe),u.handlers.some(w=>w.name===_.name)||u.addHandler(_,g))}return(r||a)&&u&&(u.addTags(r??[]),u.addTags(a??[],!1)),(i||s)&&u&&(u.addMetadata(i??{}),u.addMetadata(s??{},!1)),u}}function zr(n){return"name"in n?n:lr.fromMethods(n)}class Yl{getStore(){}run(e,t){return t()}enterWith(e){}}const Ql=new Yl,Hs=Symbol.for("lc:child_config");class ed{getInstance(){return rr()??Ql}getRunnableConfig(){var t,r;return(r=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:r[Hs]}runWithConfig(e,t,r){var l;const a=Pe._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),i=this.getInstance(),s=i.getStore(),o=a==null?void 0:a.getParentRunId(),u=(l=a==null?void 0:a.handlers)==null?void 0:l.find(f=>(f==null?void 0:f.name)==="langchain_tracer");let c;return u&&o?c=u.getRunTreeWithTracingConfig(o):r||(c=new Se({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[Hs]:e}),s!==void 0&&s[Rr]!==void 0&&(c===void 0&&(c={}),c[Rr]=s[Rr]),i.run(c,t)}initializeGlobalInstance(e){rr()===void 0&&Bl(e)}}const ht=new ed,pa=25;async function Fe(n){return Pe._configureSync(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function Gs(...n){const e={};for(const t of n.filter(r=>!!r))for(const r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){const a=e[r]??[];e[r]=[...new Set(a.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){const a=e.callbacks,i=t.callbacks;if(Array.isArray(i))if(!a)e.callbacks=i;else if(Array.isArray(a))e.callbacks=a.concat(i);else{const s=a.copy();for(const o of i)s.addHandler(zr(o),!0);e.callbacks=s}else if(i)if(!a)e.callbacks=i;else if(Array.isArray(a)){const s=i.copy();for(const o of a)s.addHandler(zr(o),!0);e.callbacks=s}else e.callbacks=new Pe(i._parentRunId,{handlers:a.handlers.concat(i.handlers),inheritableHandlers:a.inheritableHandlers.concat(i.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(i.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(i.inheritableTags))),metadata:{...a.metadata,...i.metadata}})}else{const a=r;e[a]=t[a]??e[a]}return e}const td=new Set(["string","number","boolean"]);function ae(n){var r;const e=ht.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:a,runName:i,...s}=e;t=Object.entries(s).reduce((o,[u,c])=>(c!==void 0&&(o[u]=c),o),t)}if(n&&(t=Object.entries(n).reduce((a,[i,s])=>(s!==void 0&&(a[i]=s),a),t)),t!=null&&t.configurable)for(const a of Object.keys(t.configurable))td.has(typeof t.configurable[a])&&!((r=t.metadata)!=null&&r[a])&&(t.metadata||(t.metadata={}),t.metadata[a]=t.configurable[a]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const a=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,a])):t.signal=a,delete t.timeout}return t}function ge(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:a,configurable:i,runId:s}={}){const o=ae(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),a!==void 0&&(o.runName=a),i!==void 0&&(o.configurable={...o.configurable,...i}),s!==void 0&&delete o.runId,o}function Pt(n){return n?{configurable:n.configurable,recursionLimit:n.recursionLimit,callbacks:n.callbacks,tags:n.tags,metadata:n.metadata,maxConcurrency:n.maxConcurrency,timeout:n.timeout,signal:n.signal}:void 0}async function pt(n,e){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!(e!=null&&e.aborted))throw r}),new Promise((r,a)=>{t=()=>{a(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&a(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class Te extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new Te({start(r){return a();function a(){return t.read().then(({done:i,value:s})=>{if(i){r.close();return}return r.enqueue(s),a()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new Te({async pull(t){const{value:r,done:a}=await e.next();a&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function Lo(n,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(a){for(;;)if(a.length===0){const i=await n.next();for(const s of t)s.push(i)}else{if(a[0].done)return;yield a.shift().value}})}function tt(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){const t={...n};for(const[r,a]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=tt(t[r],a):t[r]=a;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}class jt{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((r,a)=>{ht.runWithConfig(Pt(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(r,a):this.firstResult.then(i=>r(void 0),a)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?ht.runWithConfig(Pt(this.config),this.signal?async()=>pt(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function rd(n,e,t,r,...a){const i=new jt({generator:e,startSetup:t,signal:r}),s=await i.setup;return{output:n(i,s,...a),setup:s}}class ut{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),r=Ur({},t);return new nr({ops:t,state:r[r.length-1].newDocument})}}class nr extends ut{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=Ur(this.state,e.ops);return new nr({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const t=Ur({},e.ops);return new nr({ops:e.ops,state:t[t.length-1].newDocument})}}const nd=n=>n.name==="log_stream_tracer";async function Vs(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function Js(n,e){const{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function ad(n){return n!==void 0&&n.message!==void 0}class Ws extends dr{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Te.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(a=>{var i;return(i=this.includeTags)==null?void 0:i.includes(a)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(a=>{var i;return!((i=this.excludeTags)!=null&&i.includes(a))})),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const a=this.keyMapByRunId[e];a&&await this.writer.write(new ut({ops:[{op:"add",path:`/logs/${a}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var a;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new ut({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await Vs(e,this._schemaFormat)),await this.writer.write(new ut({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await Vs(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await Js(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const a=new ut({ops:r});await this.writer.write(a)}finally{if(e.id===this.rootId){const t=new ut({ops:[{op:"replace",path:"/final_output",value:await Js(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){const a=this.keyMapByRunId[e.id];if(a===void 0)return;const i=e.inputs.messages!==void 0;let s;i?ad(r==null?void 0:r.chunk)?s=r==null?void 0:r.chunk:s=new ur({id:`run-${e.id}`,content:t}):s=t;const o=new ut({ops:[{op:"add",path:`/logs/${a}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${a}/streamed_output/-`,value:s}]});await this.writer.write(o)}}const rp="__run";class ar{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new ar({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class Mo extends ar{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Mo({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}function xr({name:n,serialized:e}){return n!==void 0?n:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const id=n=>n.name==="event_stream_tracer";class sd extends dr{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=Te.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(a=>{var i;return(i=this.includeTags)==null?void 0:i.includes(a)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(a=>{var i;return!((i=this.excludeTags)!=null&&i.includes(a))})),r}async*tapOutputIterable(e,t){const r=await t.next();if(r.done)return;const a=this.runInfoMap.get(e);if(a===void 0){yield r.value;return}function i(o,u){return o==="llm"&&typeof u=="string"?new ar({text:u}):u}let s=this.tappedPromises.get(e);if(s===void 0){let o;s=new Promise(u=>{o=u}),this.tappedPromises.set(e,s);try{const u={event:`on_${a.runType}_stream`,run_id:e,name:a.name,tags:a.tags,metadata:a.metadata,data:{}};await this.send({...u,data:{chunk:i(a.runType,r.value)}},a),yield r.value;for await(const c of t)a.runType!=="tool"&&a.runType!=="retriever"&&await this.send({...u,data:{chunk:i(a.runType,c)}},a),yield c}finally{o()}}else{yield r.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var s,o;const t=xr(e),r=e.inputs.messages!==void 0?"chat_model":"llm",a={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,a);const i=`on_${r}_start`;await this.send({event:i,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},a)}async onLLMNewToken(e,t,r){const a=this.runInfoMap.get(e.id);let i,s;if(a===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(a.runType==="chat_model")s="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?i=new ur({content:t,id:`run-${e.id}`}):i=r.chunk.message;else if(a.runType==="llm")s="on_llm_stream",(r==null?void 0:r.chunk)===void 0?i=new ar({text:t}):i=r.chunk;else throw new Error(`Unexpected run type ${a.runType}`);await this.send({event:s,data:{chunk:i},run_id:e.id,name:a.name,tags:a.tags,metadata:a.metadata},a)}}async onLLMEnd(e){var s,o,u;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const a=(s=e.outputs)==null?void 0:s.generations;let i;if(t.runType==="chat_model"){for(const c of a??[]){if(i!==void 0)break;i=(o=c[0])==null?void 0:o.message}r="on_chat_model_end"}else if(t.runType==="llm")i={generations:a==null?void 0:a.map(c=>c.map(l=>({text:l.text,generationInfo:l.generationInfo}))),llmOutput:((u=e.outputs)==null?void 0:u.llmOutput)??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:r,data:{output:i,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var s,o;const t=xr(e),r=e.run_type??"chain",a={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:e.run_type};let i={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(i={},a.inputs={}):e.inputs.input!==void 0?(i.input=e.inputs.input,a.inputs=e.inputs.input):(i.input=e.inputs,a.inputs=e.inputs),this.runInfoMap.set(e.id,a),await this.send({event:`on_${r}_start`,data:i,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},a)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,a=e.inputs??t.inputs??{},s={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:a};a.input&&Object.keys(a).length===1&&(s.input=a.input,t.inputs=a.input),await this.sendEndEvent({event:r,data:s,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var a,i;const t=xr(e),r={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{}},r)}async onToolEnd(e){var a;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=((a=e.outputs)==null?void 0:a.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var i,s;const t=xr(e),a={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,a),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((s=e.extra)==null?void 0:s.metadata)??{}},a)}async onRetrieverEnd(e){var r;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((r=e.outputs)==null?void 0:r.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){const a=this.runInfoMap.get(r);if(a===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:a.tags,metadata:a.metadata,data:t},a)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const od=[400,401,402,403,404,405,406,407,409],ud=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&od.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const a=new Error(n==null?void 0:n.message);throw a.name="InsufficientQuotaError",a}};class ei{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??ud;const t="default"in et?et.default:et;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Lr(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((a,i)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{i(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class Do extends dr{constructor({config:e,onStart:t,onEnd:r,onError:a}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function ti(n){return n?n.lc_runnable:!1}class cd{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const a=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||a.some(i=>{var s;return(s=this.includeTags)==null?void 0:s.includes(i)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&a.every(i=>{var s;return!((s=this.excludeTags)!=null&&s.includes(i))})),r}}function ma(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}const ld=["*","_","`"];function dd(n){let e="";for(const[t,r]of Object.entries(n))e+=`	classDef ${t} ${r};
`;return e}function fd(n,e,t){const{firstNode:r,lastNode:a,nodeColors:i,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{};let c=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(s){const p="default",h={[p]:"{0}({1})"};r!==void 0&&(h[r]="{0}([{1}]):::first"),a!==void 0&&(h[a]="{0}([{1}]):::last");for(const[g,y]of Object.entries(n)){const m=y.name.split(":").pop()??"";let _=ld.some(w=>m.startsWith(w)&&m.endsWith(w))?`<p>${m}</p>`:m;Object.keys(y.metadata??{}).length&&(_+=`<hr/><small><em>${Object.entries(y.metadata??{}).map(([w,x])=>`${w} = ${x}`).join(`
`)}</em></small>`);const v=(h[g]??h[p]).replace("{0}",ma(g)).replace("{1}",_);c+=`	${v}
`}}const l={};for(const p of e){const h=p.source.split(":"),g=p.target.split(":"),y=h.filter((m,b)=>m===g[b]).join(":");l[y]||(l[y]=[]),l[y].push(p)}const f=new Set;function d(p,h){const g=p.length===1&&p[0].source===p[0].target;if(h&&!g){const y=h.split(":").pop();if(f.has(y))throw new Error(`Found duplicate subgraph '${y}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);f.add(y),c+=`	subgraph ${y}
`}for(const y of p){const{source:m,target:b,data:_,conditional:v}=y;let w="";if(_!==void 0){let x=_;const L=x.split(" ");L.length>u&&(x=Array.from({length:Math.ceil(L.length/u)},(k,le)=>L.slice(le*u,(le+1)*u).join(" ")).join("&nbsp;<br>&nbsp;")),w=v?` -. &nbsp;${x}&nbsp; .-> `:` -- &nbsp;${x}&nbsp; --> `}else w=v?" -.-> ":" --> ";c+=`	${ma(m)}${w}${ma(b)};
`}for(const y in l)y.startsWith(`${h}:`)&&y!==h&&d(l[y],y);h&&!g&&(c+=`	end
`)}d(l[""]??[],"");for(const p in l)!p.includes(":")&&p!==""&&d(l[p],p);return s&&(c+=dd(i??{})),c}async function hd(n,e){let{backgroundColor:t="white"}=e??{};const r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const a=`https://mermaid.ink/img/${r}?bgColor=${t}`,i=await fetch(a);if(!i.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${i.status}`,`Status text: ${i.statusText}`].join(`
`));return await i.blob()}function Xr(n,e,t){function r(o,u){var c;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(c=o._zod).traits??(c.traits=new Set),o._zod.traits.add(n),e(o,u);for(const l in s.prototype)l in o||Object.defineProperty(o,l,{value:s.prototype[l].bind(o)});o._zod.constr=s,o._zod.def=u}const a=(t==null?void 0:t.Parent)??Object;class i extends a{}Object.defineProperty(i,"name",{value:n});function s(o){var u;const c=t!=null&&t.Parent?new i:this;r(c,o),(u=c._zod).deferred??(u.deferred=[]);for(const l of c._zod.deferred)l();return c}return Object.defineProperty(s,"init",{value:r}),Object.defineProperty(s,Symbol.hasInstance,{value:o=>{var u,c;return t!=null&&t.Parent&&o instanceof t.Parent?!0:(c=(u=o==null?void 0:o._zod)==null?void 0:u.traits)==null?void 0:c.has(n)}}),Object.defineProperty(s,"name",{value:n}),s}class Br extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const pd={};function Yr(n){return pd}function md(n){const e=Object.values(n).filter(r=>typeof r=="number");return Object.entries(n).filter(([r,a])=>e.indexOf(+r)===-1).map(([r,a])=>a)}function gd(n,e){return typeof e=="bigint"?e.toString():e}function yd(n,e,t){Object.defineProperty(n,e,{get(){{const r=t();return n[e]=r,r}},set(r){Object.defineProperty(n,e,{value:r})},configurable:!0})}function _d(n=10){const e="abcdefghijklmnopqrstuvwxyz";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}const Uo=Error.captureStackTrace?Error.captureStackTrace:(...n)=>{};function Ks(n,e,t){const r=new n._zod.constr(e??n._zod.def);return(!e||t!=null&&t.parent)&&(r._zod.parent=n),r}function bd(n){return{}}function ga(n,e=0){for(let t=e;t<n.issues.length;t++)if(n.issues[t].continue!==!0)return!0;return!1}function $r(n){return typeof n=="string"?n:n==null?void 0:n.message}function Qr(n,e,t){var a,i,s,o,u,c;const r={...n,path:n.path??[]};if(!n.message){const l=$r((s=(i=(a=n.inst)==null?void 0:a._zod.def)==null?void 0:i.error)==null?void 0:s.call(i,n))??$r((o=e==null?void 0:e.error)==null?void 0:o.call(e,n))??$r((u=t.customError)==null?void 0:u.call(t,n))??$r((c=t.localeError)==null?void 0:c.call(t,n))??"Invalid input";r.message=l}return delete r.inst,delete r.continue,e!=null&&e.reportInput||delete r.input,r}const Fo=(n,e)=>{n.name="$ZodError",Object.defineProperty(n,"_zod",{value:n._zod,enumerable:!1}),Object.defineProperty(n,"issues",{value:e,enumerable:!1}),Object.defineProperty(n,"message",{get(){return JSON.stringify(e,gd,2)},enumerable:!0})},wd=Xr("$ZodError",Fo),en=Xr("$ZodError",Fo,{Parent:Error}),vd=n=>(e,t,r,a)=>{const i=r?Object.assign(r,{async:!1}):{async:!1},s=e._zod.run({value:t,issues:[]},i);if(s instanceof Promise)throw new Br;if(s.issues.length){const o=new((a==null?void 0:a.Err)??n)(s.issues.map(u=>Qr(u,i,Yr())));throw Uo(o,a==null?void 0:a.callee),o}return s.value},Ed=vd(en),Od=n=>async(e,t,r,a)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let s=e._zod.run({value:t,issues:[]},i);if(s instanceof Promise&&(s=await s),s.issues.length){const o=new((a==null?void 0:a.Err)??n)(s.issues.map(u=>Qr(u,i,Yr())));throw Uo(o,a==null?void 0:a.callee),o}return s.value},Sd=Od(en),xd=n=>(e,t,r)=>{const a=r?{...r,async:!1}:{async:!1},i=e._zod.run({value:t,issues:[]},a);if(i instanceof Promise)throw new Br;return i.issues.length?{success:!1,error:new(n??wd)(i.issues.map(s=>Qr(s,a,Yr())))}:{success:!0,data:i.value}},$d=xd(en),Id=n=>async(e,t,r)=>{const a=r?Object.assign(r,{async:!0}):{async:!0};let i=e._zod.run({value:t,issues:[]},a);return i instanceof Promise&&(i=await i),i.issues.length?{success:!1,error:new n(i.issues.map(s=>Qr(s,a,Yr())))}:{success:!0,data:i.value}},Td=Id(en),Rd={major:4,minor:0,patch:0},kd=Xr("$ZodType",(n,e)=>{var a;var t;n??(n={}),yd(n._zod,"id",()=>e.type+"_"+_d(10)),n._zod.def=e,n._zod.bag=n._zod.bag||{},n._zod.version=Rd;const r=[...n._zod.def.checks??[]];n._zod.traits.has("$ZodCheck")&&r.unshift(n);for(const i of r)for(const s of i._zod.onattach)s(n);if(r.length===0)(t=n._zod).deferred??(t.deferred=[]),(a=n._zod.deferred)==null||a.push(()=>{n._zod.run=n._zod.parse});else{const i=(s,o,u)=>{let c=ga(s),l;for(const f of o){if(f._zod.when){if(!f._zod.when(s))continue}else if(c)continue;const d=s.issues.length,p=f._zod.check(s);if(p instanceof Promise&&(u==null?void 0:u.async)===!1)throw new Br;if(l||p instanceof Promise)l=(l??Promise.resolve()).then(async()=>{await p,s.issues.length!==d&&(c||(c=ga(s,d)))});else{if(s.issues.length===d)continue;c||(c=ga(s,d))}}return l?l.then(()=>s):s};n._zod.run=(s,o)=>{const u=n._zod.parse(s,o);if(u instanceof Promise){if(o.async===!1)throw new Br;return u.then(c=>i(c,r,o))}return i(u,r,o)}}n["~standard"]={validate:i=>{var s;try{const o=$d(n,i);return o.success?{value:o.data}:{issues:(s=o.error)==null?void 0:s.issues}}catch{return Td(n,i).then(u=>{var c;return u.success?{value:u.data}:{issues:(c=u.error)==null?void 0:c.issues}})}},vendor:"zod",version:1}}),Ad=Xr("$ZodNever",(n,e)=>{kd.init(n,e),n._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:n}),t)});class zo{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){const r=t[0];if(this._map.set(e,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}remove(e){return this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const r={...this.get(t)??{}};return delete r.id,{...r,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function Pd(){return new zo}const St=Pd();function Nd(n,e){return new n({type:"never",...bd()})}class Xs{constructor(e){this.counter=0,this.metadataRegistry=(e==null?void 0:e.metadata)??St,this.target=(e==null?void 0:e.target)??"draft-2020-12",this.unrepresentable=(e==null?void 0:e.unrepresentable)??"throw",this.override=(e==null?void 0:e.override)??(()=>{}),this.io=(e==null?void 0:e.io)??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var f,d,p;var r;const a=e._zod.def,i={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},s=this.seen.get(e);if(s)return s.count++,t.schemaPath.includes(e)&&(s.cycle=t.path),s.schema;const o={schema:{},count:1,cycle:void 0};this.seen.set(e,o);const u=(d=(f=e._zod).toJSONSchema)==null?void 0:d.call(f);if(u)o.schema=u;else{const h={...t,schemaPath:[...t.schemaPath,e],path:t.path},g=e._zod.parent;if(g)o.ref=g,this.process(g,h),this.seen.get(g).isParent=!0;else{const y=o.schema;switch(a.type){case"string":{const m=y;m.type="string";const{minimum:b,maximum:_,format:v,patterns:w,contentEncoding:x}=e._zod.bag;if(typeof b=="number"&&(m.minLength=b),typeof _=="number"&&(m.maxLength=_),v&&(m.format=i[v]??v,m.format===""&&delete m.format),x&&(m.contentEncoding=x),w&&w.size>0){const L=[...w];L.length===1?m.pattern=L[0].source:L.length>1&&(o.schema.allOf=[...L.map(k=>({...this.target==="draft-7"?{type:"string"}:{},pattern:k.source}))])}break}case"number":{const m=y,{minimum:b,maximum:_,format:v,multipleOf:w,exclusiveMaximum:x,exclusiveMinimum:L}=e._zod.bag;typeof v=="string"&&v.includes("int")?m.type="integer":m.type="number",typeof L=="number"&&(m.exclusiveMinimum=L),typeof b=="number"&&(m.minimum=b,typeof L=="number"&&(L>=b?delete m.minimum:delete m.exclusiveMinimum)),typeof x=="number"&&(m.exclusiveMaximum=x),typeof _=="number"&&(m.maximum=_,typeof x=="number"&&(x<=_?delete m.maximum:delete m.exclusiveMaximum)),typeof w=="number"&&(m.multipleOf=w);break}case"boolean":{const m=y;m.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"undefined":{const m=y;m.type="null";break}case"null":{y.type="null";break}case"any":break;case"unknown":break;case"never":{y.not={};break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const m=y,{minimum:b,maximum:_}=e._zod.bag;typeof b=="number"&&(m.minItems=b),typeof _=="number"&&(m.maxItems=_),m.type="array",m.items=this.process(a.element,{...h,path:[...h.path,"items"]});break}case"object":{const m=y;m.type="object",m.properties={};const b=a.shape;for(const w in b)m.properties[w]=this.process(b[w],{...h,path:[...h.path,"properties",w]});const _=new Set(Object.keys(b)),v=new Set([..._].filter(w=>{const x=a.shape[w]._zod;return this.io==="input"?x.optin===void 0:x.optout===void 0}));v.size>0&&(m.required=Array.from(v)),((p=a.catchall)==null?void 0:p._zod.def.type)==="never"?m.additionalProperties=!1:a.catchall?a.catchall&&(m.additionalProperties=this.process(a.catchall,{...h,path:[...h.path,"additionalProperties"]})):this.io==="output"&&(m.additionalProperties=!1);break}case"union":{const m=y;m.anyOf=a.options.map((b,_)=>this.process(b,{...h,path:[...h.path,"anyOf",_]}));break}case"intersection":{const m=y,b=this.process(a.left,{...h,path:[...h.path,"allOf",0]}),_=this.process(a.right,{...h,path:[...h.path,"allOf",1]}),v=x=>"allOf"in x&&Object.keys(x).length===1,w=[...v(b)?b.allOf:[b],...v(_)?_.allOf:[_]];m.allOf=w;break}case"tuple":{const m=y;m.type="array";const b=a.items.map((w,x)=>this.process(w,{...h,path:[...h.path,"prefixItems",x]}));if(this.target==="draft-2020-12"?m.prefixItems=b:m.items=b,a.rest){const w=this.process(a.rest,{...h,path:[...h.path,"items"]});this.target==="draft-2020-12"?m.items=w:m.additionalItems=w}a.rest&&(m.items=this.process(a.rest,{...h,path:[...h.path,"items"]}));const{minimum:_,maximum:v}=e._zod.bag;typeof _=="number"&&(m.minItems=_),typeof v=="number"&&(m.maxItems=v);break}case"record":{const m=y;m.type="object",m.propertyNames=this.process(a.keyType,{...h,path:[...h.path,"propertyNames"]}),m.additionalProperties=this.process(a.valueType,{...h,path:[...h.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const m=y,b=md(a.entries);b.every(_=>typeof _=="number")&&(m.type="number"),b.every(_=>typeof _=="string")&&(m.type="string"),m.enum=b;break}case"literal":{const m=y,b=[];for(const _ of a.values)if(_===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof _=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");b.push(Number(_))}else b.push(_);if(b.length!==0)if(b.length===1){const _=b[0];m.type=_===null?"null":typeof _,m.const=_}else b.every(_=>typeof _=="number")&&(m.type="number"),b.every(_=>typeof _=="string")&&(m.type="string"),b.every(_=>typeof _=="boolean")&&(m.type="string"),b.every(_=>_===null)&&(m.type="null"),m.enum=b;break}case"file":{const m=y,b={type:"string",format:"binary",contentEncoding:"binary"},{minimum:_,maximum:v,mime:w}=e._zod.bag;_!==void 0&&(b.minLength=_),v!==void 0&&(b.maxLength=v),w?w.length===1?(b.contentMediaType=w[0],Object.assign(m,b)):m.anyOf=w.map(x=>({...b,contentMediaType:x})):Object.assign(m,b);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const m=this.process(a.innerType,h);y.anyOf=[m,{type:"null"}];break}case"nonoptional":{this.process(a.innerType,h),o.ref=a.innerType;break}case"success":{const m=y;m.type="boolean";break}case"default":{this.process(a.innerType,h),o.ref=a.innerType,y.default=JSON.parse(JSON.stringify(a.defaultValue));break}case"prefault":{this.process(a.innerType,h),o.ref=a.innerType,this.io==="input"&&(y._prefault=JSON.parse(JSON.stringify(a.defaultValue)));break}case"catch":{this.process(a.innerType,h),o.ref=a.innerType;let m;try{m=a.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}y.default=m;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const m=y,b=e._zod.pattern;if(!b)throw new Error("Pattern not found in template literal");m.type="string",m.pattern=b.source;break}case"pipe":{const m=this.io==="input"?a.in._zod.def.type==="transform"?a.out:a.in:a.out;this.process(m,h),o.ref=m;break}case"readonly":{this.process(a.innerType,h),o.ref=a.innerType,y.readOnly=!0;break}case"promise":{this.process(a.innerType,h),o.ref=a.innerType;break}case"optional":{this.process(a.innerType,h),o.ref=a.innerType;break}case"lazy":{const m=e._zod.innerType;this.process(m,h),o.ref=m;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}}const c=this.metadataRegistry.get(e);return c&&Object.assign(o.schema,c),this.io==="input"&&de(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((r=o.schema).default??(r.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,t){var l,f,d,p;const r={cycles:(t==null?void 0:t.cycles)??"ref",reused:(t==null?void 0:t.reused)??"inline",external:(t==null?void 0:t.external)??void 0},a=this.seen.get(e);if(!a)throw new Error("Unprocessed schema. This is a bug in Zod.");const i=h=>{var _;const g=this.target==="draft-2020-12"?"$defs":"definitions";if(r.external){const v=(_=r.external.registry.get(h[0]))==null?void 0:_.id;if(v)return{ref:r.external.uri(v)};const w=h[1].defId??h[1].schema.id??`schema${this.counter++}`;return h[1].defId=w,{defId:w,ref:`${r.external.uri("__shared")}#/${g}/${w}`}}if(h[1]===a)return{ref:"#"};const m=`#/${g}/`,b=h[1].schema.id??`__schema${this.counter++}`;return{defId:b,ref:m+b}},s=h=>{if(h[1].schema.$ref)return;const g=h[1],{ref:y,defId:m}=i(h);g.def={...g.schema},m&&(g.defId=m);const b=g.schema;for(const _ in b)delete b[_];b.$ref=y};for(const h of this.seen.entries()){const g=h[1];if(e===h[0]){s(h);continue}if(r.external){const m=(l=r.external.registry.get(h[0]))==null?void 0:l.id;if(e!==h[0]&&m){s(h);continue}}if((f=this.metadataRegistry.get(h[0]))==null?void 0:f.id){s(h);continue}if(g.cycle){if(r.cycles==="throw")throw new Error(`Cycle detected: #/${(d=g.cycle)==null?void 0:d.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`);r.cycles==="ref"&&s(h);continue}if(g.count>1&&r.reused==="ref"){s(h);continue}}const o=(h,g)=>{const y=this.seen.get(h),m=y.def??y.schema,b={...m};if(y.ref===null)return;const _=y.ref;if(y.ref=null,_){o(_,g);const v=this.seen.get(_).schema;v.$ref&&g.target==="draft-7"?(m.allOf=m.allOf??[],m.allOf.push(v)):(Object.assign(m,v),Object.assign(m,b))}y.isParent||this.override({zodSchema:h,jsonSchema:m})};for(const h of[...this.seen.entries()].reverse())o(h[0],{target:this.target});const u={};this.target==="draft-2020-12"?u.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?u.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),Object.assign(u,a.def);const c=((p=r.external)==null?void 0:p.defs)??{};for(const h of this.seen.entries()){const g=h[1];g.def&&g.defId&&(c[g.defId]=g.def)}!r.external&&Object.keys(c).length>0&&(this.target==="draft-2020-12"?u.$defs=c:u.definitions=c);try{return JSON.parse(JSON.stringify(u))}catch{throw new Error("Error converting schema to JSON.")}}}function Ys(n,e){if(n instanceof zo){const r=new Xs(e),a={};for(const o of n._idmap.entries()){const[u,c]=o;r.process(c)}const i={},s={registry:n,uri:o=>o,defs:a};for(const o of n._idmap.entries()){const[u,c]=o;i[u]=r.emit(c,{...e,external:s})}if(Object.keys(a).length>0){const o=r.target==="draft-2020-12"?"$defs":"definitions";i.__shared={[o]:a}}return{schemas:i}}const t=new Xs(e);return t.process(n),t.emit(n,e)}function de(n,e){const t=e??{seen:new Set};if(t.seen.has(n))return!1;t.seen.add(n);const a=n._zod.def;switch(a.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return de(a.element,t);case"object":{for(const i in a.shape)if(de(a.shape[i],t))return!0;return!1}case"union":{for(const i of a.options)if(de(i,t))return!0;return!1}case"intersection":return de(a.left,t)||de(a.right,t);case"tuple":{for(const i of a.items)if(de(i,t))return!0;return!!(a.rest&&de(a.rest,t))}case"record":return de(a.keyType,t)||de(a.valueType,t);case"map":return de(a.keyType,t)||de(a.valueType,t);case"set":return de(a.valueType,t);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return de(a.innerType,t);case"lazy":return de(a.getter(),t);case"default":return de(a.innerType,t);case"prefault":return de(a.innerType,t);case"custom":return!1;case"transform":return!0;case"pipe":return de(a.in,t)||de(a.out,t);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${a.type}`)}const Cd=Symbol("Let zodToJsonSchema decide on which parser to use"),jd={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Ld=n=>({...jd,...n}),Md=n=>{const e=Ld(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,a])=>[a._def,{def:a._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function Bo(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function ie(n,e,t,r,a){n[e]=t,Bo(n,e,r,a)}function Dd(){return{}}function Ud(n,e){var r,a,i;const t={type:"array"};return(r=n.type)!=null&&r._def&&((i=(a=n.type)==null?void 0:a._def)==null?void 0:i.typeName)!==O.ZodAny&&(t.items=ne(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&ie(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&ie(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(ie(t,"minItems",n.exactLength.value,n.exactLength.message,e),ie(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Fd(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?ie(t,"minimum",r.value,r.message,e):ie(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),ie(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?ie(t,"maximum",r.value,r.message,e):ie(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),ie(t,"maximum",r.value,r.message,e));break;case"multipleOf":ie(t,"multipleOf",r.value,r.message,e);break}return t}function zd(){return{type:"boolean"}}function qo(n,e){return ne(n.type._def,e)}const Bd=(n,e)=>ne(n.innerType._def,e);function Zo(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((a,i)=>Zo(n,e,a))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return qd(n,e)}}const qd=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":ie(t,"minimum",r.value,r.message,e);break;case"max":ie(t,"maximum",r.value,r.message,e);break}return t};function Zd(n,e){return{...ne(n.innerType._def,e),default:n.defaultValue()}}function Hd(n,e){return e.effectStrategy==="input"?ne(n.schema._def,e):{}}function Gd(n){return{type:"string",enum:Array.from(n.values)}}const Vd=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function Jd(n,e){const t=[ne(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),ne(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(i=>!!i);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const a=[];return t.forEach(i=>{if(Vd(i))a.push(...i.allOf),i.unevaluatedProperties===void 0&&(r=void 0);else{let s=i;if("additionalProperties"in i&&i.additionalProperties===!1){const{additionalProperties:o,...u}=i;s=u}else r=void 0;a.push(s)}}),a.length?{allOf:a,...r}:void 0}function Wd(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let ya;const Le={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(ya===void 0&&(ya=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),ya),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Ho(n,e){const t={type:"string"};if(n.checks)for(const r of n.checks)switch(r.kind){case"min":ie(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":ie(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Me(t,"email",r.message,e);break;case"format:idn-email":Me(t,"idn-email",r.message,e);break;case"pattern:zod":_e(t,Le.email,r.message,e);break}break;case"url":Me(t,"uri",r.message,e);break;case"uuid":Me(t,"uuid",r.message,e);break;case"regex":_e(t,r.regex,r.message,e);break;case"cuid":_e(t,Le.cuid,r.message,e);break;case"cuid2":_e(t,Le.cuid2,r.message,e);break;case"startsWith":_e(t,RegExp(`^${_a(r.value,e)}`),r.message,e);break;case"endsWith":_e(t,RegExp(`${_a(r.value,e)}$`),r.message,e);break;case"datetime":Me(t,"date-time",r.message,e);break;case"date":Me(t,"date",r.message,e);break;case"time":Me(t,"time",r.message,e);break;case"duration":Me(t,"duration",r.message,e);break;case"length":ie(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),ie(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{_e(t,RegExp(_a(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Me(t,"ipv4",r.message,e),r.version!=="v4"&&Me(t,"ipv6",r.message,e);break}case"base64url":_e(t,Le.base64url,r.message,e);break;case"jwt":_e(t,Le.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&_e(t,Le.ipv4Cidr,r.message,e),r.version!=="v4"&&_e(t,Le.ipv6Cidr,r.message,e);break}case"emoji":_e(t,Le.emoji(),r.message,e);break;case"ulid":{_e(t,Le.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Me(t,"binary",r.message,e);break}case"contentEncoding:base64":{ie(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{_e(t,Le.base64,r.message,e);break}}break}case"nanoid":_e(t,Le.nanoid,r.message,e)}return t}function _a(n,e){return e.patternStrategy==="escape"?Xd(n):n}const Kd=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Xd(n){let e="";for(let t=0;t<n.length;t++)Kd.has(n[t])||(e+="\\"),e+=n[t];return e}function Me(n,e,t,r){var a;n.format||(a=n.anyOf)!=null&&a.some(i=>i.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):ie(n,"format",e,t,r)}function _e(n,e,t,r){var a;n.pattern||(a=n.allOf)!=null&&a.some(i=>i.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:Qs(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):ie(n,"pattern",Qs(e,r),t,r)}function Qs(n,e){var u;if(!e.applyRegexFlags||!n.flags)return n.source;const t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source;let a="",i=!1,s=!1,o=!1;for(let c=0;c<r.length;c++){if(i){a+=r[c],i=!1;continue}if(t.i){if(s){if(r[c].match(/[a-z]/)){o?(a+=r[c],a+=`${r[c-2]}-${r[c]}`.toUpperCase(),o=!1):r[c+1]==="-"&&((u=r[c+2])!=null&&u.match(/[a-z]/))?(a+=r[c],o=!0):a+=`${r[c]}${r[c].toUpperCase()}`;continue}}else if(r[c].match(/[a-z]/)){a+=`[${r[c]}${r[c].toUpperCase()}]`;continue}}if(t.m){if(r[c]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(r[c]==="$"){a+=`($|(?=[\r
]))`;continue}}if(t.s&&r[c]==="."){a+=s?`${r[c]}\r
`:`[${r[c]}\r
]`;continue}a+=r[c],r[c]==="\\"?i=!0:s&&r[c]==="]"?s=!1:!s&&r[c]==="["&&(s=!0)}try{new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return a}function Go(n,e){var r,a,i,s,o,u;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===O.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((c,l)=>({...c,[l]:ne(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:ne(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((a=n.keyType)==null?void 0:a._def.typeName)===O.ZodString&&((i=n.keyType._def.checks)!=null&&i.length)){const{type:c,...l}=Ho(n.keyType._def,e);return{...t,propertyNames:l}}else{if(((s=n.keyType)==null?void 0:s._def.typeName)===O.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(((o=n.keyType)==null?void 0:o._def.typeName)===O.ZodBranded&&n.keyType._def.type._def.typeName===O.ZodString&&((u=n.keyType._def.type._def.checks)!=null&&u.length)){const{type:c,...l}=qo(n.keyType._def,e);return{...t,propertyNames:l}}}return t}function Yd(n,e){if(e.mapStrategy==="record")return Go(n,e);const t=ne(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=ne(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function Qd(n){const e=n.values,r=Object.keys(n.values).filter(i=>typeof e[e[i]]!="number").map(i=>e[i]),a=Array.from(new Set(r.map(i=>typeof i)));return{type:a.length===1?a[0]==="string"?"string":"number":["string","number"],enum:r}}function ef(){return{not:{}}}function tf(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const qr={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function rf(n,e){if(e.target==="openApi3")return eo(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in qr&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((a,i)=>{const s=qr[i._def.typeName];return s&&!a.includes(s)?[...a,s]:a},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((a,i)=>{const s=typeof i._def.value;switch(s){case"string":case"number":case"boolean":return[...a,s];case"bigint":return[...a,"integer"];case"object":if(i._def.value===null)return[...a,"null"];case"symbol":case"undefined":case"function":default:return a}},[]);if(r.length===t.length){const a=r.filter((i,s,o)=>o.indexOf(i)===s);return{type:a.length>1?a:a[0],enum:t.reduce((i,s)=>i.includes(s._def.value)?i:[...i,s._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,a)=>[...r,...a._def.values.filter(i=>!r.includes(i))],[])};return eo(n,e)}const eo=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,a)=>ne(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${a}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function nf(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:qr[n.innerType._def.typeName],nullable:!0}:{type:[qr[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=ne(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=ne(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function af(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",Bo(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?ie(t,"minimum",r.value,r.message,e):ie(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),ie(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?ie(t,"maximum",r.value,r.message,e):ie(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),ie(t,"maximum",r.value,r.message,e));break;case"multipleOf":ie(t,"multipleOf",r.value,r.message,e);break}return t}function sf(n,e){const t=e.target==="openAi",r={type:"object",properties:{}},a=[],i=n.shape();for(const o in i){let u=i[o];if(u===void 0||u._def===void 0)continue;let c=uf(u);c&&t&&(u instanceof Qe&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),c=!1);const l=ne(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});l!==void 0&&(r.properties[o]=l,c||a.push(o))}a.length&&(r.required=a);const s=of(n,e);return s!==void 0&&(r.additionalProperties=s),r}function of(n,e){if(n.catchall._def.typeName!=="ZodNever")return ne(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function uf(n){try{return n.isOptional()}catch{return!0}}const cf=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return ne(n.innerType._def,e);const t=ne(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},lf=(n,e)=>{if(e.pipeStrategy==="input")return ne(n.in._def,e);if(e.pipeStrategy==="output")return ne(n.out._def,e);const t=ne(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=ne(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(a=>a!==void 0)}};function df(n,e){return ne(n.type._def,e)}function ff(n,e){const r={type:"array",uniqueItems:!0,items:ne(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&ie(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&ie(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function hf(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>ne(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:ne(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>ne(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function pf(){return{not:{}}}function mf(){return{}}const gf=(n,e)=>ne(n.innerType._def,e),yf=(n,e,t)=>{switch(e){case O.ZodString:return Ho(n,t);case O.ZodNumber:return af(n,t);case O.ZodObject:return sf(n,t);case O.ZodBigInt:return Fd(n,t);case O.ZodBoolean:return zd();case O.ZodDate:return Zo(n,t);case O.ZodUndefined:return pf();case O.ZodNull:return tf(t);case O.ZodArray:return Ud(n,t);case O.ZodUnion:case O.ZodDiscriminatedUnion:return rf(n,t);case O.ZodIntersection:return Jd(n,t);case O.ZodTuple:return hf(n,t);case O.ZodRecord:return Go(n,t);case O.ZodLiteral:return Wd(n,t);case O.ZodEnum:return Gd(n);case O.ZodNativeEnum:return Qd(n);case O.ZodNullable:return nf(n,t);case O.ZodOptional:return cf(n,t);case O.ZodMap:return Yd(n,t);case O.ZodSet:return ff(n,t);case O.ZodLazy:return()=>n.getter()._def;case O.ZodPromise:return df(n,t);case O.ZodNaN:case O.ZodNever:return ef();case O.ZodEffects:return Hd(n,t);case O.ZodAny:return Dd();case O.ZodUnknown:return mf();case O.ZodDefault:return Zd(n,t);case O.ZodBranded:return qo(n,t);case O.ZodReadonly:return gf(n,t);case O.ZodCatch:return Bd(n,t);case O.ZodPipeline:return lf(n,t);case O.ZodFunction:case O.ZodVoid:case O.ZodSymbol:return;default:return(r=>{})()}};function ne(n,e,t=!1){var o;const r=e.seen.get(n);if(e.override){const u=(o=e.override)==null?void 0:o.call(e,n,e,r,t);if(u!==Cd)return u}if(r&&!t){const u=_f(r,e);if(u!==void 0)return u}const a={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,a);const i=yf(n,n.typeName,e),s=typeof i=="function"?ne(i(),e):i;if(s&&wf(n,e,s),e.postProcess){const u=e.postProcess(s,n,e);return a.jsonSchema=s,u}return a.jsonSchema=s,s}const _f=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:bf(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},bf=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},wf=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),vf=(n,e)=>{const t=Md(e),r=void 0,a=e==null?void 0:e.name,i=ne(n._def,t,!1)??{},s=a===void 0?r?{...i,[t.definitionPath]:r}:i:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,a].join("/"),[t.definitionPath]:{...r,[a]:i}};return t.target==="jsonSchema7"?s.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in s||"oneOf"in s||"allOf"in s||"type"in s&&Array.isArray(s.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),s};function Kt(n,e){const t=typeof n;if(t!==typeof e)return!1;if(Array.isArray(n)){if(!Array.isArray(e))return!1;const r=n.length;if(r!==e.length)return!1;for(let a=0;a<r;a++)if(!Kt(n[a],e[a]))return!1;return!0}if(t==="object"){if(!n||!e)return n===e;const r=Object.keys(n),a=Object.keys(e);if(r.length!==a.length)return!1;for(const s of r)if(!Kt(n[s],e[s]))return!1;return!0}return n===e}function Ue(n){return encodeURI(Ef(n))}function Ef(n){return n.replace(/~/g,"~0").replace(/\//g,"~1")}const Of={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},Sf={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},xf={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let $f=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function Zt(n,e=Object.create(null),t=$f,r=""){if(n&&typeof n=="object"&&!Array.isArray(n)){const i=n.$id||n.id;if(i){const s=new URL(i,t.href);s.hash.length>1?e[s.href]=n:(s.hash="",r===""?t=s:Zt(n,e,t))}}else if(n!==!0&&n!==!1)return e;const a=t.href+(r?"#"+r:"");if(e[a]!==void 0)throw new Error(`Duplicate schema URI "${a}".`);if(e[a]=n,n===!0||n===!1)return e;if(n.__absolute_uri__===void 0&&Object.defineProperty(n,"__absolute_uri__",{enumerable:!1,value:a}),n.$ref&&n.__absolute_ref__===void 0){const i=new URL(n.$ref,t.href);i.hash=i.hash,Object.defineProperty(n,"__absolute_ref__",{enumerable:!1,value:i.href})}if(n.$recursiveRef&&n.__absolute_recursive_ref__===void 0){const i=new URL(n.$recursiveRef,t.href);i.hash=i.hash,Object.defineProperty(n,"__absolute_recursive_ref__",{enumerable:!1,value:i.href})}if(n.$anchor){const i=new URL("#"+n.$anchor,t.href);e[i.href]=n}for(let i in n){if(xf[i])continue;const s=`${r}/${Ue(i)}`,o=n[i];if(Array.isArray(o)){if(Of[i]){const u=o.length;for(let c=0;c<u;c++)Zt(o[c],e,t,`${s}/${c}`)}}else if(Sf[i])for(let u in o)Zt(o[u],e,t,`${s}/${Ue(u)}`);else Zt(o,e,t,s)}return e}const If=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Tf=[0,31,28,31,30,31,30,31,31,30,31,30,31],Rf=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,kf=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,Af=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,Pf=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,Nf=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,Cf=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,jf=/^(?:\/(?:[^~/]|~0|~1)*)*$/,Lf=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,Mf=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,Df=n=>{if(n[0]==='"')return!1;const[e,t,...r]=n.split("@");return!e||!t||r.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(a=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(a))},Uf=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,Ff=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,zf=n=>n.length>1&&n.length<80&&(/^P\d+([.,]\d+)?W$/.test(n)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(n)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(n));function He(n){return n.test.bind(n)}const to={date:Vo,time:Jo.bind(void 0,!1),"date-time":Zf,duration:zf,uri:Vf,"uri-reference":He(Af),"uri-template":He(Pf),url:He(Nf),email:Df,hostname:He(kf),ipv4:He(Uf),ipv6:He(Ff),regex:Wf,uuid:He(Cf),"json-pointer":He(jf),"json-pointer-uri-fragment":He(Lf),"relative-json-pointer":He(Mf)};function Bf(n){return n%4===0&&(n%100!==0||n%400===0)}function Vo(n){const e=n.match(If);if(!e)return!1;const t=+e[1],r=+e[2],a=+e[3];return r>=1&&r<=12&&a>=1&&a<=(r==2&&Bf(t)?29:Tf[r])}function Jo(n,e){const t=e.match(Rf);if(!t)return!1;const r=+t[1],a=+t[2],i=+t[3],s=!!t[5];return(r<=23&&a<=59&&i<=59||r==23&&a==59&&i==60)&&(!n||s)}const qf=/t|\s/i;function Zf(n){const e=n.split(qf);return e.length==2&&Vo(e[0])&&Jo(!0,e[1])}const Hf=/\/|:/,Gf=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function Vf(n){return Hf.test(n)&&Gf.test(n)}const Jf=/[^\\]\\Z/;function Wf(n){if(Jf.test(n))return!1;try{return new RegExp(n,"u"),!0}catch{return!1}}function Kf(n){let e=0,t=n.length,r=0,a;for(;r<t;)e++,a=n.charCodeAt(r++),a>=55296&&a<=56319&&r<t&&(a=n.charCodeAt(r),(a&64512)==56320&&r++);return e}function se(n,e,t="2019-09",r=Zt(e),a=!0,i=null,s="#",o="#",u=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:s,keyword:"false",keywordLocation:s,error:"False boolean schema."}]};const c=typeof n;let l;switch(c){case"boolean":case"number":case"string":l=c;break;case"object":n===null?l="null":Array.isArray(n)?l="array":l="object";break;default:throw new Error(`Instances of "${c}" type are not supported.`)}const{$ref:f,$recursiveRef:d,$recursiveAnchor:p,type:h,const:g,enum:y,required:m,not:b,anyOf:_,allOf:v,oneOf:w,if:x,then:L,else:k,format:le,properties:Re,patternProperties:ke,additionalProperties:We,unevaluatedProperties:Ke,minProperties:I,maxProperties:S,propertyNames:D,dependentRequired:P,dependentSchemas:U,dependencies:N,prefixItems:z,items:X,additionalItems:G,unevaluatedItems:re,contains:oe,minContains:Q,maxContains:xe,minItems:Ze,maxItems:wt,uniqueItems:Lt,minimum:je,maximum:Xe,exclusiveMinimum:Mt,exclusiveMaximum:Dt,multipleOf:hr,minLength:pr,maxLength:mr,pattern:ai,__absolute_ref__:gr,__absolute_recursive_ref__:tu}=e,R=[];if(p===!0&&i===null&&(i=e),d==="#"){const B=i===null?r[tu]:i,F=`${o}/$recursiveRef`,H=se(n,i===null?e:i,t,r,a,B,s,F,u);H.valid||R.push({instanceLocation:s,keyword:"$recursiveRef",keywordLocation:F,error:"A subschema had errors."},...H.errors)}if(f!==void 0){const F=r[gr||f];if(F===void 0){let $=`Unresolved $ref "${f}".`;throw gr&&gr!==f&&($+=`  Absolute URI "${gr}".`),$+=`
Known schemas:
- ${Object.keys(r).join(`
- `)}`,new Error($)}const H=`${o}/$ref`,A=se(n,F,t,r,a,i,s,H,u);if(A.valid||R.push({instanceLocation:s,keyword:"$ref",keywordLocation:H,error:"A subschema had errors."},...A.errors),t==="4"||t==="7")return{valid:R.length===0,errors:R}}if(Array.isArray(h)){let B=h.length,F=!1;for(let H=0;H<B;H++)if(l===h[H]||h[H]==="integer"&&l==="number"&&n%1===0&&n===n){F=!0;break}F||R.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${l}" is invalid. Expected "${h.join('", "')}".`})}else h==="integer"?(l!=="number"||n%1||n!==n)&&R.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${l}" is invalid. Expected "${h}".`}):h!==void 0&&l!==h&&R.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${l}" is invalid. Expected "${h}".`});if(g!==void 0&&(l==="object"||l==="array"?Kt(n,g)||R.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(g)}.`}):n!==g&&R.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(g)}.`})),y!==void 0&&(l==="object"||l==="array"?y.some(B=>Kt(n,B))||R.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(y)}.`}):y.some(B=>n===B)||R.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(y)}.`})),b!==void 0){const B=`${o}/not`;se(n,b,t,r,a,i,s,B).valid&&R.push({instanceLocation:s,keyword:"not",keywordLocation:B,error:'Instance matched "not" schema.'})}let yr=[];if(_!==void 0){const B=`${o}/anyOf`,F=R.length;let H=!1;for(let A=0;A<_.length;A++){const $=_[A],Z=Object.create(u),q=se(n,$,t,r,a,p===!0?i:null,s,`${B}/${A}`,Z);R.push(...q.errors),H=H||q.valid,q.valid&&yr.push(Z)}H?R.length=F:R.splice(F,0,{instanceLocation:s,keyword:"anyOf",keywordLocation:B,error:"Instance does not match any subschemas."})}if(v!==void 0){const B=`${o}/allOf`,F=R.length;let H=!0;for(let A=0;A<v.length;A++){const $=v[A],Z=Object.create(u),q=se(n,$,t,r,a,p===!0?i:null,s,`${B}/${A}`,Z);R.push(...q.errors),H=H&&q.valid,q.valid&&yr.push(Z)}H?R.length=F:R.splice(F,0,{instanceLocation:s,keyword:"allOf",keywordLocation:B,error:"Instance does not match every subschema."})}if(w!==void 0){const B=`${o}/oneOf`,F=R.length,H=w.filter((A,$)=>{const Z=Object.create(u),q=se(n,A,t,r,a,p===!0?i:null,s,`${B}/${$}`,Z);return R.push(...q.errors),q.valid&&yr.push(Z),q.valid}).length;H===1?R.length=F:R.splice(F,0,{instanceLocation:s,keyword:"oneOf",keywordLocation:B,error:`Instance does not match exactly one subschema (${H} matches).`})}if((l==="object"||l==="array")&&Object.assign(u,...yr),x!==void 0){const B=`${o}/if`;if(se(n,x,t,r,a,i,s,B,u).valid){if(L!==void 0){const H=se(n,L,t,r,a,i,s,`${o}/then`,u);H.valid||R.push({instanceLocation:s,keyword:"if",keywordLocation:B,error:'Instance does not match "then" schema.'},...H.errors)}}else if(k!==void 0){const H=se(n,k,t,r,a,i,s,`${o}/else`,u);H.valid||R.push({instanceLocation:s,keyword:"if",keywordLocation:B,error:'Instance does not match "else" schema.'},...H.errors)}}if(l==="object"){if(m!==void 0)for(const A of m)A in n||R.push({instanceLocation:s,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${A}".`});const B=Object.keys(n);if(I!==void 0&&B.length<I&&R.push({instanceLocation:s,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${I} properties.`}),S!==void 0&&B.length>S&&R.push({instanceLocation:s,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${S} properties.`}),D!==void 0){const A=`${o}/propertyNames`;for(const $ in n){const Z=`${s}/${Ue($)}`,q=se($,D,t,r,a,i,Z,A);q.valid||R.push({instanceLocation:s,keyword:"propertyNames",keywordLocation:A,error:`Property name "${$}" does not match schema.`},...q.errors)}}if(P!==void 0){const A=`${o}/dependantRequired`;for(const $ in P)if($ in n){const Z=P[$];for(const q of Z)q in n||R.push({instanceLocation:s,keyword:"dependentRequired",keywordLocation:A,error:`Instance has "${$}" but does not have "${q}".`})}}if(U!==void 0)for(const A in U){const $=`${o}/dependentSchemas`;if(A in n){const Z=se(n,U[A],t,r,a,i,s,`${$}/${Ue(A)}`,u);Z.valid||R.push({instanceLocation:s,keyword:"dependentSchemas",keywordLocation:$,error:`Instance has "${A}" but does not match dependant schema.`},...Z.errors)}}if(N!==void 0){const A=`${o}/dependencies`;for(const $ in N)if($ in n){const Z=N[$];if(Array.isArray(Z))for(const q of Z)q in n||R.push({instanceLocation:s,keyword:"dependencies",keywordLocation:A,error:`Instance has "${$}" but does not have "${q}".`});else{const q=se(n,Z,t,r,a,i,s,`${A}/${Ue($)}`);q.valid||R.push({instanceLocation:s,keyword:"dependencies",keywordLocation:A,error:`Instance has "${$}" but does not match dependant schema.`},...q.errors)}}}const F=Object.create(null);let H=!1;if(Re!==void 0){const A=`${o}/properties`;for(const $ in Re){if(!($ in n))continue;const Z=`${s}/${Ue($)}`,q=se(n[$],Re[$],t,r,a,i,Z,`${A}/${Ue($)}`);if(q.valid)u[$]=F[$]=!0;else if(H=a,R.push({instanceLocation:s,keyword:"properties",keywordLocation:A,error:`Property "${$}" does not match schema.`},...q.errors),H)break}}if(!H&&ke!==void 0){const A=`${o}/patternProperties`;for(const $ in ke){const Z=new RegExp($,"u"),q=ke[$];for(const Ee in n){if(!Z.test(Ee))continue;const ii=`${s}/${Ue(Ee)}`,si=se(n[Ee],q,t,r,a,i,ii,`${A}/${Ue($)}`);si.valid?u[Ee]=F[Ee]=!0:(H=a,R.push({instanceLocation:s,keyword:"patternProperties",keywordLocation:A,error:`Property "${Ee}" matches pattern "${$}" but does not match associated schema.`},...si.errors))}}}if(!H&&We!==void 0){const A=`${o}/additionalProperties`;for(const $ in n){if(F[$])continue;const Z=`${s}/${Ue($)}`,q=se(n[$],We,t,r,a,i,Z,A);q.valid?u[$]=!0:(H=a,R.push({instanceLocation:s,keyword:"additionalProperties",keywordLocation:A,error:`Property "${$}" does not match additional properties schema.`},...q.errors))}}else if(!H&&Ke!==void 0){const A=`${o}/unevaluatedProperties`;for(const $ in n)if(!u[$]){const Z=`${s}/${Ue($)}`,q=se(n[$],Ke,t,r,a,i,Z,A);q.valid?u[$]=!0:R.push({instanceLocation:s,keyword:"unevaluatedProperties",keywordLocation:A,error:`Property "${$}" does not match unevaluated properties schema.`},...q.errors)}}}else if(l==="array"){wt!==void 0&&n.length>wt&&R.push({instanceLocation:s,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${n.length} > ${wt}).`}),Ze!==void 0&&n.length<Ze&&R.push({instanceLocation:s,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${n.length} < ${Ze}).`});const B=n.length;let F=0,H=!1;if(z!==void 0){const A=`${o}/prefixItems`,$=Math.min(z.length,B);for(;F<$;F++){const Z=se(n[F],z[F],t,r,a,i,`${s}/${F}`,`${A}/${F}`);if(u[F]=!0,!Z.valid&&(H=a,R.push({instanceLocation:s,keyword:"prefixItems",keywordLocation:A,error:"Items did not match schema."},...Z.errors),H))break}}if(X!==void 0){const A=`${o}/items`;if(Array.isArray(X)){const $=Math.min(X.length,B);for(;F<$;F++){const Z=se(n[F],X[F],t,r,a,i,`${s}/${F}`,`${A}/${F}`);if(u[F]=!0,!Z.valid&&(H=a,R.push({instanceLocation:s,keyword:"items",keywordLocation:A,error:"Items did not match schema."},...Z.errors),H))break}}else for(;F<B;F++){const $=se(n[F],X,t,r,a,i,`${s}/${F}`,A);if(u[F]=!0,!$.valid&&(H=a,R.push({instanceLocation:s,keyword:"items",keywordLocation:A,error:"Items did not match schema."},...$.errors),H))break}if(!H&&G!==void 0){const $=`${o}/additionalItems`;for(;F<B;F++){const Z=se(n[F],G,t,r,a,i,`${s}/${F}`,$);u[F]=!0,Z.valid||(H=a,R.push({instanceLocation:s,keyword:"additionalItems",keywordLocation:$,error:"Items did not match additional items schema."},...Z.errors))}}}if(oe!==void 0)if(B===0&&Q===void 0)R.push({instanceLocation:s,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(Q!==void 0&&B<Q)R.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${B}) than minContains (${Q}).`});else{const A=`${o}/contains`,$=R.length;let Z=0;for(let q=0;q<B;q++){const Ee=se(n[q],oe,t,r,a,i,`${s}/${q}`,A);Ee.valid?(u[q]=!0,Z++):R.push(...Ee.errors)}Z>=(Q||0)&&(R.length=$),Q===void 0&&xe===void 0&&Z===0?R.splice($,0,{instanceLocation:s,keyword:"contains",keywordLocation:A,error:"Array does not contain item matching schema."}):Q!==void 0&&Z<Q?R.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${Q} items matching schema. Only ${Z} items were found.`}):xe!==void 0&&Z>xe&&R.push({instanceLocation:s,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${xe} items matching schema. ${Z} items were found.`})}if(!H&&re!==void 0){const A=`${o}/unevaluatedItems`;for(F;F<B;F++){if(u[F])continue;const $=se(n[F],re,t,r,a,i,`${s}/${F}`,A);u[F]=!0,$.valid||R.push({instanceLocation:s,keyword:"unevaluatedItems",keywordLocation:A,error:"Items did not match unevaluated items schema."},...$.errors)}}if(Lt)for(let A=0;A<B;A++){const $=n[A],Z=typeof $=="object"&&$!==null;for(let q=0;q<B;q++){if(A===q)continue;const Ee=n[q];($===Ee||Z&&(typeof Ee=="object"&&Ee!==null)&&Kt($,Ee))&&(R.push({instanceLocation:s,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${A} and ${q}.`}),A=Number.MAX_SAFE_INTEGER,q=Number.MAX_SAFE_INTEGER)}}}else if(l==="number"){if(t==="4"?(je!==void 0&&(Mt===!0&&n<=je||n<je)&&R.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${n} is less than ${Mt?"or equal to ":""} ${je}.`}),Xe!==void 0&&(Dt===!0&&n>=Xe||n>Xe)&&R.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${n} is greater than ${Dt?"or equal to ":""} ${Xe}.`})):(je!==void 0&&n<je&&R.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${n} is less than ${je}.`}),Xe!==void 0&&n>Xe&&R.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${n} is greater than ${Xe}.`}),Mt!==void 0&&n<=Mt&&R.push({instanceLocation:s,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${n} is less than ${Mt}.`}),Dt!==void 0&&n>=Dt&&R.push({instanceLocation:s,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${n} is greater than or equal to ${Dt}.`})),hr!==void 0){const B=n%hr;Math.abs(0-B)>=11920929e-14&&Math.abs(hr-B)>=11920929e-14&&R.push({instanceLocation:s,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${n} is not a multiple of ${hr}.`})}}else if(l==="string"){const B=pr===void 0&&mr===void 0?0:Kf(n);pr!==void 0&&B<pr&&R.push({instanceLocation:s,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${B} < ${pr}).`}),mr!==void 0&&B>mr&&R.push({instanceLocation:s,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${B} > ${mr}).`}),ai!==void 0&&!new RegExp(ai,"u").test(n)&&R.push({instanceLocation:s,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),le!==void 0&&to[le]&&!to[le](n)&&R.push({instanceLocation:s,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${le}".`})}return{valid:R.length===0,errors:R}}function Je(n){if(typeof n!="object"||n===null)return!1;const e=n;if(!("_zod"in e))return!1;const t=e._zod;return typeof t=="object"&&t!==null&&"def"in t}function nt(n){if(typeof n!="object"||n===null)return!1;const e=n;if(!("_def"in e)||"_zod"in e)return!1;const t=e._def;return typeof t=="object"&&t!=null&&"typeName"in t}function Wo(n){return!n||typeof n!="object"||Array.isArray(n)?!1:!!(Je(n)||nt(n))}async function np(n,e){if(Je(n))try{return{success:!0,data:await Sd(n,e)}}catch(t){return{success:!1,error:t}}if(nt(n))return n.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function Ko(n,e){if(Je(n))return Ed(n,e);if(nt(n))return n.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Xf(n){var e;if(Je(n))return(e=St.get(n))==null?void 0:e.description;if(nt(n)||"description"in n&&typeof n.description=="string")return n.description}function Yf(n){return Wo(n)?nt(n)?n._def.typeName==="ZodString":Je(n)?n._zod.def.type==="string":!1:!1}function kr(n){return Je(n)?typeof n=="object"&&n!==null&&"_zod"in n&&typeof n._zod=="object"&&n._zod!==null&&"def"in n._zod&&typeof n._zod.def=="object"&&n._zod.def!==null&&"type"in n._zod.def&&n._zod.def.type==="object":!1}function Qf(n){return Je(n)?typeof n=="object"&&n!==null&&"_zod"in n&&typeof n._zod=="object"&&n._zod!==null&&"def"in n._zod&&typeof n._zod.def=="object"&&n._zod.def!==null&&"type"in n._zod.def&&n._zod.def.type==="array":!1}function Na(n,e=!1){if(nt(n))return n.strict();if(kr(n)){const t=n._zod.def.shape;if(e)for(const[i,s]of Object.entries(n._zod.def.shape)){if(kr(s)){const u=Na(s,e);t[i]=u}else if(Qf(s)){let u=s._zod.def.element;kr(u)&&(u=Na(u,e)),t[i]=Ks(s,{...s._zod.def,element:u})}else t[i]=s;const o=St.get(s);o&&St.add(t[i],o)}const r=Ks(n,{...n._zod.def,shape:t,catchall:Nd(Ad)}),a=St.get(n);return a&&St.add(r,a),r}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function eh(n){return nt(n)&&"typeName"in n._def&&n._def.typeName==="ZodEffects"}function th(n){return Je(n)&&n._zod.def.type==="pipe"}function Ca(n){if(nt(n))return eh(n)?Ca(n._def.schema):n;if(Je(n))return th(n)?Ca(n._zod.def.in)??n:n;throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function rh(n){if(Je(n)){const e=Ca(n);if(kr(e)){const t=Na(e,!0);return Ys(t)}else return Ys(n)}return nt(n)?vf(n):n}function nh(n,e){if(n!==void 0&&!$t(n))return n;if(ti(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function ah(n){return ti(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...rh(n.data.schema),title:n.data.name}}}class tn{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=$t(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...ah(t)})),edges:this.edges.map(t=>{const r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t,r){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const a=t??be(),i={id:a,data:e,name:nh(t,e),metadata:r};return this.nodes[a]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,a){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const i={source:e.id,target:t.id,data:r,conditional:a};return this.edges.push(i),i}firstNode(){return ro(this)}lastNode(){return no(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map(c=>c.id).every($t)&&(r="");const i=c=>r?`${r}:${c}`:c;Object.entries(e.nodes).forEach(([c,l])=>{this.nodes[i(c)]={...l,id:i(c)}});const s=e.edges.map(c=>({...c,source:i(c.source),target:i(c.target)}));this.edges=[...this.edges,...s];const o=e.firstNode(),u=e.lastNode();return[o?{id:i(o.id),data:o.data}:void 0,u?{id:i(u.id),data:u.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&ro(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&no(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(a=>[a.id,a.name])),t=new Map;Object.values(e).forEach(a=>{t.set(a,(t.get(a)||0)+1)});const r=a=>{const i=e[a];return $t(a)&&t.get(i)===1?i:a};return new tn({nodes:Object.fromEntries(Object.entries(this.nodes).map(([a,i])=>[r(a),{...i,id:r(a)}])),edges:this.edges.map(a=>({...a,source:r(a.source),target:r(a.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:r,nodeColors:a={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:i}=e??{},s=this.reid(),o=s.firstNode(),u=s.lastNode();return fd(s.nodes,s.edges,{firstNode:o==null?void 0:o.id,lastNode:u==null?void 0:u.id,withStyles:t,curveStyle:r,nodeColors:a,wrapLabelNWords:i})}async drawMermaidPng(e){const t=this.drawMermaid(e);return hd(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function ro(n,e=[]){const t=new Set(n.edges.filter(a=>!e.includes(a.source)).map(a=>a.target)),r=[];for(const a of Object.values(n.nodes))!e.includes(a.id)&&!t.has(a.id)&&r.push(a);return r.length===1?r[0]:void 0}function no(n,e=[]){const t=new Set(n.edges.filter(a=>!e.includes(a.target)).map(a=>a.source)),r=[];for(const a of Object.values(n.nodes))!e.includes(a.id)&&!t.has(a.id)&&r.push(a);return r.length===1?r[0]:void 0}function ih(n){const e=new TextEncoder,t=new ReadableStream({async start(r){for await(const a of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(a)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return Te.fromReadableStream(t)}function ao(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}const sh=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function";function ja(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*io(n,e){for(;;){const{value:t,done:r}=ht.runWithConfig(Pt(n),e.next.bind(e),!0);if(r)break;yield t}}async function*La(n,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:r,done:a}=await ht.runWithConfig(Pt(n),t.next.bind(e),!0);if(a)break;yield r}}function pe(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}class we extends _t{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new yt({bound:this,kwargs:e,config:{}})}map(){return new Zr({bound:this})}withRetry(e){return new Xo({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new yt({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new uh({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(ae);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([a])=>a!=="runId"));return Array.from({length:t},(a,i)=>ae(i===0?e:r))}return Array.from({length:t},()=>ae(e))}async batch(e,t,r){var u;const a=this._getOptionsList(t??{},e.length),i=((u=a[0])==null?void 0:u.maxConcurrency)??(r==null?void 0:r.maxConcurrency),s=new ei({maxConcurrency:i,onFailedAttempt:c=>{throw c}}),o=e.map((c,l)=>s.call(async()=>{try{return await this.invoke(c,a[l])}catch(f){if(r!=null&&r.returnExceptions)return f;throw f}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=ae(t),a=new jt({generator:this._streamIterator(e,r),config:r});return await a.setup,Te.fromAsyncGenerator(a)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=ae(e):t=ae({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){const a=ae(r),i=await Fe(a),s=await(i==null?void 0:i.handleChainStart(this.toJSON(),pe(t,"input"),a.runId,a==null?void 0:a.runType,void 0,void 0,(a==null?void 0:a.runName)??this.getName()));delete a.runId;let o;try{const u=e.call(this,t,a,s);o=await pt(u,r==null?void 0:r.signal)}catch(u){throw await(s==null?void 0:s.handleChainError(u)),u}return await(s==null?void 0:s.handleChainEnd(pe(o,"output"))),o}async _batchWithConfig(e,t,r,a){var c;const i=this._getOptionsList(r??{},t.length),s=await Promise.all(i.map(Fe)),o=await Promise.all(s.map(async(l,f)=>{const d=await(l==null?void 0:l.handleChainStart(this.toJSON(),pe(t[f],"input"),i[f].runId,i[f].runType,void 0,void 0,i[f].runName??this.getName()));return delete i[f].runId,d}));let u;try{const l=e.call(this,t,i,o,a);u=await pt(l,(c=i==null?void 0:i[0])==null?void 0:c.signal)}catch(l){throw await Promise.all(o.map(f=>f==null?void 0:f.handleChainError(l))),l}return await Promise.all(o.map(l=>l==null?void 0:l.handleChainEnd(pe(u,"output")))),u}async*_transformStreamWithConfig(e,t,r){let a,i=!0,s,o=!0;const u=ae(r),c=await Fe(u);async function*l(){for await(const d of e){if(i)if(a===void 0)a=d;else try{a=tt(a,d)}catch{a=void 0,i=!1}yield d}}let f;try{const d=await rd(t.bind(this),l(),async()=>c==null?void 0:c.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),r==null?void 0:r.signal,u);delete u.runId,f=d.setup;const p=f==null?void 0:f.handlers.find(id);let h=d.output;p!==void 0&&f!==void 0&&(h=p.tapOutputIterable(f.runId,h));const g=f==null?void 0:f.handlers.find(nd);g!==void 0&&f!==void 0&&(h=g.tapOutputIterable(f.runId,h));for await(const y of h)if(yield y,o)if(s===void 0)s=y;else try{s=tt(s,y)}catch{s=void 0,o=!1}}catch(d){throw await(f==null?void 0:f.handleChainError(d,void 0,void 0,void 0,{inputs:pe(a,"input")})),d}await(f==null?void 0:f.handleChainEnd(s??{},void 0,void 0,void 0,{inputs:pe(a,"input")}))}getGraph(e){const t=new tn,r=t.addNode({name:`${this.getName()}Input`,schema:Ii()}),a=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:Ii()});return t.addEdge(r,a),t.addEdge(a,i),t}pipe(e){return new mt({first:this,last:gt(e)})}pick(e){return this.pipe(new lh(e))}assign(e){return this.pipe(new ch(new fr({steps:e})))}async*transform(e,t){let r;for await(const a of e)r===void 0?r=a:r=tt(r,a);yield*this._streamIterator(r,ae(t))}async*streamLog(e,t,r){const a=new Ws({...r,autoClose:!1,_schemaFormat:"original"}),i=ae(t);yield*this._streamLog(e,a,i)}async*_streamLog(e,t,r){const{callbacks:a}=r;if(a===void 0)r.callbacks=[t];else if(Array.isArray(a))r.callbacks=a.concat([t]);else{const u=a.copy();u.addHandler(t,!0),r.callbacks=u}const i=this.stream(e,r);async function s(){try{const u=await i;for await(const c of u){const l=new ut({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await t.writer.write(l)}}finally{await t.writer.close()}}const o=s();try{for await(const u of t)yield u}finally{await o}}streamEvents(e,t,r){let a;if(t.version==="v1")a=this._streamEventsV1(e,t,r);else if(t.version==="v2")a=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?ih(a):Te.fromAsyncGenerator(a)}async*_streamEventsV2(e,t,r){var h;const a=new sd({...r,autoClose:!1}),i=ae(t),s=i.runId??be();i.runId=s;const o=i.callbacks;if(o===void 0)i.callbacks=[a];else if(Array.isArray(o))i.callbacks=o.concat(a);else{const g=o.copy();g.addHandler(a,!0),i.callbacks=g}const u=new AbortController,c=this;async function l(){try{let g;t!=null&&t.signal?"any"in AbortSignal?g=AbortSignal.any([u.signal,t.signal]):(g=t.signal,t.signal.addEventListener("abort",()=>{u.abort()},{once:!0})):g=u.signal;const y=await c.stream(e,{...i,signal:g}),m=a.tapOutputIterable(s,y);for await(const b of m)if(u.signal.aborted)break}finally{await a.finish()}}const f=l();let d=!1,p;try{for await(const g of a){if(!d){g.data.input=e,d=!0,p=g.run_id,yield g;continue}g.run_id===p&&g.event.endsWith("_end")&&(h=g.data)!=null&&h.input&&delete g.data.input,yield g}}finally{u.abort(),await f}}async*_streamEventsV1(e,t,r){let a,i=!1;const s=ae(t),o=s.tags??[],u=s.metadata??{},c=s.runName??this.getName(),l=new Ws({...r,autoClose:!1,_schemaFormat:"streaming_events"}),f=new cd({...r}),d=this._streamLog(e,l,s);for await(const h of d){if(a?a=a.concat(h):a=nr.fromRunLogPatch(h),a.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!i){i=!0;const b={...a.state},_={run_id:b.id,event:`on_${b.type}_start`,name:c,tags:o,metadata:u,data:{input:e}};f.includeEvent(_,b.type)&&(yield _)}const g=h.ops.filter(b=>b.path.startsWith("/logs/")).map(b=>b.path.split("/")[2]),y=[...new Set(g)];for(const b of y){let _,v={};const w=a.state.logs[b];if(w.end_time===void 0?w.streamed_output.length>0?_="stream":_="start":_="end",_==="start")w.inputs!==void 0&&(v.input=w.inputs);else if(_==="end")w.inputs!==void 0&&(v.input=w.inputs),v.output=w.final_output;else if(_==="stream"){const x=w.streamed_output.length;if(x!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${x} instead. Encountered in: "${w.name}"`);v={chunk:w.streamed_output[0]},w.streamed_output=[]}yield{event:`on_${w.type}_${_}`,name:w.name,run_id:w.id,tags:w.tags,metadata:w.metadata,data:v}}const{state:m}=a;if(m.streamed_output.length>0){const b=m.streamed_output.length;if(b!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${b} instead. Encountered in: "${m.name}"`);const _={chunk:m.streamed_output[0]};m.streamed_output=[];const v={event:`on_${m.type}_stream`,run_id:m.id,tags:o,metadata:u,name:c,data:_};f.includeEvent(v,m.type)&&(yield v)}}const p=a==null?void 0:a.state;if(p!==void 0){const h={event:`on_${p.type}_end`,name:c,run_id:p.id,tags:o,metadata:u,data:{output:p.final_output}};f.includeEvent(h,p.type)&&(yield h)}}static isRunnable(e){return ti(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new yt({bound:this,config:{},configFactories:[a=>({callbacks:[new Do({config:a,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return dh(this,e)}}class yt extends we{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=Gs(this.config,...e);return Gs(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new Xo({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(ae(t),this.kwargs))}async batch(e,t,r){const a=Array.isArray(t)?await Promise.all(t.map(async i=>this._mergeConfig(ae(i),this.kwargs))):await this._mergeConfig(ae(t),this.kwargs);return this.bound.batch(e,a,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(ae(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(ae(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(ae(t),this.kwargs))}streamEvents(e,t,r){const a=this,i=async function*(){yield*a.bound.streamEvents(e,{...await a._mergeConfig(ae(t),a.kwargs),version:t.version},r)};return Te.fromAsyncGenerator(i())}static isRunnableBinding(e){return e.bound&&we.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new yt({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new Do({config:a,onStart:e,onEnd:t,onError:r})]})]})}}class Zr extends we{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Zr({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,ge(t,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new Zr({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class Xo extends yt{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const a=e>1?`retry:attempt:${e}`:void 0;return ge(t,{callbacks:r==null?void 0:r.getChild(a)})}async _invoke(e,t,r){return Lr(a=>super.invoke(e,this._patchConfigForRetry(a,t,r)),{onFailedAttempt:a=>this.onFailedAttempt(a,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,a){const i={};try{await Lr(async s=>{const o=e.map((d,p)=>p).filter(d=>i[d.toString()]===void 0||i[d.toString()]instanceof Error),u=o.map(d=>e[d]),c=o.map(d=>this._patchConfigForRetry(s,t==null?void 0:t[d],r==null?void 0:r[d])),l=await super.batch(u,c,{...a,returnExceptions:!0});let f;for(let d=0;d<l.length;d+=1){const p=l[d],h=o[d];p instanceof Error&&f===void 0&&(f=p,f.input=u[d]),i[h.toString()]=p}if(f)throw f;return l},{onFailedAttempt:s=>this.onFailedAttempt(s,s.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(s){if((a==null?void 0:a.returnExceptions)!==!0)throw s}return Object.keys(i).sort((s,o)=>parseInt(s,10)-parseInt(o,10)).map(s=>i[parseInt(s,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class mt extends we{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var u;const r=ae(t),a=await Fe(r),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),pe(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let s=e,o;try{const c=[this.first,...this.middle];for(let l=0;l<c.length;l+=1){const d=c[l].invoke(s,ge(r,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${l+1}`)}));s=await pt(d,t==null?void 0:t.signal)}if((u=t==null?void 0:t.signal)!=null&&u.aborted)throw new Error("Aborted");o=await this.last.invoke(s,ge(r,{callbacks:i==null?void 0:i.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(c){throw await(i==null?void 0:i.handleChainError(c)),c}return await(i==null?void 0:i.handleChainEnd(pe(o,"output"))),o}async batch(e,t,r){var u;const a=this._getOptionsList(t??{},e.length),i=await Promise.all(a.map(Fe)),s=await Promise.all(i.map(async(c,l)=>{const f=await(c==null?void 0:c.handleChainStart(this.toJSON(),pe(e[l],"input"),a[l].runId,void 0,void 0,void 0,a[l].runName));return delete a[l].runId,f}));let o=e;try{for(let c=0;c<this.steps.length;c+=1){const f=this.steps[c].batch(o,s.map((d,p)=>{const h=d==null?void 0:d.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`);return ge(a[p],{callbacks:h})}),r);o=await pt(f,(u=a[0])==null?void 0:u.signal)}}catch(c){throw await Promise.all(s.map(l=>l==null?void 0:l.handleChainError(c))),c}return await Promise.all(s.map(c=>c==null?void 0:c.handleChainEnd(pe(o,"output")))),o}async*_streamIterator(e,t){var f;const r=await Fe(t),{runId:a,...i}=t??{},s=await(r==null?void 0:r.handleChainStart(this.toJSON(),pe(e,"input"),a,void 0,void 0,void 0,i==null?void 0:i.runName)),o=[this.first,...this.middle,this.last];let u=!0,c;async function*l(){yield e}try{let d=o[0].transform(l(),ge(i,{callbacks:s==null?void 0:s.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let p=1;p<o.length;p+=1)d=await o[p].transform(d,ge(i,{callbacks:s==null?void 0:s.getChild(this.omitSequenceTags?void 0:`seq:step:${p+1}`)}));for await(const p of d)if((f=t==null?void 0:t.signal)==null||f.throwIfAborted(),yield p,u)if(c===void 0)c=p;else try{c=tt(c,p)}catch{c=void 0,u=!1}}catch(d){throw await(s==null?void 0:s.handleChainError(d)),d}await(s==null?void 0:s.handleChainEnd(pe(c,"output")))}getGraph(e){const t=new tn;let r=null;return this.steps.forEach((a,i)=>{const s=a.getGraph(e);i!==0&&s.trimFirstNode(),i!==this.steps.length-1&&s.trimLastNode(),t.extend(s);const o=s.firstNode();if(!o)throw new Error(`Runnable ${a} has no first node`);r&&t.addEdge(r,o),r=s.lastNode()}),t}pipe(e){return mt.isRunnableSequence(e)?new mt({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new mt({first:this.first,middle:[...this.middle,this.last],last:gt(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&we.isRunnable(e)}static from([e,...t],r){let a={};return typeof r=="string"?a.name=r:r!==void 0&&(a=r),new mt({...a,first:gt(e),middle:t.slice(0,-1).map(gt),last:gt(t[t.length-1])})}}class fr extends we{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=gt(r)}static from(e){return new fr({steps:e})}async invoke(e,t){const r=ae(t),a=await Fe(r),i=await(a==null?void 0:a.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const s={};try{const o=Object.entries(this.steps).map(async([u,c])=>{s[u]=await c.invoke(e,ge(r,{callbacks:i==null?void 0:i.getChild(`map:key:${u}`)}))});await pt(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(i==null?void 0:i.handleChainError(o)),o}return await(i==null?void 0:i.handleChainEnd(s)),s}async*_transform(e,t,r){const a={...this.steps},i=Lo(e,Object.keys(a).length),s=new Map(Object.entries(a).map(([o,u],c)=>{const l=u.transform(i[c],ge(r,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,l.next().then(f=>({key:o,gen:l,result:f}))]}));for(;s.size;){const o=Promise.race(s.values()),{key:u,result:c,gen:l}=await pt(o,r==null?void 0:r.signal);s.delete(u),c.done||(yield{[u]:c.value},s.set(u,l.next().then(f=>({key:u,gen:l,result:f}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const a=ae(t),i=new jt({generator:this.transform(r(),a),config:a});return await i.setup,Te.fromAsyncGenerator(i)}}class ri extends we{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Qa(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[r]=this._getOptionsList(t??{},1),a=await Fe(r),i=this.func(ge(r,{callbacks:a}),e);return pt(i,r==null?void 0:r.signal)}async*_streamIterator(e,t){var i,s;const[r]=this._getOptionsList(t??{},1),a=await this.invoke(e,t);if(ja(a)){for await(const o of a)(i=r==null?void 0:r.signal)==null||i.throwIfAborted(),yield o;return}if(sh(a)){for(;;){(s=r==null?void 0:r.signal)==null||s.throwIfAborted();const o=a.next();if(o.done)break;yield o.value}return}yield a}static from(e){return new ri({func:e})}}function oh(n){if(Qa(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class rn extends we{static lc_name(){return"RunnableLambda"}constructor(e){if(Qa(e.func))return ri.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),oh(e.func),this.func=e.func}static from(e){return new rn({func:e})}async _invoke(e,t,r){return new Promise((a,i)=>{const s=ge(t,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??pa)-1});ht.runWithConfig(Pt(s),async()=>{var o,u;try{let c=await this.func(e,{...s});if(c&&we.isRunnable(c)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");c=await c.invoke(e,{...s,recursionLimit:(s.recursionLimit??pa)-1})}else if(ja(c)){let l;for await(const f of La(s,c))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),l===void 0)l=f;else try{l=tt(l,f)}catch{l=f}c=l}else if(ao(c)){let l;for(const f of io(s,c))if((u=t==null?void 0:t.signal)==null||u.throwIfAborted(),l===void 0)l=f;else try{l=tt(l,f)}catch{l=f}c=l}a(c)}catch(c){i(c)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,r){var o,u;let a;for await(const c of e)if(a===void 0)a=c;else try{a=tt(a,c)}catch{a=c}const i=ge(r,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??pa)-1}),s=await new Promise((c,l)=>{ht.runWithConfig(Pt(i),async()=>{try{const f=await this.func(a,{...i,config:i});c(f)}catch(f){l(f)}})});if(s&&we.isRunnable(s)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const c=await s.stream(a,i);for await(const l of c)yield l}else if(ja(s))for await(const c of La(i,s))(o=r==null?void 0:r.signal)==null||o.throwIfAborted(),yield c;else if(ao(s))for(const c of io(i,s))(u=r==null?void 0:r.signal)==null||u.throwIfAborted(),yield c;else yield s}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const a=ae(t),i=new jt({generator:this.transform(r(),a),config:a});return await i.setup,Te.fromAsyncGenerator(i)}}class uh extends we{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=ae(t),a=await Fe(r),{runId:i,...s}=r,o=await(a==null?void 0:a.handleChainStart(this.toJSON(),pe(e,"input"),i,void 0,void 0,void 0,s==null?void 0:s.runName)),u=ge(s,{callbacks:o==null?void 0:o.getChild()});return await ht.runWithConfig(u,async()=>{var f;let l;for(const d of this.runnables()){(f=r==null?void 0:r.signal)==null||f.throwIfAborted();try{const p=await d.invoke(e,u);return await(o==null?void 0:o.handleChainEnd(pe(p,"output"))),p}catch(p){l===void 0&&(l=p)}}throw l===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(l)),l)})}async*_streamIterator(e,t){var f;const r=ae(t),a=await Fe(r),{runId:i,...s}=r,o=await(a==null?void 0:a.handleChainStart(this.toJSON(),pe(e,"input"),i,void 0,void 0,void 0,s==null?void 0:s.runName));let u,c;for(const d of this.runnables()){(f=r==null?void 0:r.signal)==null||f.throwIfAborted();const p=ge(s,{callbacks:o==null?void 0:o.getChild()});try{const h=await d.stream(e,p);c=La(p,h);break}catch(h){u===void 0&&(u=h)}}if(c===void 0){const d=u??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(d)),d}let l;try{for await(const d of c){yield d;try{l=l===void 0?l:tt(l,d)}catch{l=void 0}}}catch(d){throw await(o==null?void 0:o.handleChainError(d)),d}await(o==null?void 0:o.handleChainEnd(pe(l,"output")))}async batch(e,t,r){var u;if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const a=this._getOptionsList(t??{},e.length),i=await Promise.all(a.map(c=>Fe(c))),s=await Promise.all(i.map(async(c,l)=>{const f=await(c==null?void 0:c.handleChainStart(this.toJSON(),pe(e[l],"input"),a[l].runId,void 0,void 0,void 0,a[l].runName));return delete a[l].runId,f}));let o;for(const c of this.runnables()){(u=a[0].signal)==null||u.throwIfAborted();try{const l=await c.batch(e,s.map((f,d)=>ge(a[d],{callbacks:f==null?void 0:f.getChild()})),r);return await Promise.all(s.map((f,d)=>f==null?void 0:f.handleChainEnd(pe(l[d],"output")))),l}catch(l){o===void 0&&(o=l)}}throw o?(await Promise.all(s.map(c=>c==null?void 0:c.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function gt(n){if(typeof n=="function")return new rn({func:n});if(we.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=gt(r);return new fr({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class ch extends we{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof fr&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const a=this.mapper.getStepsKeys(),[i,s]=Lo(e),o=this.mapper.transform(s,ge(r,{callbacks:t==null?void 0:t.getChild()})),u=o.next();for await(const c of i){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);const l=Object.fromEntries(Object.entries(c).filter(([f])=>!a.includes(f)));Object.keys(l).length>0&&(yield l)}yield(await u).value;for await(const c of o)yield c}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const a=ae(t),i=new jt({generator:this.transform(r(),a),config:a});return await i.setup,Te.fromAsyncGenerator(i)}}class lh extends we{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const a=ae(t),i=new jt({generator:this.transform(r(),a),config:a});return await i.setup,Te.fromAsyncGenerator(i)}}class so extends yt{constructor(e){const t=mt.from([rn.from(async r=>{let a;if(Ht(r))try{a=await Ko(this.schema,r.args)}catch{throw new wa("Received tool input did not match expected schema",JSON.stringify(r.args))}else a=r;return a}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function dh(n,e){const t=e.name??n.getName(),r=e.description??Xf(e.schema);return Yf(e.schema)?new so({name:t,description:r,schema:_o({input:yo()}).transform(a=>a.input),bound:n}):new so({name:t,description:r,schema:e.schema,bound:n})}/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var fh=typeof window=="object"?window:{},K="0123456789abcdef".split(""),hh=[-2147483648,8388608,32768,128],De=[24,16,8,0],he=[];function ze(n){n?(he[0]=he[16]=he[1]=he[2]=he[3]=he[4]=he[5]=he[6]=he[7]=he[8]=he[9]=he[10]=he[11]=he[12]=he[13]=he[14]=he[15]=0,this.blocks=he):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}ze.prototype.update=function(n){if(!this.finalized){var e=typeof n!="string";e&&n.constructor===fh.ArrayBuffer&&(n=new Uint8Array(n));for(var t,r=0,a,i=n.length||0,s=this.blocks;r<i;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),e)for(a=this.start;r<i&&a<64;++r)s[a>>2]|=n[r]<<De[a++&3];else for(a=this.start;r<i&&a<64;++r)t=n.charCodeAt(r),t<128?s[a>>2]|=t<<De[a++&3]:t<2048?(s[a>>2]|=(192|t>>6)<<De[a++&3],s[a>>2]|=(128|t&63)<<De[a++&3]):t<55296||t>=57344?(s[a>>2]|=(224|t>>12)<<De[a++&3],s[a>>2]|=(128|t>>6&63)<<De[a++&3],s[a>>2]|=(128|t&63)<<De[a++&3]):(t=65536+((t&1023)<<10|n.charCodeAt(++r)&1023),s[a>>2]|=(240|t>>18)<<De[a++&3],s[a>>2]|=(128|t>>12&63)<<De[a++&3],s[a>>2]|=(128|t>>6&63)<<De[a++&3],s[a>>2]|=(128|t&63)<<De[a++&3]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=s[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};ze.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>2]|=hh[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}};ze.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,a=this.h4,i,s,o,u=this.blocks;for(s=16;s<80;++s)o=u[s-3]^u[s-8]^u[s-14]^u[s-16],u[s]=o<<1|o>>>31;for(s=0;s<20;s+=5)i=e&t|~e&r,o=n<<5|n>>>27,a=o+i+a+1518500249+u[s]<<0,e=e<<30|e>>>2,i=n&e|~n&t,o=a<<5|a>>>27,r=o+i+r+1518500249+u[s+1]<<0,n=n<<30|n>>>2,i=a&n|~a&e,o=r<<5|r>>>27,t=o+i+t+1518500249+u[s+2]<<0,a=a<<30|a>>>2,i=r&a|~r&n,o=t<<5|t>>>27,e=o+i+e+1518500249+u[s+3]<<0,r=r<<30|r>>>2,i=t&r|~t&a,o=e<<5|e>>>27,n=o+i+n+1518500249+u[s+4]<<0,t=t<<30|t>>>2;for(;s<40;s+=5)i=e^t^r,o=n<<5|n>>>27,a=o+i+a+1859775393+u[s]<<0,e=e<<30|e>>>2,i=n^e^t,o=a<<5|a>>>27,r=o+i+r+1859775393+u[s+1]<<0,n=n<<30|n>>>2,i=a^n^e,o=r<<5|r>>>27,t=o+i+t+1859775393+u[s+2]<<0,a=a<<30|a>>>2,i=r^a^n,o=t<<5|t>>>27,e=o+i+e+1859775393+u[s+3]<<0,r=r<<30|r>>>2,i=t^r^a,o=e<<5|e>>>27,n=o+i+n+1859775393+u[s+4]<<0,t=t<<30|t>>>2;for(;s<60;s+=5)i=e&t|e&r|t&r,o=n<<5|n>>>27,a=o+i+a-1894007588+u[s]<<0,e=e<<30|e>>>2,i=n&e|n&t|e&t,o=a<<5|a>>>27,r=o+i+r-1894007588+u[s+1]<<0,n=n<<30|n>>>2,i=a&n|a&e|n&e,o=r<<5|r>>>27,t=o+i+t-1894007588+u[s+2]<<0,a=a<<30|a>>>2,i=r&a|r&n|a&n,o=t<<5|t>>>27,e=o+i+e-1894007588+u[s+3]<<0,r=r<<30|r>>>2,i=t&r|t&a|r&a,o=e<<5|e>>>27,n=o+i+n-1894007588+u[s+4]<<0,t=t<<30|t>>>2;for(;s<80;s+=5)i=e^t^r,o=n<<5|n>>>27,a=o+i+a-899497514+u[s]<<0,e=e<<30|e>>>2,i=n^e^t,o=a<<5|a>>>27,r=o+i+r-899497514+u[s+1]<<0,n=n<<30|n>>>2,i=a^n^e,o=r<<5|r>>>27,t=o+i+t-899497514+u[s+2]<<0,a=a<<30|a>>>2,i=r^a^n,o=t<<5|t>>>27,e=o+i+e-899497514+u[s+3]<<0,r=r<<30|r>>>2,i=t^r^a,o=e<<5|e>>>27,n=o+i+n-899497514+u[s+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+a<<0};ze.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,a=this.h4;return K[n>>28&15]+K[n>>24&15]+K[n>>20&15]+K[n>>16&15]+K[n>>12&15]+K[n>>8&15]+K[n>>4&15]+K[n&15]+K[e>>28&15]+K[e>>24&15]+K[e>>20&15]+K[e>>16&15]+K[e>>12&15]+K[e>>8&15]+K[e>>4&15]+K[e&15]+K[t>>28&15]+K[t>>24&15]+K[t>>20&15]+K[t>>16&15]+K[t>>12&15]+K[t>>8&15]+K[t>>4&15]+K[t&15]+K[r>>28&15]+K[r>>24&15]+K[r>>20&15]+K[r>>16&15]+K[r>>12&15]+K[r>>8&15]+K[r>>4&15]+K[r&15]+K[a>>28&15]+K[a>>24&15]+K[a>>20&15]+K[a>>16&15]+K[a>>12&15]+K[a>>8&15]+K[a>>4&15]+K[a&15]};ze.prototype.toString=ze.prototype.hex;ze.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,a=this.h4;return[n>>24&255,n>>16&255,n>>8&255,n&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,a>>24&255,a>>16&255,a>>8&255,a&255]};ze.prototype.array=ze.prototype.digest;ze.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(20),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),n};let oo=!1;const ph=n=>(oo||(console.warn(["The default method for hashing keys is insecure and will be replaced in a future version,","but hasn't been replaced yet as to not break existing caches. It's recommended that you use","a more secure hashing algorithm to avoid cache poisoning.","","See this page for more information:","|","> https://js.langchain.com/docs/troubleshooting/warnings/insecure-cache-algorithm"].join(`
`)),oo=!0),new ze(!0).update(n).hex()),mh=(...n)=>ph(n.join("_"));class gh{constructor(){Object.defineProperty(this,"keyEncoder",{enumerable:!0,configurable:!0,writable:!0,value:mh})}makeDefaultKeyEncoder(e){this.keyEncoder=e}}const yh=new Map;class ni extends gh{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(this.keyEncoder(e,t))??null)}async update(e,t,r){this.cache.set(this.keyEncoder(e,t),r)}static global(){return new ni(yh)}}class Yo extends _t{}class _h extends Yo{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new qa(this.value)]}}class bh extends Yo{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return ho(this.messages)}toChatMessages(){return this.messages}}var Bt={},uo;function wh(){if(uo)return Bt;uo=1,Bt.byteLength=o,Bt.toByteArray=c,Bt.fromByteArray=d;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,i=r.length;a<i;++a)n[a]=r[a],e[r.charCodeAt(a)]=a;e[45]=62,e[95]=63;function s(p){var h=p.length;if(h%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var g=p.indexOf("=");g===-1&&(g=h);var y=g===h?0:4-g%4;return[g,y]}function o(p){var h=s(p),g=h[0],y=h[1];return(g+y)*3/4-y}function u(p,h,g){return(h+g)*3/4-g}function c(p){var h,g=s(p),y=g[0],m=g[1],b=new t(u(p,y,m)),_=0,v=m>0?y-4:y,w;for(w=0;w<v;w+=4)h=e[p.charCodeAt(w)]<<18|e[p.charCodeAt(w+1)]<<12|e[p.charCodeAt(w+2)]<<6|e[p.charCodeAt(w+3)],b[_++]=h>>16&255,b[_++]=h>>8&255,b[_++]=h&255;return m===2&&(h=e[p.charCodeAt(w)]<<2|e[p.charCodeAt(w+1)]>>4,b[_++]=h&255),m===1&&(h=e[p.charCodeAt(w)]<<10|e[p.charCodeAt(w+1)]<<4|e[p.charCodeAt(w+2)]>>2,b[_++]=h>>8&255,b[_++]=h&255),b}function l(p){return n[p>>18&63]+n[p>>12&63]+n[p>>6&63]+n[p&63]}function f(p,h,g){for(var y,m=[],b=h;b<g;b+=3)y=(p[b]<<16&16711680)+(p[b+1]<<8&65280)+(p[b+2]&255),m.push(l(y));return m.join("")}function d(p){for(var h,g=p.length,y=g%3,m=[],b=16383,_=0,v=g-y;_<v;_+=b)m.push(f(p,_,_+b>v?v:_+b));return y===1?(h=p[g-1],m.push(n[h>>2]+n[h<<4&63]+"==")):y===2&&(h=(p[g-2]<<8)+p[g-1],m.push(n[h>>10]+n[h>>4&63]+n[h<<2&63]+"=")),m.join("")}return Bt}var vh=wh();const Eh=ir(vh);var Oh=Object.defineProperty,Sh=(n,e,t)=>e in n?Oh(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,xh=(n,e,t)=>(Sh(n,e+"",t),t);function $h(n,e){let t=Array.from({length:n.length},(r,a)=>({start:a,end:a+1}));for(;t.length>1;){let r=null;for(let a=0;a<t.length-1;a++){const i=n.slice(t[a].start,t[a+1].end),s=e.get(i.join(","));s!=null&&(r==null||s<r[0])&&(r=[s,a])}if(r!=null){const a=r[1];t[a]={start:t[a].start,end:t[a+1].end},t.splice(a+1,1)}else break}return t}function Ih(n,e){return n.length===1?[e.get(n.join(","))]:$h(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function Th(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Ma=class{constructor(n,e){at(this,"specialTokens");at(this,"inverseSpecialTokens");at(this,"patStr");at(this,"textEncoder",new TextEncoder);at(this,"textDecoder",new TextDecoder("utf-8"));at(this,"rankMap",new Map);at(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,a)=>{const[i,s,...o]=a.split(" "),u=Number.parseInt(s,10);return o.forEach((c,l)=>r[c]=u+l),r},{});for(const[r,a]of Object.entries(t)){const i=Eh.toByteArray(r);this.rankMap.set(i.join(","),a),this.textMap.set(a,i)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[a,i])=>(r[i]=this.textEncoder.encode(a),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),a=Ma.specialTokenRegex(Object.keys(this.specialTokens)),i=[],s=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!s.has(c)):t);if(o.size>0){const c=Ma.specialTokenRegex([...o]),l=n.match(c);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let u=0;for(;;){let c=null,l=u;for(;a.lastIndex=l,c=a.exec(n),!(c==null||s.has(c[0]));)l=c.index+1;const f=(c==null?void 0:c.index)??n.length;for(const p of n.substring(u,f).matchAll(r)){const h=this.textEncoder.encode(p[0]),g=this.rankMap.get(h.join(","));if(g!=null){i.push(g);continue}i.push(...Ih(h,this.rankMap))}if(c==null)break;let d=this.specialTokens[c[0]];i.push(d),u=c.index+c[0].length}return i}decode(n){const e=[];let t=0;for(let i=0;i<n.length;++i){const s=n[i],o=this.textMap.get(s)??this.inverseSpecialTokens[s];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let a=0;for(const i of e)r.set(i,a),a+=i.length;return this.textDecoder.decode(r)}},Qo=Ma;xh(Qo,"specialTokenRegex",n=>new RegExp(n.map(e=>Th(e)).join("|"),"g"));function Rh(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":return"o200k_base";default:throw new Error("Unknown model")}}const Ir={},kh=new ei({});async function Ah(n){return n in Ir||(Ir[n]=kh.fetch(`https://tiktoken.pages.dev/js/${n}.json`).then(e=>e.json()).then(e=>new Qo(e)).catch(e=>{throw delete Ir[n],e})),await Ir[n]}async function Ph(n){return Ah(Rh(n))}const Nh=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n;function ap(n){return typeof n!="object"||!n?!1:!!("type"in n&&n.type==="function"&&"function"in n&&typeof n.function=="object"&&n.function&&"name"in n.function&&"parameters"in n.function)}const Ch=()=>!1;class eu extends we{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??Ch(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class ip extends eu{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){const{cache:a,...i}=r;super({callbacks:e??t,...i}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof a=="object"?this.cache=a:a?this.cache=ni.global():this.cache=void 0,this.caller=new ei(r??{})}async getNumTokens(e){let t;typeof e=="string"?t=e:t=e.map(a=>typeof a=="string"?a:a.type==="text"&&"text"in a?a.text:"").join("");let r=Math.ceil(t.length/4);if(!this._encoding)try{this._encoding=await Ph("modelName"in this?Nh(this.modelName):"gpt2")}catch(a){console.warn("Failed to calculate number of tokens, falling back to approximate count",a)}if(this._encoding)try{r=this._encoding.encode(t).length}catch(a){console.warn("Failed to calculate number of tokens, falling back to approximate count",a)}return r}static _convertInputToPromptValue(e){return typeof e=="string"?new _h(e):Array.isArray(e)?new bh(e.map(xu)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([s,o])=>o!==void 0).map(([s,o])=>`${s}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}class jh extends eu{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=(e==null?void 0:e.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(e==null?void 0:e.responseFormat)??this.responseFormat}async invoke(e,t){let r,a=ae(t);return Ht(e)?(r=e.args,a={...a,toolCall:e}):r=e,this.call(r,a)}async call(e,t,r){const a=Ht(e)?e.args:e;let i;if(Wo(this.schema))try{i=await Ko(this.schema,a)}catch(h){let g="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(g=`${g}
Details: ${h.message}`),new wa(g,JSON.stringify(e))}else{const h=se(a,this.schema);if(!h.valid){let g="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(g=`${g}
Details: ${h.errors.map(y=>`${y.keywordLocation}: ${y.error}`).join(`
`)}`),new wa(g,JSON.stringify(e))}i=a}const s=jo(t),o=Pe.configure(s.callbacks,this.callbacks,s.tags||r,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),u=await(o==null?void 0:o.handleToolStart(this.toJSON(),typeof e=="string"?e:JSON.stringify(e),s.runId,void 0,void 0,void 0,s.runName));delete s.runId;let c;try{c=await this._call(i,u,s)}catch(h){throw await(u==null?void 0:u.handleToolError(h)),h}let l,f;if(this.responseFormat==="content_and_artifact")if(Array.isArray(c)&&c.length===2)[l,f]=c;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(c)}`);else l=c;let d;Ht(e)&&(d=e.id),!d&&Eu(s)&&(d=s.toolCall.id);const p=Mh({content:l,artifact:f,toolCallId:d,name:this.name});return await(u==null?void 0:u.handleToolEnd(p)),p}}class Lh extends jh{static lc_name(){return"DynamicStructuredTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}async call(e,t,r){const a=jo(t);return a.runName===void 0&&(a.runName=this.name),super.call(e,a,r)}_call(e,t,r){return this.func(e,t,r)}}function Mh(n){const{content:e,artifact:t,toolCallId:r}=n;return r&&!bu(e)?typeof e=="string"||Array.isArray(e)&&e.every(a=>typeof a=="object")?new ba({content:e,artifact:t,tool_call_id:r,name:n.name}):new ba({content:Dh(e),artifact:t,tool_call_id:r,name:n.name}):e}function Dh(n){try{return JSON.stringify(n,null,2)??""}catch{return`${n}`}}const sp=new Lh({name:"navigate_to",description:"Navigates the current tab to a given URL or search term.",schema:_o({destination:yo().describe("The URL or search phrase to navigate to.")}),func:async({destination:n})=>{var a,i;console.log(" navigateTool invoked:",n);const[e]=await chrome.tabs.query({active:!0,lastFocusedWindow:!0});if(!(e!=null&&e.id))return" No active tab found.";let t;try{t=new URL(n).href}catch{t=`https://www.google.com/search?q=${encodeURIComponent(n)}`}if(((a=e.url)==null?void 0:a.startsWith("chrome://"))||((i=e.url)==null?void 0:i.startsWith("chrome-extension://")))return await chrome.tabs.create({url:t}),` Opened ${t} in a new tab (restricted tab).`;try{return await chrome.scripting.executeScript({target:{tabId:e.id},func:s=>{window.location.href=s},args:[t]}),` Injected navigation to: ${t}`}catch(s){return console.error(" Script injection failed:",s),` Couldn't navigate to ${t}`}}});export{Fh as A,ip as B,Pe as C,li as D,ur as E,Fa as F,ar as G,qa as H,Vh as I,ap as J,Xt as K,Hh as L,Zh as M,np as N,xt as O,sp as P,we as R,Rl as _,At as a,ae as b,ch as c,fr as d,ep as e,tt as f,xu as g,Tl as h,Wh as i,tp as j,rp as k,fo as l,Jh as m,Xf as n,Wo as o,rn as p,mt as q,zh as r,Bh as s,rh as t,qh as u,vu as v,Gh as w,Mo as x,Kh as y,Kt as z};
